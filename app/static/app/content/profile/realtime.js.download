var iFRealtime=(function(window,document,investFeed,undefined){var pusher;var config;var offset=0;function bindEvents(notifications,channel,comments){notifications.bind('favorite',function(data){if(data.other_id==config.user.id){investFeed.notify.addNotification(data.post_id,data.user,data.other_id,'favorited your post');investFeed.notify.showToaster(data,500,"contact",'Favorited your post');}
$("div.favorite.id_"+ data.post_id+" span").removeClass('hidden').text(data.count);}).bind('unfavorite',function(data){var elm=$("div.favorite.id_"+ data.post_id+" span");if(data.count==0){$(elm).addClass('hidden');}
$(elm).text(data.count);}).bind('like',function(data){if(data.other_id==config.user.id){investFeed.notify.addNotification(data.post_id,data.user,data.other_id,'liked your post');investFeed.notify.showToaster(data,500,"contact",'Liked your post');}
$("div.like.id_"+ data.post_id+" span").removeClass('hidden').text(data.count);}).bind('message',function(data){if(data.other_id==config.user.id){investFeed.notify.showToaster(data,500,"message",'Direct messaged you');investFeed.notify.addNotification(data.message_id,data.user,data.user_id,'sent you a message','message');if($('.modal.messaging .dm-view').data('other-id')==data.user_id){investFeed.messages.receivedMessage(data.message_id);}}
$("div.like.id_"+ data.post_id+" span").removeClass('hidden').text(data.count);}).bind('unlike',function(data){var elm=$("div.like.id_"+ data.post_id+" span");if(data.count==0){$(elm).addClass('hidden');}
$(elm).text(data.count);}).bind('question',function(data){if(data.other_id==config.user.id){investFeed.notify.addNotification(data.post_id,data.user,data.other_id,'asked a question on your post');investFeed.notify.showToaster(data,500,"contact",'Asked a question on your post');}}).bind('comment',function(data){if(data.other_id==config.user.id){investFeed.notify.addNotification(data.post_id,data.user,data.other_id,'commented on your post');investFeed.notify.showToaster(data,500,"contact",'Made a comment on your post');}
if(data.user_id!=config.user.id){var container=$('.comment-container.id_'+ data.post_id);var loadURL=investFeed.base+"get/stream/c/"+ data.comment_id;$.get(loadURL,function(html_data){$(html_data).insertBefore($(container).find(".compose"));$(container).find(".empty-notification").remove();investFeed.comments.incrementCount(data.post_id);});}}).bind('answer',function(data){if(data.other_id==config.user.id){investFeed.notify.addNotification(data.post_id,data.user,data.other_id,'answered your question on a post');investFeed.notify.showToaster(data,500,"contact",'Answered your question');}}).bind('reply',function(data){if(data.other_id==config.user.id){investFeed.notify.addNotification(data.post_id,data.user,data.other_id,'replied to your comment');investFeed.notify.showToaster(data,500,"contact",'Replied to your comment');}
if(data.user_id!=config.user.id){var target=$('.reply_'+ data.comment_id).parents('.parent').find('.child');var loadURL=investFeed.base+"get/stream/r/"+ data.reply_id;$.get(loadURL,function(html_data){$(target).append(html_data);investFeed.comments.incrementCount(data.post_id);});}}).bind('mention',function(data){if(data.other_id==config.user.id){investFeed.notify.addNotification(data.post_id,data.user,data.other_id,'mentioned you in a post');investFeed.notify.showToaster(data,500,"contact",'Mentioned you in a post');}}).bind('subscribe',function(data){if(data.other_id==config.user.id){investFeed.notify.showToaster(data,500,"subscribed",'Subscribed to you');}}).bind('ban',function(data){if(data.user_id==config.user.id){window.location.href=investFeed.base+'logout';}}).bind('verified',function(data){if(data.user_id==config.user.id){window.location.reload();}});channel.bind('post',function(data){if(((config.data.controller=="welcome")||(config.data.controller=="feed"&&config.data.action=="stream"))&&$('.all').hasClass('active')){investFeed.post.add(data.post_id,data.user_id);}
else if(config.data.controller=="feed"&&config.data.action=="feed"){if(data.user_id==user_id){investFeed.post.add(data.post_id,data.user_id);}}
else if(config.data.controller=="profile"&&config.data.action=="handle"){if(data.user_id==$('.profile-container').data('uid')){investFeed.post.add(data.post_id,data.user_id);}}
else if(config.data.controller=="symbol"&&config.data.action=="index"){if(data.symbol=="$"+ $('.symbol-container').data('ticker')){investFeed.post.add(data.post_id,data.user_id);}}
else if(config.data.controller=="hashtag"&&config.data.action=="index"){if($.inArray($('.hashtag_container').data('hashtag'),data.hashtags)){investFeed.post.add(data.post_id,data.user_id);}}
else if((((config.data.controller=="welcome")||(config.data.controller=="feed"&&config.data.action=="stream"))&&$('.charts').hasClass('active'))){if(data.chart){investFeed.post.add(data.post_id,data.user_id);}}else if((((config.data.controller=="welcome")||(config.data.controller=="feed"&&config.data.action=="stream"))&&$('.links').hasClass('active'))){if(data.link){investFeed.post.add(data.post_id,data.user_id);}}
if($('.my-positions')&&config.user.id==data.user_id&&data.position==1){if($('.my-positions tr').length>=10){$('.my-positions tr:eq(10)').remove();}
$('.my-positions .data table tbody').prepend('<tr><td class="'+ data.class+'"><a href="/symbol/'+ data.symbol.split("$")[1]+'"><span class="ticker-tag" data-symbol="'+ data.symbol.split("$")[1]+'">'+ data.symbol+'</span></a></td><td><span class="status id_'+ data.post_id+'">'+ data.cost+'</span></td><td><span class="gl id_'+ data.post_id+'"> open </span></td><td><a href="" class="close id_'+ data.post_id+'" data-id="'+ data.post_id+'">Close</a></td></tr>');handleTickerTag();}
if($('.latest-positions')&&data.position==1){if($('.latest-positions tr').length>=10)
$('.latest-positions tr:eq(10)').remove();$('.latest-positions .data table tbody').prepend('<tr data-id="'+ data.post_id+'"><td class="'+ data.class+'"><a href="/symbol/'+ data.symbol.split("$")[1]+'"><span class="ticker-tag" data-symbol="'+ data.symbol.split("$")[1]+'">'+ data.symbol+'</span></a></td><td><a href="/posts/'+ data.post_id+'">'+ data.action+'</a></td><td>'+ data.type+'</td><td><a href="/profile/'+ data.user_id+'">'+ data.user+'</a></td><td>'+ moment().format('MM/DD/YY')+'</td></tr>');}
if($('.profile-container').data('uid')==data.user_id&&$('.portfolio')&&data.position==1&&data.user_id!=user_id){$.get(investFeed.base+"permission/?post="+ data.post_id+"&id="+ data.user_id+"&controller=profile&action=handle",function(resp){if(resp){if($('.portfolio tr').length>=10){$('.portfolio tr:eq(10)').remove();}
$('.portfolio tbody').prepend('<tr data-id="'+ data.post_id+'"><td><span class="symbol"><a href="/symbol/'+ data.symbol.split("$")[1]+'"><span class="ticker-tag" data-symbol="'+ data.symbol.split("$")[1]+'">'+ data.symbol+'</span></a></td><td>'+ data.class.charAt(0).toUpperCase()+ data.class.slice(1)+'</td><td>'+ ConvertTimezone(data.entry_date,config.user.timezone)+'</td><td>'+ data.cost+'</td><td><span class="exit_date id_1"></span></td><td><span class="exit_price id_1"></span></td><td><span class="status id_1">open</span></td><td><span class="ugl" style="color: #F5802D;">0 (0%)</span></td><td><span class="gl id_1">TBD</span></td></tr>');handleTickerTag();}});}else if($('.portfolio')&&data.position==1&&data.user_id==config.user.id){if($('.portfolio tr').length>=10){$('.portfolio tr:eq(10)').remove();}
$('.portfolio tbody').prepend('<tr data-id="'+ data.post_id+'"><td><span class="symbol"><a href="/symbol/'+ data.symbol.split("$")[1]+'"><span class="ticker-tag" data-symbol="'+ data.symbol.split("$")[1]+'">'+ data.symbol+'</span></a></td><td>'+ data.class.charAt(0).toUpperCase()+ data.class.slice(1)+'</td><td>'+ ConvertTimezone(data.entry_date,config.user.timezone)+'</td><td>'+ data.cost+'</td><td><span class="exit_date id_1"></span></td><td><span class="exit_price id_1"></span></td><td><span class="status id_1">open</span></td><td>'+ data.cost+'<td><span class="ugl" style="color: #F5802D;">0 (0%)</span></td><td><span class="gl id_1">TBD</span></td><td><a href class="close id_'+ data.post_id+'" data-id="'+ data.post_id+'">Close</a></td></tr>');handleTickerTag();}}).bind('delete',function(data){investFeed.post.remove(data.post_id);}).bind('edit',function(data){investFeed.post.update(data.post_id,data.content);});}
return{config:function(c){config=c;iFRealtime.pusher=new Pusher('83dca7c9dfdd0fb8fbc9');bindEvents(iFRealtime.pusher.subscribe('notifications'),iFRealtime.pusher.subscribe('posts'),iFRealtime.pusher.subscribe('comments'));},pusher:pusher,offset:{getIAS:function(uri){if(!uri)
return;var key="pusher_offset";var value=offset;var re=new RegExp("([?&])"+ key+"=.*?(&|$)","i");var separator=uri.indexOf('?')!==-1?"&":"?";if(uri.match(re)){return uri.replace(re,'$1'+ key+"="+ value+'$2');}else{return uri+ separator+ key+"="+ value;}},increment:function(){offset++;},reset:function(){offset=0;}}}})(window,document,investFeed);function ConvertTimezone(date,timezone){var datetime=moment.tz(date,"America/New_York")
var target_datetime=moment.tz(datetime,timezone)
return moment(target_datetime).format('MMMM D, YYYY, h:mm a');}