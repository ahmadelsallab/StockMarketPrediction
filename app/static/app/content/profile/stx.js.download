(function(){function _stx_js(_exports,_stxThirdParty){var iScroll=_stxThirdParty.iScroll;var iScroll5=_stxThirdParty.IScroll5;var timezoneJS=_stxThirdParty.timezoneJS;var debugDoc=null;function STX(){}
_exports.STX=STX;if(!window.console){window.console=function(){};}
Date.now=Date.now||function(){return new Date;};STX.ipad=navigator.userAgent.indexOf("iPad")!=-1;STX.iphone=navigator.userAgent.indexOf("iPhone")!=-1;STX.isSurface=navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>1;STX.touchDevice=typeof(document.ontouchstart)!="undefined"||STX.isSurface;STX.is_chrome=navigator.userAgent.toLowerCase().indexOf('chrome')>-1;STX.isAndroid=navigator.userAgent.toLowerCase().indexOf("android")>-1;STX.isIE=(navigator.userAgent.toLowerCase().indexOf("msie")>-1)||(navigator.userAgent.indexOf("Trident")>-1);STX.isIE9=(navigator.userAgent.indexOf("Trident/5")>-1)||(navigator.userAgent.indexOf("MSIE 9.0")>-1);STX.isIE8=window.isIE8||(navigator.userAgent.indexOf("MSIE 8.0")>-1);STX.isIOS7=navigator.userAgent.match(/iPad;.*CPU.*OS 7_\d/i);STX.isIOS8=navigator.userAgent.match(/iPad;.*CPU.*OS 8_\d/i);STX.isIOS7or8=STX.isIOS7|STX.isIOS8;STX.isSurfaceApp=window.MSApp;STX.noKeyboard=STX.ipad||STX.iphone||STX.isAndroid||STX.isSurfaceApp;STX.openDebugger=function(){var w=window.open("","Debug","width=500, height=400, scrollbars=1");debugDoc=w.document;};STX.debug=function(str){if(debugDoc==null){return;}
debugDoc.writeln(str);};STX.inspectProperties=function(theObject){var theProperties="";for(var i in theObject){if(i!="outerText"&&i!="innerText"&&i!="outerHTML"&&i!="innerHTML"){if(typeof(theObject[i])=="function"){theProperties+=i+""+"()"+"<br>";console.log(i+"()");}else{try{console.log(i+"="+theObject[i]);theProperties+=i+" = "+ theObject[i]+"<br>";}catch(e){}}}}
theProperties+="<P>";STX.debug(theProperties);};STX.colorToHex=function(color){if(color.substr(0,1)==='#'){return color;}
var digits=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(color);if(!digits)digits=/(.*?)rgba\((\d+), (\d+), (\d+),.*\)/.exec(color);if(!digits)return"#000000";var red=parseFloat(digits[2]);var green=parseFloat(digits[3]);var blue=parseFloat(digits[4]);var rgb=blue|(green<<8)|(red<<16);var s=digits[1]+'#'+ rgb.toString(16);return s.toUpperCase();};STX.hexToRgba=function(hex,opacity){if(hex.substr(0,4)==='rgba'){return hex;}
else if(hex.substr(0,3)==='rgb'){hex=STX.colorToHex(hex);}
hex=hex.replace('#','');r=parseInt(hex.substring(0,2),16);g=parseInt(hex.substring(2,4),16);b=parseInt(hex.substring(4,6),16);result='rgba('+r+','+g+','+b+','+opacity/100+')';return result;}
STX.isTransparent=function(color){if(!color)return false;if(color=="transparent")return true;var digits=/(.*?)rgba\((\d+), (\d+), (\d+), (.*)\)/.exec(color);if(digits==null)return false;if(parseFloat(digits[5])==0)return true;return false;};STX.hsv=function(color){var hex=STX.colorToHex(color);if(hex.substr(0,1)==="#")hex=hex.slice(1);for(var i=hex.length;i<6;i++){hex+="0";}
var r=parseInt(hex.slice(0,2),16);var g=parseInt(hex.slice(2,4),16);var b=parseInt(hex.slice(4,6),16);var computedH=0;var computedS=0;var computedV=0;r=parseInt((''+r).replace(/\s/g,''),10);g=parseInt((''+g).replace(/\s/g,''),10);b=parseInt((''+b).replace(/\s/g,''),10);if(r==null||g==null||b==null||isNaN(r)||isNaN(g)||isNaN(b)){return null;}
if(r<0||g<0||b<0||r>255||g>255||b>255){return null;}
r=r/255;g=g/255;b=b/255;var minRGB=Math.min(r,Math.min(g,b));var maxRGB=Math.max(r,Math.max(g,b));if(minRGB==maxRGB){computedV=minRGB;return[0,0,computedV];}
var d=(r==minRGB)?g-b:((b==minRGB)?r-g:b-r);var h=(r==minRGB)?3:((b==minRGB)?1:5);computedH=60*(h- d/(maxRGB- minRGB));computedS=(maxRGB- minRGB)/maxRGB;
computedV=maxRGB;return[computedH,computedS,computedV];};STX.dayOfYear=function(dt){var j1=new Date(dt);j1.setMonth(0,0);return Math.round((dt-j1)/8.64e7);
}
STX.chooseForegroundColor=function(backgroundColor){var hsv=STX.hsv(backgroundColor);var v=hsv[2];if(v>.85)return"#000000";else return"#FFFFFF";};function $$(id,source){if(!source)return document.getElementById(id);if(source.id==id)return source;if(!source.hasChildNodes)return null;for(var i=0;i<source.childNodes.length;i++){var element=$$(id,source.childNodes[i]);if(element!=null)return element;}
return null;}
_exports.$$=$$;function $$$(selector,source){if(!source)source=document;return source.querySelectorAll(selector)[0];}
_exports.$$$=$$$;STX.getEventDOM=function(e){if(!e){return window.event.srcElement;}else{return e.target;}};STX.getHostName=function(url){try{return url.match(/:\/\/(.[^/]+)/)[1];
}catch(e){return"";}};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+ this.slice(1);};STX.extend=function(target,source){for(var field in source){var datum=source[field];if(!datum)target[field]=datum;else if(datum.constructor==Object){if(!target[field])target[field]={};STX.extend(target[field],source[field]);}else if(datum.constructor==Array){target[field]=datum.slice();}else{target[field]=datum;}}};STX.clone=function(from,to)
{if(from==null||typeof from!="object")return from;if(from.constructor==Date||from.constructor==RegExp||from.constructor==Function||from.constructor==String||from.constructor==Number||from.constructor==Boolean)
return new from.constructor(from);to=to||new from.constructor();for(var n in from)
{to[n]=typeof to[n]=="undefined"?STX.clone(from[n],null):to[n];}
return to;};STX.shallowClone=function(from){if(from.constructor==Array){var to=new Array(from.length);for(var i=0;i<from.length;i++){to[i]=from[i];}
return to;}else{var to={};for(var field in from){to[field]=from[field];}
return to;}};STX.uniqueID=function(){var epoch=new Date();var id=epoch.getTime().toString(36);id+=Math.floor(Math.random()*Math.pow(36,2)).toString(36);return id.toUpperCase();};STX.clearNode=function(node){if(node.hasChildNodes()){while(node.childNodes.length>=1){node.removeChild(node.firstChild);}}};STX.monthLetters=["J","F","M","A","M","J","J","A","S","O","N","D"];STX.monthAbv=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];STX.monthAsDisplay=function(i,displayLetters,stx){if(displayLetters){if(stx&&stx.monthLetters)return stx.monthLetters[i];return STX.monthLetters[i];}else{if(stx&&stx.monthAbv)return stx.monthAbv[i];return STX.monthAbv[i];}};STX.timeAsDisplay=function(dt,stx,precision){if(stx&&stx.internationalizer){if(precision==STX.SECOND)
return stx.internationalizer.hourMinuteSecond.format(dt);else if(precision==STX.MILLISECOND)
return stx.internationalizer.hourMinuteSecond.format(dt)+"."+ dt.getMilliseconds();else
return stx.internationalizer.hourMinute.format(dt);}else{var min=dt.getMinutes();if(min<10)min="0"+ min;var str=dt.getHours()+":"+ min;if(precision<=STX.SECOND)
str+=":"+ dt.getSeconds();if(precision==STX.MILLISECOND)
str+="."+ dt.getMilliseconds();return str;}};STX.createMonthArrays=function(stx,formatter,locale){stx.monthAbv=[];stx.monthLetters=[];var dt=new Date();var shortenMonth=true;if(STX.I18N.longMonths&&STX.I18N.longMonths[locale])shortenMonth=false;for(var i=0;i<12;i++){dt.setDate(1);dt.setMonth(i);var str=formatter.format(dt);if(shortenMonth){var month="";for(var j=0;j<str.length;j++){var c=str.charAt(j);var cc=c.charCodeAt(0);if(cc<65)continue;month+=c;}
stx.monthAbv[i]=month;stx.monthLetters[i]=month[0];}else{stx.monthAbv[i]=str;stx.monthLetters[i]=str;}}};STX.condenseInt=function(txt){if(!txt||typeof txt=="undefined")return"";if(txt>0){if(txt>1000000000000)txt=Math.round(txt/100000000000)/10 + "t";
else if(txt>1000000000)txt=Math.round(txt/100000000)/10 + "b";
else if(txt>1000000)txt=Math.round(txt/100000)/10 + "m";
else if(txt>1000)txt=Math.round(txt/100)/10 + "k";
else txt=txt.toFixed(0);}else{if(txt<-1000000000000)txt=Math.round(txt/100000000000)/10 + "t";
else if(txt<-1000000000)txt=Math.round(txt/100000000)/10 + "b";
else if(txt<-1000000)txt=Math.round(txt/100000)/10 + "m";
else if(txt<-1000)txt=Math.round(txt/100)/10 + "k";
else txt=txt.toFixed(0);}
return txt;};STX.boxIntersects=function(bx1,by1,bx2,by2,x0,y0,x1,y1,vtype){if(STX.linesIntersect(bx1,bx2,by1,by1,x0,x1,y0,y1,vtype))return true;else if(STX.linesIntersect(bx1,bx2,by2,by2,x0,x1,y0,y1,vtype))return true;else if(STX.linesIntersect(bx1,bx1,by1,by2,x0,x1,y0,y1,vtype))return true;else if(STX.linesIntersect(bx2,bx2,by1,by2,x0,x1,y0,y1,vtype))return true;return false;};STX.linesIntersect=function(x1,x2,y1,y2,x3,x4,y3,y4,type){var denom=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1);var numera=(x4-x3)*(y1-y3)-(y4-y3)*(x1-x3);var numerb=(x2-x1)*(y1-y3)-(y2-y1)*(x1-x3);if(denom==0){if(numera==0&&numerb==0)return true;return false;}
var mua=numera/denom;var mub=numerb/denom;if(type=="segment"||type=="zig zag"){if(mua>=0&&mua<=1&&mub>=0&&mub<=1)return true;}else if(type=="line"||type=="horizontal"||type=="vertical"){if(mua>=0&&mua<=1)return true;}else if(type=="ray"){if(mua>=0&&mua<=1&&mub>=0)return true;}
return false;};STX.yIntersection=function(vector,x){var x1=vector.x0,x2=vector.x1,x3=x,x4=x;var y1=vector.y0,y2=vector.y1,y3=0,y4=10000;var denom=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1);var numera=(x4-x3)*(y1-y3)-(y4-y3)*(x1-x3);if(denom==0)return null;var mua=numera/denom;var y=y1+(mua*(y2-y1));return y;};STX.xIntersection=function(vector,y){var x1=vector.x0,x2=vector.x1,x3=0,x4=10000;var y1=vector.y0,y2=vector.y1,y3=y,y4=y;var denom=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1);var numera=(x4-x3)*(y1-y3)-(y4-y3)*(x1-x3);if(denom==0)return null;var mua=numera/denom;var x=x1+(mua*(x2-x1));return x;};STX.stripPX=function(text){return parseInt(text.substr(0,text.indexOf("p")));};STX.pageHeight=function(){var h=window.innerHeight;if(top!=self){try{if(h>parent.innerHeight)h=parent.innerHeight;}catch(e){}}
return h;};STX.pageWidth=function(){var w=window.innerWidth;if(top!=self){try{if(w>parent.innerWidth)w=parent.innerWidth;}catch(e){}}
return w;};STX.scrub=function(obj,removeNulls){for(var i in obj){if(typeof(obj[i])=="undefined")
delete obj[i];if(removeNulls&&obj[i]==null)
delete obj[i];}};STX.strToDateTime=function(dt){var myDateArray=[];if(dt.length==12){var y=parseFloat(dt.substring(0,4));var m=parseFloat(dt.substring(4,6))- 1;var d=parseFloat(dt.substring(6,8));var h=parseFloat(dt.substring(8,10));var mn=parseFloat(dt.substring(10,12));var newdt=new Date(y,m,d,h,mn,0,0);return newdt;}else{var lr=[dt];if(dt.indexOf("T")!=-1){if(!STX.isIE8&&dt.length>20){return new Date(dt);}
lr=dt.split("T");}else if(dt.indexOf(" ")!=-1)lr=dt.split(" ");if(lr[0].indexOf('/')!=-1)myDateArray=lr[0].split("/");else if(lr[0].indexOf('-')!=-1)myDateArray=lr[0].split("-");else return STX.strToDate(dt);var year=parseFloat(myDateArray[2],10);if(myDateArray[0]&&myDateArray[0].length==4){year=parseFloat(myDateArray[0],10);myDateArray[0]=myDateArray[1];myDateArray[1]=myDateArray[2];}
if(lr.length>1){var ampm=lr[2];lr=lr[1].split(':');if(ampm){if(lr[0]=="12"&&ampm.toUpperCase()=="AM")lr[0]=0;else if(lr[0]!="12"&&ampm.toUpperCase()=="PM")lr[0]=parseInt(lr[0],10)+12;}
var s=0,ms=0;if(lr.length==3){if(lr[2].indexOf(".")==-1){s=lr[2];}else{s=lr[2].split(".");if(s[1].length==3){ms=s[1];s=s[0];}else{ms=s[1].substr(0,3);var tz=parseInt(s[1].substr(3),10);s=s[0];var rDt=new Date(year,myDateArray[0]-1,myDateArray[1],lr[0],lr[1],s,ms);rDt.setMinutes(rDt.getMinutes()-rDt.getTimezoneOffset()-tz%100-Math.round(tz/100)*60);return rDt;}}}
return new Date(year,myDateArray[0]-1,myDateArray[1],lr[0],lr[1],s,ms);}else{return new Date(year,myDateArray[0]-1,myDateArray[1],0,0,0,0);}}};STX.strToDate=function(dt){var myDateArray;if(dt.indexOf('/')!=-1)myDateArray=dt.split("/");else if(dt.indexOf('-')!=-1)myDateArray=dt.split("-");else if(dt.length>=8){return new Date(parseFloat(dt.substring(0,4)),parseFloat(dt.substring(4,6))-1,parseFloat(dt.substring(6,8)));}else{return new Date();}
if(myDateArray[2].indexOf(' ')!=-1){myDateArray[2]=myDateArray[2].substring(0,myDateArray[2].indexOf(' '));}
var year=parseFloat(myDateArray[2],10);if(year<20)year+=2000;if(myDateArray[0].length==4){year=parseFloat(myDateArray[0],10);myDateArray[0]=myDateArray[1];myDateArray[1]=myDateArray[2];}
return new Date(year,myDateArray[0]-1,myDateArray[1]);};STX.mmddyyyy=function(d){var dt=STX.strToDate(d);var m=dt.getMonth()+1;if(m<10)m="0"+ m;var d=dt.getDate();if(d<10)d="0"+ d;return m+"/"+ d+"/"+ dt.getFullYear();};STX.yyyymmdd=function(dt){var m=dt.getMonth()+1;if(m<10)m="0"+ m;var d=dt.getDate();if(d<10)d="0"+ d;return dt.getFullYear()+"-"+ m+"-"+ d;};STX.yyyymmddhhmm=function(dt){var m=dt.getMonth()+1;if(m<10)m="0"+ m;var d=dt.getDate();if(d<10)d="0"+ d;var h=dt.getHours();if(h<10)h="0"+ h;var mn=dt.getMinutes();if(mn<10)mn="0"+ mn;return''+ dt.getFullYear()+ m+ d+ h+ mn;};STX.friendlyDate=function(dt){var m=dt.getMonth()+1;if(m<10)m="0"+ m;var d=dt.getDate();if(d<10)d="0"+ d;var h=dt.getHours();if(h<10)h="0"+ h;var mn=dt.getMinutes();if(mn<10)mn="0"+ mn;return''+ dt.getFullYear()+"/"+ m+"/"+ d+" "+ h+":"+ mn;};STX.standardUTCDate=function(dt){var m=dt.getUTCMonth()+1;if(m<10)m="0"+ m;var d=dt.getUTCDate();if(d<10)d="0"+ d;var h=dt.getUTCHours();if(h<10)h="0"+ h;var mn=dt.getUTCMinutes();if(mn<10)mn="0"+ mn;var s=dt.getUTCSeconds();if(s<10)s="0"+ s;return''+ dt.getUTCFullYear()+"-"+ m+"-"+ d+"T"+ h+":"+ mn+":"+ s+"Z";};STX.mmddhhmm=function(strdt){var dt=STX.strToDateTime(strdt);var m=dt.getMonth()+1;if(m<10)m="0"+ m;var d=dt.getDate();if(d<10)d="0"+ d;var h=dt.getHours();if(h<10)h="0"+ h;var mn=dt.getMinutes();if(mn<10)mn="0"+ mn;if(h=="00"&&mn=="00")return m+"-"+ d+"-"+ dt.getFullYear();return m+"-"+ d+" "+ h+":"+ mn;};STX.getETDateTime=function(){var d=new Date();return STX.convertTimeZone(new Date(d.getTime()+d.getTimezoneOffset()*60000),"UTC","America/New_York");};STX.fromET=function(est){var d=new Date();var offset=4;if((d.getMonth()<2||(d.getMonth()==2&&d.getDate()<11))||(d.getMonth()>10||(d.getMonth()==10&&d.getDate()>=4)))
offset=5;var localTime=est.getTime()+(3600000*offset);var nd=new Date(localTime);return nd;};STX.convertFutureMonth=function(x){var y=x.toString();if(y.length!=1)return"";switch(y){case'1':return"F";case'2':return"G";case'3':return"H";case'4':return"J";case'5':return"K";case'6':return"M";case'7':return"N";case'8':return"Q";case'9':return"U";case'10':return"V";case'11':return"X";case'12':return"Z";case'F':return"1";case'G':return"2";case'H':return"3";case'J':return"4";case'K':return"5";case'M':return"6";case'N':return"7";case'Q':return"8";case'U':return"9";case'V':return"10";case'X':return"11";case'Z':return"12";}
return y;};STX.money=function(val,decimals){if(!decimals&&decimals!=0)decimals=2;return"$"+ STX.commas((Math.round(val*10000)/10000).toFixed(decimals));
};STX.commas=function(val){return val.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");};STX.getAjaxServer=function(url){var server=false;var crossDomain=true;if((STX.isIE9||STX.isIE8)&&url){if(STX.getHostName(url)=="")crossDomain=false;if(STX.getHostName(url)==STX.getHostName(window.location.href))crossDomain=false;}
if((STX.isIE9||STX.isIE8)&&crossDomain){server=new XDomainRequest();return server;}
try{server=new XMLHttpRequest();}catch(e){alert("ajax not supported in browser");}
return server;};STX.qs=function(query){var qsParm=new Array();if(!query)query=window.location.search.substring(1);var parms=query.split('&');for(var i=0;i<parms.length;i++){var pos=parms[i].indexOf('=');if(pos>0){var key=parms[i].substring(0,pos);var val=parms[i].substring(pos+1);qsParm[key]=val;}else{var key=parms[i];qsParm[key]=null;}}
return qsParm;};STX.convertClickToTouchEnd=function(id){var node=$$(id);var s=node.getAttribute("onClick");if(s&&s!=""){node.removeAttribute("onClick");node.setAttribute("onTouchEnd",s);}}
STX.getPos=function(el){for(var lx=0,ly=0;el!=null;lx+=el.offsetLeft,ly+=el.offsetTop,el=el.offsetParent);return{x:lx,y:ly};};STX.withinElement=function(node,x,y){var xy=STX.getPos(node);if(x<=xy.x)return false;if(y<=xy.y)return false;if(x>=xy.x+node.offsetWidth)return false;if(y>=xy.y+node.offsetHeight)return false;return true;};STX.safeMouseOut=function(node,fc){function closure(node,fc){return function(e){if(STX.withinElement(node,e.pageX,e.pageY)){return;}
node.stxMouseOver=false;fc(e);};};node.addEventListener("mouseout",closure(node,fc));};STX.safeMouseOver=function(node,fc){function closure(node,fc){return function(e){if(STX.withinElement(node,e.pageX,e.pageY)){if(node.stxMouseOver)return;node.stxMouseOver=true;fc(e);}};};node.addEventListener("mouseover",closure(node,fc));};STX.fixScreen=function(){window.scrollTo(0,0);};STX.setCaretPosition=function(ctrl,pos){ctrl.style.zIndex=5000;if(ctrl.setSelectionRange){STX.focus(ctrl);try{ctrl.setSelectionRange(pos,pos);}catch(e){}}else if(ctrl.createTextRange){var range=ctrl.createTextRange();range.collapse(true);range.moveEnd('character',pos);range.moveStart('character',pos);range.select();}};STX.appendClassName=function(node,className){if(node.className==className)return;var s=node.className.split(" ");for(var i in s){if(s[i]==className)return;}
if(node.className=="")node.className=className;else node.className+=" "+ className;};STX.unappendClassName=function(node,className){if(node.className.indexOf(className)==-1)return;if(node.className==className){node.className="";}else{var s=node.className.split(" ");var newClassName="";for(var i in s){if(s[i]==className)continue;if(newClassName!="")newClassName+=" ";newClassName+=s[i];}
node.className=newClassName;}};STX.swapClassName=function(node,newClassName,oldClassName){STX.unappendClassName(node,oldClassName);STX.appendClassName(node,newClassName);};STX.hasClassName=function(node,className){if((" "+node.className+" ").indexOf(" "+className+" ")>-1)return true;else return false;};var blocks=[];STX.createDIVBlock=function(left,width,top,height){var block=document.createElement("div");block.style.position="fixed";block.style.left=left+"px";block.style.width=width+"px";block.style.top=top+"px";block.style.height=height+"px";document.body.appendChild(block);blocks[blocks.length]=block;return block;}
STX.rect=function(ctx,x,y,width,height,radius,fill,stroke){if(typeof stroke=="undefined"){stroke=true;}
if(typeof radius==="undefined"){radius=5;}
ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x+ width,y);ctx.lineTo(x+ width,y+ height);ctx.lineTo(x,y+ height);ctx.lineTo(x,y);ctx.closePath();if(stroke){ctx.stroke();}
if(fill){ctx.fill();}};STX.roundRect=function(ctx,x,y,width,height,radius,fill,stroke){if(typeof stroke=="undefined"){stroke=true;}
if(typeof radius==="undefined"){radius=5;}
ctx.beginPath();ctx.moveTo(x+ radius,y);ctx.lineTo(x+ width- radius,y);ctx.quadraticCurveTo(x+ width,y,x+ width,y+ radius);ctx.lineTo(x+ width,y+ height- radius);ctx.quadraticCurveTo(x+ width,y+ height,x+ width- radius,y+ height);ctx.lineTo(x+ radius,y+ height);ctx.quadraticCurveTo(x,y+ height,x,y+ height- radius);ctx.lineTo(x,y+ radius);ctx.quadraticCurveTo(x,y,x+ radius,y);ctx.closePath();if(stroke){ctx.stroke();}
if(fill){ctx.fill();}};STX.roundRectArrow=function(ctx,x,y,width,height,radius,fill,stroke,direction){if(typeof stroke=="undefined"){stroke=true;}
if(typeof radius==="undefined"){radius=5;}
ctx.beginPath();ctx.moveTo(x+ radius,y);ctx.lineTo(x+ width- radius,y);if(direction=="right"){ctx.lineTo(x+ width- radius+(height/2),y+(height/2));ctx.lineTo(x+ width- radius,y+ height);}else{ctx.quadraticCurveTo(x+ width,y,x+ width,y+ radius);ctx.lineTo(x+ width,y+ height- radius);ctx.quadraticCurveTo(x+ width,y+ height,x+ width- radius,y+ height);}
ctx.lineTo(x+ radius,y+ height);if(direction=="right"){ctx.quadraticCurveTo(x,y+ height,x,y+ height- radius);ctx.lineTo(x,y+ radius);ctx.quadraticCurveTo(x,y,x+ radius,y);}else{ctx.quadraticCurveTo(x,y+ height,x- radius,y+ height- radius);ctx.lineTo(x-(height/2),y+(height/2));ctx.lineTo(x- radius,y+ radius);ctx.quadraticCurveTo(x,y,x+ radius,y);}
ctx.closePath();if(stroke){ctx.stroke();}
if(fill){ctx.fill();}}
STX.semiRoundRect=function(ctx,x,y,width,height,radius,fill,stroke){if(typeof stroke=="undefined"){stroke=true;}
if(typeof radius==="undefined"){radius=5;}
ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x+ width- radius,y);ctx.quadraticCurveTo(x+ width,y,x+ width,y+ radius);ctx.lineTo(x+ width,y+ height- radius);ctx.quadraticCurveTo(x+ width,y+ height,x+ width- radius,y+ height);ctx.lineTo(x,y+ height);ctx.lineTo(x,y);ctx.closePath();if(stroke){ctx.stroke();}
if(fill){ctx.fill();}};STX.getLines=function(ctx,phrase,l){var wa=phrase.split(" "),phraseArray=[],lastPhrase="",measure=0;var fw=false;for(var i=0;i<wa.length;i++){var w=wa[i];measure=ctx.measureText(lastPhrase+w).width;if(measure<l){if(fw)lastPhrase+=" ";fw=true;lastPhrase+=w;}else{phraseArray.push(lastPhrase);lastPhrase=w;}
if(i===wa.length-1){phraseArray.push(lastPhrase);break;}}
return phraseArray;}
STX.clearCanvas=function(canvas,stx){canvas.context.clearRect(0,0,canvas.width,canvas.height);if(STX.isAndroid&&!STX.is_chrome){if(STXChart.useOldAndroidClear&&stx){canvas.context.fillStyle=stx.containerColor;canvas.context.fillRect(0,0,canvas.width,canvas.height);canvas.context.clearRect(0,0,canvas.width,canvas.height);}
var w=canvas.width;canvas.width=1;canvas.width=w;}};STX.alert=function(text){alert(text);};STX.horizontalIntersect=function(vector,x,y){if(x<Math.max(vector.x0,vector.x1)&&x>Math.min(vector.x0,vector.x1))return true;return false;};STX.twoPointIntersect=function(vector,x,y,radius){return STX.boxIntersects(x-radius,y-radius,x+radius,y+radius,vector.x0,vector.y0,vector.x1,vector.y1,"segment");};STX.boxedIntersect=function(vector,x,y){if(x>Math.max(vector.x0,vector.x1)||x<Math.min(vector.x0,vector.x1))return false;if(y>Math.max(vector.y0,vector.y1)||y<Math.min(vector.y0,vector.y1))return false;return true;};STX.isInElement=function(div,x,y){if(x<div.offsetLeft)return false;if(x>div.offsetLeft+div.clientWidth)return false;if(y<div.offsetTop)return false;if(y>div.offsetTop+div.clientHeight)return false;return true;};STX.privateBrowsingAlert=false;STX.localStorage=localStorage;STX.localStorageSetItem=function(name,value){try{STX.localStorage.setItem(name,value);}catch(e){if(!STX.privateBrowsingAlert){STX.alert("Your browser is in Private Browsing mode. Chart annotations will not be saved.");STX.privateBrowsingAlert=true;}}};STX.attachColorPicker=function(colorClick,cpHolder,cb){var closure=function(colorClick,cpHolder,cb){return function(color){if(cpHolder.colorPickerDiv)cpHolder.colorPickerDiv.style.display="none";colorClick.style.backgroundColor="#"+color;if(cb)cb(color);};};colorClick.onclick=(function(fc,cpHolder){return function(){if(cpHolder.colorPickerDiv==null){cpHolder.colorPickerDiv=document.createElement("DIV");cpHolder.colorPickerDiv.className="ciqColorPicker";document.body.appendChild(cpHolder.colorPickerDiv);}
STX.createColorPicker(cpHolder.colorPickerDiv,fc);cpHolder.colorPickerDiv.style.display="block";var xy=STX.getPos(this);var x=xy.x+this.clientWidth;if((x+cpHolder.colorPickerDiv.offsetWidth)>STX.pageWidth())
x-=(x+cpHolder.colorPickerDiv.offsetWidth)-STX.pageWidth()+20;cpHolder.colorPickerDiv.style.left=x+"px";var y=(xy.y);if(y+cpHolder.colorPickerDiv.clientHeight>STX.pageHeight())
y-=(y+cpHolder.colorPickerDiv.clientHeight)-STX.pageHeight();cpHolder.colorPickerDiv.style.top=y+"px";};})(closure(colorClick,cpHolder,cb),cpHolder);};STX.createColorPicker=function(div,fc){var colors=["ffffff","ffd0cf","ffd9bb","fff56c","eaeba3","d3e8ae","adf3ec","ccdcfa","d9c3eb","efefef","eb8b87","ffb679","ffe252","e2e485","c5e093","9de3df","b1c9f8","c5a6e1","cccccc","e36460","ff9250","ffcd2b","dcdf67","b3d987","66cac4","97b8f7","b387d7","9b9b9b","dd3e39","ff6a23","faaf3a","c9d641","8bc176","33b9b0","7da6f5","9f6ace","656565","b82c0b","be501b","e99b54","97a030","699158","00a99d","5f7cb8","784f9a","343434","892008","803512","ab611f","646c20","46603a","007e76","3e527a","503567","000000","5c1506","401a08","714114","333610","222f1d","00544f","1f2a3c","281a33"];STX.clearNode(div);var ul=document.createElement("ul");div.appendChild(ul);for(var i=0;i<colors.length;i++){var c=colors[i];var li=document.createElement("li");var a=document.createElement("a");li.appendChild(a);a.href="#";a.title=c;a.style.background="#"+c;a.innerHTML=c;ul.appendChild(li);a.onclick=(function(c){return function(){fc(c);};})(c);}};STX.isEmpty=function(o){for(var p in o){if(o.hasOwnProperty(p)){return false;}}
return true;};STX.first=function(o){for(var p in o){return p;}
return null;};STX.last=function(o){var l=null;for(var p in o){l=p;}
return l;};STX.objLength=function(o){var i=0;for(var p in o){i++;}
return i;};STX.Plotter=function(){this.seriesArray=[];this.seriesMap={};};STX.Plotter.prototype={Series:function(name,strokeOrFill,color,opacity){this.name=name;this.strokeOrFill=strokeOrFill;this.color=color;this.opacity=opacity;this.moves=[];this.text=[];if(!opacity)this.opacity=1;},newSeries:function(name,strokeOrFill,colorOrStyle,opacity){var series;if(colorOrStyle.constructor==String)series=new this.Series(name,strokeOrFill,colorOrStyle,opacity);else series=new this.Series(name,strokeOrFill,colorOrStyle["color"],colorOrStyle["opacity"]);this.seriesArray.push(series);this.seriesMap[name]=series;},moveTo:function(name,x,y){var series=this.seriesMap[name];series.moves.push({"action":"moveTo","x":x,"y":y});},lineTo:function(name,x,y){var series=this.seriesMap[name];series.moves.push({"action":"lineTo","x":x,"y":y});},quadraticCurveTo:function(name,x0,y0,x1,y1){var series=this.seriesMap[name];series.moves.push({"action":"quadraticCurveTo","x0":x0,"y0":y0,"x1":x1,"y1":y1});},addText:function(name,text,x,y){var series=this.seriesMap[name];series.text.push({"text":text,"x":x,"y":y});},drawText:function(context,series){for(var i=0;i<series.text.length;i++){var textObj=series.text[i];context.fillText(textObj.text,textObj.x,textObj.y);}},draw:function(context,name){var prevFillStyle=context.fillStyle;var prevStrokeStyle=context.strokeStyle;var prevGlobalAlpha=context.globalAlpha;for(var i=0;i<this.seriesArray.length;i++){var series=this.seriesArray[i];if(name&&series.name!=name)continue;context.beginPath();context.lineWidth=1;context.globalAlpha=series.opacity;context.fillStyle=series.color;context.strokeStyle=series.color;for(var j=0;j<series.moves.length;j++){var move=series.moves[j];if(move.action=="quadraticCurveTo"){(context[move.action])(move.x0,move.y0,move.x1,move.y1);}else{(context[move.action])(move.x,move.y);}}
if(series.strokeOrFill=="fill"){context.fill();}else{context.stroke();}
context.closePath();this.drawText(context,series);}
context.fillStyle=prevFillStyle;context.strokeStyle=prevStrokeStyle;context.globalAlpha=prevGlobalAlpha;}};STX.innerHTML=function(node,html){if(window.MSApp){MSApp.execUnsafeLocalFunction(function(){node.innerHTML=html;});}else{node.innerHTML=html;}};STX.loadUI=function(url,cb){var i=document.createElement("iframe");i.src=url+"?"+ STX.uniqueID();i.hidden=true;i.onload=(function(i){return function(){try{var iframeDocument=i.contentDocument||i.contentWindow.document;}catch(error){console.log(error);cb(error);}
if(iframeDocument&&iframeDocument.title==""){var html=iframeDocument.body.innerHTML;document.body.removeChild(i);var div=document.createElement("div");STX.innerHTML(div,html);for(var j=0;j<div.children.length;j++){var ch=div.children[j].cloneNode(true);document.body.appendChild(ch);}
cb();}};})(i);document.body.appendChild(i);};CanvasRenderingContext2D.prototype.dashedLineTo=function(fromX,fromY,toX,toY,pattern){var lt=function(a,b){return a<=b;};var gt=function(a,b){return a>=b;};var capmin=function(a,b){return Math.min(a,b);};var capmax=function(a,b){return Math.max(a,b);};var checkX={thereYet:gt,cap:capmin};var checkY={thereYet:gt,cap:capmin};if(fromY- toY>0){checkY.thereYet=lt;checkY.cap=capmax;}
if(fromX- toX>0){checkX.thereYet=lt;checkX.cap=capmax;}
this.moveTo(fromX,fromY);var offsetX=fromX;var offsetY=fromY;var idx=0,dash=true;while(!(checkX.thereYet(offsetX,toX)&&checkY.thereYet(offsetY,toY))){var ang=Math.atan2(toY- fromY,toX- fromX);var len=pattern[idx];offsetX=checkX.cap(toX,offsetX+(Math.cos(ang)*len));offsetY=checkY.cap(toY,offsetY+(Math.sin(ang)*len));if(dash)this.lineTo(offsetX,offsetY);else this.moveTo(offsetX,offsetY);idx=(idx+ 1)%pattern.length;dash=!dash;}};CanvasRenderingContext2D.prototype.stxLine=function(fromX,fromY,toX,toY,color,opacity,lineWidth,pattern){this.beginPath();this.lineWidth=lineWidth;this.strokeStyle=color;this.globalAlpha=opacity;if(pattern){this.dashedLineTo(fromX,fromY,toX,toY,pattern);}else{this.moveTo(fromX,fromY);this.lineTo(toX,toY);}
this.stroke();this.closePath();};CanvasRenderingContext2D.prototype.stxCircle=function(x,y,radius,filled){this.beginPath();this.arc(x,y,radius,0,2*Math.PI,false);if(filled)this.fill();this.stroke();this.closePath();};STX.textLabel=function(x,y,text,stx,style){stx.canvasFont(style);var fontHeight=stx.getCanvasFontSize(style);var s=stx.canvasStyle(style);var context=stx.chart.context;var arr=text.split("\n");var maxWidth=0;for(var i in arr){var m=stx.chart.context.measureText(arr[i]);if(m.width>maxWidth)maxWidth=m.width;}
var height=arr.length*fontHeight;context.textBaseline="alphabetic";context.strokeStyle=s["border-left-color"];context.fillStyle=s["background-color"];context.beginPath();context.moveTo(x,y);context.lineTo(x+maxWidth+10,y);context.lineTo(x+maxWidth+10,y+height+2);context.lineTo(x,y+height+2);context.lineTo(x,y);context.stroke();context.fill();context.closePath();context.strokeStyle=s["color"];context.fillStyle=s["color"];context.textBaseline="top";var y1=0;for(var i in arr){context.fillText(arr[i],x+5,y+y1+1);y1+=fontHeight;}};STX.focus=function(node,useTimeout){if(STX.isSurface||useTimeout){setTimeout(function(){node.focus();},0);}else{node.focus();}};STX.findNodesByText=function(startNode,text){if(startNode.innerHTML==text)return[startNode];var nodes=[];for(var i=0;i<startNode.childNodes.length;i++){var pushNodes=STX.findNodesByText(startNode.childNodes[i],text);if(pushNodes!=null){nodes=nodes.concat(pushNodes);}}
if(nodes.length)return nodes;return null;};STX.hideByText=function(startNode,text){var nodes=STX.findNodesByText(startNode,text);for(var i=0;i<nodes.length;i++){nodes[i].style.display="none";}};STX.intersectLineLineX=function(ax1,ax2,ay1,ay2,bx1,bx2,by1,by2){var ua_t=(bx2- bx1)*(ay1- by1)-(by2- by1)*(ax1- bx1);var u_b=(by2- by1)*(ax2- ax1)-(bx2- bx1)*(ay2- ay1);var ua=ua_t/u_b;return ax1+ ua*(ax2- ax1);};STX.intersectLineLineY=function(ax1,ax2,ay1,ay2,bx1,bx2,by1,by2){var ua_t=(bx2- bx1)*(ay1- by1)-(by2- by1)*(ax1- bx1);var u_b=(by2- by1)*(ax2- ax1)-(bx2- bx1)*(ay2- ay1);var ua=ua_t/u_b;return ay1+ ua*(ay2- ay1);};STX.outerWidth=function(node){var width=node.offsetWidth;width+=STX.stripPX(getComputedStyle(node).marginLeft);width+=STX.stripPX(getComputedStyle(node).marginRight);return width;};STX.fillTransparentCanvas=function(context,color,width,height){var compositeOperation=context.globalCompositeOperation;context.globalCompositeOperation="destination-over";context.fillStyle=color;context.fillRect(0,0,width,height);context.globalCompositeOperation=compositeOperation;};STX.readablePeriodicity=function(stx){var displayPeriodicity=stx.layout.periodicity;var displayInterval=stx.layout.interval;if(!stx.isDailyInterval(displayInterval)){if(stx.layout.interval!="minute"){displayPeriodicity=stx.layout.interval*stx.layout.periodicity;}
displayInterval="min";}
if(displayPeriodicity%60==0){displayPeriodicity/=60;displayInterval="hour";}
return displayPeriodicity+" "+ displayInterval.capitalize();};STX.postAjax=function(params,payload,cb,contentType,noEpoch,asynchronous){if(typeof params=="string"){params={url:params,payload:payload,cb:cb,contentType:contentType,noEpoch:noEpoch,asynchronous:asynchronous,method:null};}
if(params.asynchronous==null)params.asynchronous=true;var server=STX.getAjaxServer(params.url);if(!server)return false;var epoch=new Date();if(!params.noEpoch){if(params.url.indexOf('?')==-1)params.url+="?"+ epoch.getTime();else params.url+="&"+ epoch.getTime();}
var method=params.method;if(!method)method=params.payload?"POST":"GET";if((!STX.isIE9&&!STX.isIE8)||server.constructor==XMLHttpRequest){server.open(method,params.url,params.asynchronous);if(!params.contentType)params.contentType='application/x-www-form-urlencoded';if(params.payload)server.setRequestHeader('Content-Type',params.contentType);if(params.headers){for(var header in params.headers){server.setRequestHeader(header,params.headers[header]);}}}else{params.url=params.url.replace("https","http");server.open(method,params.url,params.asynchronous);server.onload=function(){params.cb(200,server.responseText);};server.onerror=function(){params.cb(0,null);};server.onprogress=function(){};}
server.onreadystatechange=function(){if(server.readyState==4){if(server.status==404){params.cb(server.status,null);}else if(server.status!=200){params.cb(server.status,server.responseText);}else{params.cb(200,server.responseText);}}};try{server.send(params.payload);}catch(e){params.cb(0,e);}
return true;};STX.log10=function(y){return Math.log(y)/Math.LN10;
};if(!window.getComputedStyle){window.getComputedStyle=function(el,pseudo){var style={};for(var prop in el.currentStyle){if(typeof el.currentStyle[prop]=="undefined"){continue;}
if(prop=="outline"||prop=="outlineWidth"){continue;}
style[prop]=el.currentStyle[prop];}
style.getPropertyValue=function(prop){var re=/(\-([a-z]){1})/g;if(prop=='float')prop='styleFloat';if(re.test(prop)){prop=prop.replace(re,function(){return arguments[2].toUpperCase();});}
return this[prop]?this[prop]:null;};return style;};}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(obj,start){for(var i=(start||0),j=this.length;i<j;i++){if(this[i]===obj){return i;}}
return-1;};}
STX.newChild=function(div,tagName,className,txt){var div2=document.createElement(tagName);if(className)div2.className=className;div.appendChild(div2);if(txt)div2.innerHTML=txt;return div2;};STX.androidDoubleTouch=null;STX.clickTouch=function(div,fc){function closure(div,fc){return function(e){if(STX.androidDoubleTouch==null){STX.androidDoubleTouch=new Date().getTime();}else{if(new Date().getTime()-STX.androidDoubleTouch<500)return;STX.androidDoubleTouch=new Date().getTime();}
(fc)(e);};}
if(STX.ipad||STX.iphone){div.ontouchend=fc;}else{if(STX.isAndroid){div.onclick=closure(div,fc);}else{div.onclick=fc;}}};STX.safeClickTouch=function(div,fc,params){if(!params)params={};if(!params.resetMS)params.resetMS=750;var possibleEvents=(("onclick"in window)?1:0)+(("ontouchend"in window)?1:0)+(("onpointerup"in window)?1:0);if(possibleEvents<=1)params.resetMS=0;if(!params.allowMultiple)STX.clearSafeClickTouches(div);params.registeredClick=false;function closure(which,params){return function(e){if(params.registeredClick)return;if(params.safety&&params.safety.recentlyDragged)return;params.registeredClick=true;setTimeout(function(){params.registeredClick=false;},params.resetMS);(fc)(e);};}
var fc1=closure("click",params);var fc2=closure("touchend",params);var fc3=closure("pointerup",params);if("onclick"in window)div.addEventListener("click",fc1);if("ontouchend"in window)div.addEventListener("touchend",fc2);if("onpointerup"in window)div.addEventListener("pointerup",fc3);if(!div.safeClickTouchEvents)div.safeClickTouchEvents=[];div.safeClickTouchEvents.push({"click":fc1,"touchend":fc2,"pointerup":fc3});};STX.clearSafeClickTouches=function(div){if(!div.safeClickTouchEvents)return;for(var i=0;i<div.safeClickTouchEvents.length;i++){var fc=div.safeClickTouchEvents[i];if("onclick"in window)div.removeEventListener("click",fc.click);if("ontouchend"in window)div.removeEventListener("touchend",fc.touchend);if("onpointerup"in window)div.removeEventListener("pointerup",fc.pointerup);}
div.safeClickTouchEvents=null;};STX.safeDrag=function(div,fcDown,fcMove,fcUp){var resetMS=100;var registeredClick=false;var startX=0,startY=0;var safety={recentlyDragged:false};function closure(moveEvent){var fmap={"mousedown":{"move":"mousemove","up":"mouseup"},"pointerdown":{"move":"pointermove","up":"pointerup"},"touchstart":{"move":"touchmove","up":"touchend"}};function pageX(e){if(e.touches){if(e.touches.length>=1){return e.touches[0].pageX;}else if(e.changedTouches&&e.changedTouches.length>=1){return e.changedTouches[0].pageX;}}
return e.pageX;};function pageY(e){if(e.touches){if(e.touches.length>=1){return e.touches[0].pageY;}else if(e.changedTouches&&e.changedTouches.length>=1){return e.changedTouches[0].pageY;}}
return e.pageY;};return function(e){if(registeredClick)return;registeredClick=true;STXChart.ignoreTouch=true;var moveFC=function(e){if(e&&e.preventDefault)e.preventDefault();safety.recentlyDragged=true;e.displacementX=pageX(e)-startX;e.displacementY=pageY(e)-startY;(fcMove)(e);};if(fcMove)document.body.addEventListener(fmap[moveEvent].move,moveFC);document.body.addEventListener(fmap[moveEvent].up,function(e){STXChart.ignoreTouch=false;if(fcMove)document.body.removeEventListener(fmap[moveEvent].move,moveFC);document.body.removeEventListener(fmap[moveEvent].up,arguments.callee);e.displacementX=pageX(e)-startX;e.displacementY=pageY(e)-startY;if(fcUp)(fcUp)(e);setTimeout(function(safety){return function(){safety.recentlyDragged=false;};}(safety),50);});setTimeout(function(){registeredClick=false;},resetMS);startX=pageX(e);startY=pageY(e);if(fcDown)(fcDown)(e);};}
div.addEventListener("mousedown",closure("mousedown"));div.addEventListener("pointerdown",closure("pointerdown"));div.addEventListener("touchstart",closure("touchstart"));return safety;};STX.hideKeyboard=function(){var element=document.activeElement;if(element.tagName=="INPUT")
element.blur();};STX.loadScript=function(scriptName,cb){if(!STX.loadedScripts)STX.loadedScripts={};if(STX.loadedScripts[scriptName]){if(cb)cb();return;}
var script=document.createElement("SCRIPT");script.async=true;script.onload=function(){STX.loadedScripts[scriptName]=true;if(cb)cb();};var uniqueName=scriptName;if(uniqueName.indexOf("?")==-1){uniqueName=uniqueName+"?"+ Date.now();}else{uniqueName=uniqueName+"&"+ Date.now();}
script.src=uniqueName;var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(script,s.nextSibling);};STX.loadWidget=function(widget,cb){var lnk=document.createElement("link");lnk.rel="stylesheet";lnk.type="text/css";lnk.media="screen";lnk.href=widget+".css?"+ Date.now();var links=document.getElementsByTagName("link");var lastLink=links[links.length-1];lastLink.parentNode.insertBefore(lnk,lastLink.nextSibling);STX.loadUI(widget+".html",function(err){if(err)cb(err);else STX.loadScript(widget+".js",cb);});};STX.minMax=function(series,field){var min=Number.MAX_VALUE;var max=Number.MIN_VALUE;for(var i=0;i<series.length;i++){var entry=series[i];if(!entry)continue;var val=entry[field];if(!val&&val!=0)continue;if(isNaN(val))continue;min=Math.min(min,val);max=Math.max(max,val);}
return[min,max];};STX.replaceFields=function(obj,mapping){if(!obj)return obj;var newObj={};for(var field in obj){var value=obj[field];var replaced=mapping[field];if(!replaced)replaced=field;if(value!=null&&typeof value=="object"){if(value.constructor==Array){var arr=newObj[replaced]=new Array(value.length);for(var i=0;i<arr.length;i++){var val=value[i];if(typeof val=="object"){arr[i]=STX.replaceFields(val,mapping);}else{arr[i]=val;}}}else{newObj[replaced]=STX.replaceFields(value,mapping);}}else{newObj[replaced]=value;}}
return newObj;};STX.removeNullValues=function(obj){var n=STX.clone(obj);for(var f in n){if(!n[f])delete n[f];}
return n;};STX.reverseObject=function(obj){var newObj={};for(var field in obj){newObj[obj[field]]=field;}
return newObj;};STX.inputKeyEvents=function(node,cb){node.addEventListener("keyup",function(e){var key=(window.event)?event.keyCode:e.keyCode;switch(key){case 13:cb();break;case 27:node.value="";break;default:break;}},false);};STX.I18N=function(){}
STX.I18N.hereDoc=function(f){return f.toString().replace(/^[^\/]+\/\*!?/,'').replace(/\*\/[^\/]+$/,'');};STX.I18N.csv=STX.I18N.hereDoc(function(){});STX.I18N.language="en";STX.I18N.longMonths={"zh":true,"ja":true};STX.I18N.wordLists={"en":{"1D":"","1 D":"","3 D":"","1 W":"","2 Wk":"","1 Mo":"","5 Min":"","10 Min":"","15 Min":"","30 Min":"","1 hour":"","Chart":"","Chart Style":"","Candle":"","Bar":"","Colored Bar":"","Monotone":"","Line":"","Colored Line":"","Hollow Candle":"","Baseline Delta":"","Chart Scale":"","Log Scale":"","Studies":"","Accumulative Swing Index":"","Aroon":"","Aroon Oscillator":"","Average True Range":"","Bollinger Bands":"","Center Of Gravity":"","Chaikin Money Flow":"","Chaikin Volatility":"","Chande Forecast Oscillator":"","Chande Momentum Oscillator":"","Commodity Channel Index":"","Coppock Curve":"","Detrended Price Oscillator":"","Directional Movement System":"","Donchian Channel":"","Donchian Width":"","Ease of Movement":"","Ehler Fisher Transform":"","Elder Force Index":"","Elder Ray":"","Fractal Chaos Bands":"","Fractal Chaos Oscillator":"","Gopalakrishnan Range Index":"","High Low Bands":"","High Minus Low":"","Highest High Value":"","Historical Volatility":"","Intraday Momentum Index":"","Keltner Channel":"","Klinger Volume Oscillator":"","Linear Reg Forecast":"","Linear Reg Intercept":"","Linear Reg R2":"","Linear Reg Slope":"","Lowest Low Value":"","MACD":"","Mass Index":"","Median Price":"","Momentum Oscillator":"","Money Flow Index":"","Moving Average":"","Moving Average Envelope":"","Negative Volume Index":"","On Balance Volume":"","Parabolic SAR":"","Performance Index":"","Positive Volume Index":"","Pretty Good Oscillator":"","Price Oscillator":"","Price Rate of Change":"","Price Volume Trend":"","Prime Number Bands":"","Prime Number Oscillator":"","QStick":"","Random Walk Index":"","RAVI":"","RSI":"","Schaff Trend Cycle":"","Standard Deviation":"","Stochastics":"","Stochastic Momentum Index":"","Stochastic Oscillator":"","Swing Index":"","Time Series Forecast":"","Trade Volume Index":"","TRIX":"","True Range":"","Twiggs Money Flow":"","Typical Price":"","Ultimate Oscillator":"","Vertical Horizontal Filter":"","Volume":"","Vol Underlay":"","Volume Oscillator":"","Volume Rate of Change":"","Weighted Close":"","Williams %R":"","Williams Accumulation Distribution":"","Timezone":"","Change Timezone":"","Default Themes":"","Light":"","Dark":"","Custom Themes":"","New Custom Theme":"","Select Tool":"","None":"","Crosshairs":"","Annotation":"","Fibonacci":"","Horizontal":"","Horizontal Line":"","Ray":"","Segment":"","Rectangle":"","Ellipse":"","Bell Curve":"","Freeform":"Doodle","Vertical":"","Vertical Line":"","Continuous":"","Continuous Line":"","Ellipse Center":"","Ellipse Left":"","Measure:":"","Projection:":"","Fill:":"","Line:":"","O: ":"","H: ":"","V: ":"","C: ":"","L: ":"","save":"","cancel":"","Create":"","Show Zones":"","OverBought":"","OverSold":"","Choose Timezone":"","Close":"","Shared Chart URL":"","Share This Chart!":"","Create a New Custom Theme":"","Candles":""," Border":"","Line/Bar/Wick":"","Background":"","Grid Lines":"","Date Dividers":"","Axis Text":"","Gradient":"","New Theme Name:":"","Save Theme":"","right-click to delete":"","rsi":"","Period":"","ma":"","Field":"","Type":"","MA":"","macd":"","Fast MA Period":"","Slow MA Period":"","Signal Period":"","Signal":"","stochastics":"","Smooth":"","Fast":"","Slow":"","Aroon Up":"","Aroon Down":"","Lin R2":"","RSquared":"","Lin Fcst":"","Forecast":"","Lin Incpt":"","Intercept":"","Time Fcst":"","VIDYA":"","R2 Scale":"","STD Dev":"","Standard Deviations":"","Moving Average Type":"","Trade Vol":"","Min Tick Value":"","Swing":"","Limit Move Value":"","Acc Swing":"","Price Vol":"","Pos Vol":"","Neg Vol":"","On Bal Vol":"","Perf Idx":"","Stch Mtm":"","%K Periods":"","%K Smoothing Periods":"","%K Double Smoothing Periods":"","%D Periods":"","%D Moving Average Type":"","%K":"","%D":"","Hist Vol":"","Bar History":"","Ultimate":"","Cycle 1":"","Cycle 2":"","Cycle 3":"","W Acc Dist":"","Vol Osc":"","Short Term Periods":"","Long Term Periods":"","Points Or Percent":"","Chaikin Vol":"","Rate Of Change":"","Price Osc":"","Long Cycle":"","Short Cycle":"","EOM":"","CCI":"","Detrended":"","Aroon Osc":"","Elder Force":"","Ehler Fisher":"","EF":"","EF Trigger":"","Schaff":"","Coppock":"","Chande Fcst":"","Intraday Mtm":"","Random Walk":"","Random Walk High":"","Random Walk Low":"","Directional":"","ADX":"","DI+":"","DI-":"","High Low":"","High Low Bands Top":"","High Low Bands Median":"","High Low Bands Bottom":"","MA Env":"","Shift Percentage":"","Envelope Top":"","Envelope Median":"","Envelope Bottom":"","Fractal High":"","Fractal Low":"","Prime Bands Top":"","Prime Bands Bottom":"","Bollinger Band Top":"","Bollinger Band Median":"","Bollinger Band Bottom":"","Keltner":"","Shift":"","Keltner Top":"","Keltner Median":"","Keltner Bottom":"","Donchian High":"","Donchian Median":"","Donchian Low":"","Channel Fill":"","High Period":"","Low Period":"","PSAR":"","Minimum AF":"","Maximum AF":"","Klinger":"","Signal Periods":"","KlingerSignal":"","Elder Bull Power":"","Elder Bear Power":"","LR Slope":"","Slope":"","Correlate":""}};STX.I18N.findAllTextNodes=function(){var walker=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null,false);var node;var ws=new RegExp("^\\s*$");var wordList={};while(node=walker.nextNode()){if(!ws.test(node.nodeValue)){if(node.parentNode.tagName=="SCRIPT")continue;if(wordList[node.nodeValue]==null)wordList[node.nodeValue]=[];wordList[node.nodeValue].push(node);}}
if(STX.Studies.studyLibrary){for(var study in STX.Studies.studyLibrary){if(wordList[study]==null)wordList[study]=[];var s=STX.Studies.studyLibrary[study];if(s.inputs){for(var input in s.inputs){if(wordList[input]==null)wordList[input]=[];}}
if(s.outputs){for(var output in s.outputs){if(wordList[output]==null)wordList[output]=[];}}}}
return wordList;};STX.I18N.missingWordList=function(language){if(!language)language=STX.I18N.language;var wordsInUI=STX.I18N.findAllTextNodes();var missingWords={};var languageWordList=STX.I18N.wordLists[language];if(!languageWordList)languageWordList={};for(var word in wordsInUI){if(typeof languageWordList[word]=="undefined"){missingWords[word]="";}}
return missingWords;};STX.I18N.printableMissingWordList=function(language){var missingWords=JSON.stringify(STX.I18N.missingWordList(language));missingWords=missingWords.replace("\",\"","\",\n\"","\g");return missingWords;};STX.I18N.translateUI=function(language){if(!language)language=STX.I18N.language;var wordsInUI=STX.I18N.findAllTextNodes();var languageWordList=STX.I18N.wordLists[language];if(!languageWordList)return;for(var word in wordsInUI){var translation=languageWordList[word];if(!translation)continue;var nodes=wordsInUI[word];for(var i=0;i<nodes.length;i++){nodes[i].data=translation;}}};STX.I18N.translate=function(word,language){if(!language)language=STX.I18N.language;var languageWordList=STX.I18N.wordLists[language];if(!languageWordList)return word;var translation=languageWordList[word];if(!translation)return word;return translation;};STX.I18N.convertCSV=function(csv){if(!csv)csv=STX.I18N.csv;var lines=csv.split("\n");var headerRow=lines[0];var languages=headerRow.split(",");for(var j=0;j<languages.length;j++){var lang=languages[j];if(!STX.I18N.wordLists[lang]){STX.I18N.wordLists[lang]={};}}
for(var i=1;i<lines.length;i++){var words=lines[i].split(",");var key=words[0];for(var j=1;j<words.length;j++){STX.I18N.wordLists[languages[j]][key]=words[j];}}};STX.I18N.setLocale=function(stx,locale,cb){if(window.OldIntl){stx.setLocale(locale);if(cb)cb(null);return;}
var localeFileURL="locale-data/jsonp/"+ locale+".js";var script=document.createElement("SCRIPT");script.async=true;script.src=localeFileURL;var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(script,s.nextSibling);script.onload=function(){stx.setLocale(locale);if(cb)cb(null);};script.onerror=function(){if(cb)cb("cannot load script");};};STX.Market=function(sessionDefinition){this.sessions=[[],[],[],[],[],[],[]];this.closings={};this.timezone="Etc/UTC";if(sessionDefinition){this.processSessionDefinition(sessionDefinition);}};STX.Market.convertTime=function(s){var a=s.split(":");return parseInt(a[0])*60+parseInt(a[1]);};STX.Market.isOptionSymbol=function(symbol){if(!STX.optionSymbolRegEx)STX.optionSymbolRegEx=new RegExp("^[A-Za-z]{1,6}\\d{6}[C|P]\\d{8}");var match=STX.optionSymbolRegEx.exec(symbol);if(!match)return false;return true;};STX.Market.prototype.processSessionDefinition=function(sessionDefinition){this.sessions=[[],[],[],[],[],[],[]];this.closings={};this.timezone=sessionDefinition.timezone;if(!this.timezone)this.timezone="Etc/UTC";function processSession(sessions,day,unprocessed){var processed=sessions[day]=[];for(var j=0;j<unprocessed.length;j++){var session=unprocessed[j];var processedSession={open:0,close:1440};if(session.open)processedSession.open=STX.Market.convertTime(session.open);if(session.close)processedSession.close=STX.Market.convertTime(session.close);processed.push(processedSession);}};var unprocessed=sessionDefinition.sessions["*"];if(unprocessed){for(var i=0;i<7;i++){processSession(this.sessions,i,unprocessed);}}
for(var day in sessionDefinition.sessions){if(day=="*")continue;var unprocessed=sessionDefinition.sessions[day];processSession(this.sessions,parseInt(day),unprocessed);}
for(var i=0;i<sessionDefinition.closings.length;i++){var closing=sessionDefinition.closings[i];var dt=STX.strToDate(closing.date);var processed=[];var defaultSession=this.sessions[dt.getDay()][0];if(closing.sessions){var sessions=STX.clone(closing.sessions);for(var j=0;j<sessions.length;j++){var session=sessions[j];if(session.open)session.open=STX.Market.convertTime(session.open);else session.open=defaultSession.open;if(session.close)session.close=STX.Market.convertTime(session.close);else session.close=defaultSession.close;processed.push(session);}}
var hash=""+dt.getFullYear()+dt.getMonth()+dt.getDate();this.closings[hash]=processed;}};STX.Market.prototype.getHoliday=function(dt){var hash=""+dt.getFullYear()+dt.getMonth()+dt.getDate();var entry=this.closings[hash];if(!entry)return null;return entry;};STX.Market.prototype.isMarketOpen=function(dt){if(!dt)dt=new Date();var newdt=new timezoneJS.Date(dt.getTime(),this.timezone);var day=newdt.getDay();var sessions=this.sessions[day];if(sessions.length==0)return false;var replaceSessions=this.getHoliday(newdt);if(replaceSessions)sessions=replaceSessions;if(sessions.length==0)return false;var minutesAfterMidnight=dt.getHours()*60+dt.getMinutes();for(var i=0;i<sessions.length;i++){var session=sessions[i];if(!session.open&&!session.close)return true;if(minutesAfterMidnight>=session.open&&minutesAfterMidnight<session.close)return true;}
return false;};STX.Market.prototype.isAfterMarketClose=function(dt){if(!dt)dt=new Date();dt=new timezoneJS.Date(dt.getTime(),this.timezone);var day=dt.getDay();var sessions=this.sessions[day];if(sessions.length==0)return false;var replaceSessions=this.getHoliday(newdt);if(replaceSessions)sessions=replaceSessions;if(sessions.length==0)return false;var minutesAfterMidnight=dt.getHours()*60+dt.getMinutes();var session=sessions[sessions.length-1];if(!session.open&&!session.close)return false;if(minutesAfterMidnight>=session.close)return true;return false;};STX.Market.prototype.isAfterDelayedClose=function(dt,minutes){if(!dt)dt=new Date();if(!minutes)minutes=20;var newDate=new Date(dt.getTime());newDate.setMinutes(newDate.getMinutes()-minutes);return this.isAfterMarketClose(newDate);};STX.Market.Iterator=function(market,dt,interval,period,params){if(!params)params={};this.params=params;this.market=market;this.interval=interval;this.period=period;this.sessionPointer=null;if(!this.period)this.period=1;this.dt=dt;if(dt.constructor==Date){if(params.utc){this.dt=new timezoneJS.Date(dt.getTime(),market.timezone);}else{this.dt=new timezoneJS.Date(dt.getFullYear(),dt.getMonth(),dt.getDate(),dt.getHours(),dt.getMinutes(),dt.getSeconds(),dt.getMilliseconds(),market.timezone);}}};STX.Market.Iterator.prototype.increment=function(){if(this.interval=="minute"){var t1=this.dt.getTime();if(this.params.calendarAxis){this.dt=new timezoneJS.Date(t1+this.period*60*1000,this.market.timezone);return this.dt;}
t1+=this.period*60*1000;var future=new timezoneJS.Date(t1,this.market.timezone);var newSession=false;for(var i=0;i<1000;i++){var day=future.getDay();var sessions=this.market.sessions[day];if(sessions.length==0){newSession=true;future.setDate(future.getDate()+1);this.sessionPointer=0;continue;}
var replaceSessions=this.market.getHoliday(future);if(replaceSessions)sessions=replaceSessions;if(sessions.length==0){newSession=true;future.setDate(future.getDate()+1);this.sessionPointer=0;continue;}
if(this.sessionPointer==null)future=this.initializeSessionPointer(sessions,"increment");var minutesAfterMidnight=future.getHours()*60+future.getMinutes();var foundIt=false;for(;this.sessionPointer<sessions.length;this.sessionPointer++){var session=sessions[this.sessionPointer];if(newSession){future.setHours(Math.floor(session.open/60));future.setMinutes(session.open-future.getHours()*60);foundIt=true;break;}
if(!session.open&&!session.close){foundIt=true;break;}
if(minutesAfterMidnight>=session.open&&minutesAfterMidnight<session.close){foundIt=true;break;}
newSession=true;}
if(foundIt)break;future.setDate(future.getDate()+1);this.sessionPointer=0;}
this.dt=future;return this.dt;}else if(this.interval=="day"){for(var i=0;i<this.period;i++){this.dt.setDate(this.dt.getDate()+1);if(!this.params.calendarAxis)this.advanceToMarketDay();}}else if(this.interval=="week"){for(var i=0;i<this.period;i++){var day=this.dt.getDay();var inc=(7-day);this.dt.setDate(this.dt.getDate()+inc);if(!this.params.calendarAxis)this.advanceToMarketDay();}}else if(this.interval=="month"){for(var i=0;i<this.period;i++){this.dt.setDate(1);this.dt.setMonth(this.dt.getMonth()+1);if(!this.params.calendarAxis)this.advanceToMarketDay();}}
this.sessionPointer=0;return this.dt;};STX.Market.Iterator.prototype.advanceToMarketDay=function(){for(var i=0;i<20;i++){var day=this.dt.getDay();var sessions=this.market.sessions[day];if(sessions.length==0){this.dt.setDate(this.dt.getDate()+1);continue;}
var replaceSessions=this.market.getHoliday(this.dt);if(replaceSessions)sessions=replaceSessions;if(sessions.length==0){this.dt.setDate(this.dt.getDate()+1);continue;}
return;}};STX.Market.Iterator.prototype.retreatToMarketDay=function(){for(var i=0;i<20;i++){var day=this.dt.getDay();var sessions=this.market.sessions[day];if(sessions.length==0){this.dt.setDate(this.dt.getDate()-1);continue;}
var replaceSessions=this.market.getHoliday(this.dt);if(replaceSessions)sessions=replaceSessions;if(sessions.length==0){this.dt.setDate(this.dt.getDate()-1);continue;}
return;}};STX.Market.Iterator.prototype.initializeSessionPointer=function(sessions,direction){var minutesAfterMidnight=this.dt.getHours()*60+this.dt.getMinutes();if(direction=="increment"){for(var i=0;i<sessions.length;i++){var session=sessions[i];if(minutesAfterMidnight<session.close){this.sessionPointer=i;if(minutesAfterMidnight<session.open){this.dt.setHours(Math.floor(session.open/60));this.dt.setMinutes(session.open-this.dt.getHours()*60);}else{var minutes=minutesAfterMidnight+(this.period-(minutesAfterMidnight-session.open)%this.period);this.dt.setHours(Math.floor(minutes/60));this.dt.setMinutes(minutes-this.dt.getHours()*60);}
return this.dt;}}
this.sessionPointer=sessions.length-1;}else{for(var i=sessions.length-1;i>-1;i--){var session=sessions[i];if(minutesAfterMidnight>=session.open){this.sessionPointer=i;if(minutesAfterMidnight<session.close){var minutes=minutesAfterMidnight-(minutesAfterMidnight-session.open)%this.period;this.dt.setHours(Math.floor(minutes/60));this.dt.setMinutes(minutes-this.dt.getHours()*60);return this.dt;}
var sessionLength=session.close-session.open;var minutes=session.open;if(sessionLength>this.period){minutes=session.close-(sessionLength%this.period);if(session.close==minutes)minutes=session.close-this.period;}
this.dt.setHours(Math.floor(minutes/60));this.dt.setMinutes(minutes-this.dt.getHours()*60);return this.dt;}}
this.sessionPointer=0;}
return this.dt;};STX.Market.Iterator.prototype.decrement=function(){if(this.interval=="minute"){var t1=this.dt.getTime();if(this.params.calendarAxis){this.dt=new timezoneJS.Date(t1-this.period*60*1000,this.market.timezone);return this.dt;}
t1-=this.period*60*1000;var past=new timezoneJS.Date(t1,this.market.timezone);var newSession=false;for(var i=0;i<20;i++){var day=past.getDay();var sessions=this.market.sessions[day];if(sessions.length==0){newSession=true;past.setDate(past.getDate()-1);this.sessionPointer=sessions.length-1;continue;}
var replaceSessions=this.market.getHoliday(past);if(replaceSessions)sessions=replaceSessions;if(sessions.length==0){newSession=true;past.setDate(past.getDate()-1);this.sessionPointer=sessions.length-1;continue;}
if(this.sessionPointer==null)past=this.initializeSessionPointer(sessions,"decrement");var minutesAfterMidnight=past.getHours()*60+past.getMinutes();var foundIt=false;for(;this.sessionPointer>-1;this.sessionPointer--){var session=sessions[this.sessionPointer];if(newSession){var sessionLength=session.close-session.open;var minutes=session.open;if(sessionLength>this.period){minutes=session.close-(sessionLength%this.period);if(session.close==minutes)minutes=session.close-this.period;}
past.setHours(Math.floor(minutes/60));past.setMinutes(minutes-past.getHours()*60);foundIt=true;break;}
if(!session.open&&!session.close){foundIt=true;break;}
if(minutesAfterMidnight>=session.open&&minutesAfterMidnight<session.close){foundIt=true;break;}
newSession=true;}
if(foundIt)break;past.setDate(past.getDate()-1);this.sessionPointer=sessions.length-1;}
this.dt=past;return this.dt;}else if(this.interval=="day"){for(var i=0;i<this.period;i++){this.dt.setDate(this.dt.getDate()-1);if(!this.params.calendarAxis)this.retreatToMarketDay();}}else if(this.interval=="week"){for(var i=0;i<this.period;i++){var day=this.dt.getDay();var inc=(7+day);this.dt.setDate(this.dt.getDate()-inc);if(!this.params.calendarAxis)this.advanceToMarketDay();}}else if(this.interval=="month"){for(var i=0;i<this.period;i++){this.dt.setDate(1);this.dt.setMonth(this.dt.getMonth()-1);if(!this.params.calendarAxis)this.advanceToMarketDay();}}
this.sessionPointer=0;return this.dt;};STX.convertTimeZone=function(dt,originalTimeZone,targetTimeZone){var newDT=new timezoneJS.Date(dt.getFullYear(),dt.getMonth(),dt.getDate(),dt.getHours(),dt.getMinutes(),dt.getSeconds(),dt.getMilliseconds(),originalTimeZone);newDT.setTimezone(targetTimeZone);return newDT;};STX.convertToLocalTime=function(dt,originalTimeZone){var seconds=dt.getSeconds();var milliseconds=dt.getMilliseconds();var newDT=new timezoneJS.Date(dt.getFullYear(),dt.getMonth(),dt.getDate(),dt.getHours(),dt.getMinutes(),originalTimeZone);return new Date(newDT.getTime()+ seconds*1000+ milliseconds);};STX.Market.NYSE_CLOSINGS=[{date:"01/02/2012"},{date:"01/16/2012"},{date:"02/20/2012"},{date:"04/06/2012"},{date:"05/28/2012"},{date:"07/04/2012"},{date:"09/03/2012"},{date:"10/29/2012"},{date:"10/30/2012"},{date:"11/22/2012"},{date:"12/25/2012"},{date:"01/01/2013"},{date:"01/21/2013"},{date:"02/18/2013"},{date:"03/29/2013"},{date:"05/27/2013"},{date:"07/04/2013"},{date:"09/02/2013"},{date:"11/28/2013"},{date:"12/25/2013"},{date:"01/01/2014"},{date:"01/20/2014"},{date:"02/17/2014"},{date:"04/18/2014"},{date:"05/26/2014"},{date:"07/04/2014"},{date:"09/01/2014"},{date:"11/27/2014"},{date:"12/25/2014"},{date:"01/01/2015"},{date:"01/19/2015"},{date:"02/16/2015"},{date:"04/03/2015"},{date:"05/25/2015"},{date:"07/03/2015"},{date:"09/07/2015"},{date:"11/26/2015"},{date:"12/25/2015"},{date:"01/01/2016"},{date:"07/03/2012",sessions:[{close:"13:00"}]},{date:"11/23/2012",sessions:[{close:"13:00"}]},{date:"12/24/2012",sessions:[{close:"13:00"}]},{date:"07/03/2013",sessions:[{close:"13:00"}]},{date:"11/29/2013",sessions:[{close:"13:00"}]},{date:"12/24/2013",sessions:[{close:"13:00"}]},{date:"07/03/2014",sessions:[{close:"13:00"}]},{date:"11/28/2014",sessions:[{close:"13:00"}]},{date:"12/24/2014",sessions:[{close:"13:00"}]},{date:"11/27/2015",sessions:[{close:"13:00"}]},{date:"12/24/2015",sessions:[{close:"13:00"}]}];STX.Market.NYSE={sessions:{"0":[],"6":[],"*":[{open:"09:30",close:"16:00"}]},closings:STX.Market.NYSE_CLOSINGS,timezone:"America/New_York"};STX.Market.GLOBEX={sessions:{"0":[{open:"15:00"}],"5":[{close:"18:00"}],"6":[],"*":[{}]},closings:STX.Market.NYSE_CLOSINGS,timezone:"America/New_York"};STX.Market.SHANGHAI={sessions:{"0":[],"6":[],"*":[{open:"09:30",close:"11:30"},{open:"13:00",close:"15:00"}]},closings:[{date:"01/01/14"},{date:"01/31/14"},{date:"02/03/14"},{date:"02/04/14"},{date:"02/05/14"},{date:"02/06/14"},{date:"04/07/14"},{date:"05/01/14"},{date:"05/02/14"},{date:"06/02/14"},{date:"09/08/14"},{date:"10/01/14"},{date:"10/02/14"},{date:"10/03/14"},{date:"10/06/14"},{date:"01/01/15"},{date:"01/02/15"},{date:"02/19/15"},{date:"02/20/15"},{date:"02/23/15"},{date:"02/24/15"},{date:"02/25/15"},{date:"04/06/15"},{date:"05/01/15"},{date:"06/22/15"},{date:"09/28/15"},{date:"10/01/15"},{date:"10/02/15"},{date:"10/05/15"},{date:"10/06/15"},{date:"10/07/15"},],timezone:"Asia/Hong_Kong"};STX.LegacyMarket=function(){};STX.LegacyMarket.isForexSymbol=function(symbol){if(!symbol)return false;if(symbol.indexOf(".")!=-1)return false;if(symbol.indexOf("^")!=0)return false;if(symbol.length>=6)return true;return false;};STX.LegacyMarket.isForexMetal=function(symbol,inverse){if(!symbol)return false;if(!STX.LegacyMarket.isForexSymbol(symbol))return false;if(",XAU,XPD,XPT,XAG,".indexOf(","+symbol.substr((inverse?4:1),3)+",")!=-1)return true;return false;};STX.LegacyMarket.isFuturesSymbol=function(symbol){if(!symbol)return false;if(symbol.indexOf("/")!=0)return false;return false;if(symbol.length>=2)return true;return false;};STX.LegacyMarket.isForexFuturesSymbol=function(symbol){if(STX.LegacyMarket.isForexSymbol(symbol))return true;if(STX.LegacyMarket.isFuturesSymbol(symbol))return true;return false;};STX.LegacyMarket.isMarketDay=function(symbol,nd){if(!nd)nd=STX.getETDateTime();if(STX.LegacyMarket.isForexFuturesSymbol(symbol)){if(nd.getDay()==6)return false;if(STX.LegacyMarket.isFuturesSymbol(symbol)){if(STX.LegacyMarket.isHoliday(nd,symbol))return false;}}else{if(nd.getDay()==0)return false;if(nd.getDay()==6)return false;if(STX.LegacyMarket.isHoliday(nd,symbol))return false;}
return true;};STX.LegacyMarket.isMarketOpen=function(symbol,stx){if(!STX.LegacyMarket.isMarketDay(symbol))return false;var nd=STX.getETDateTime();if(!stx){if((nd.getHours()>9||(nd.getHours()==9&&nd.getMinutes()>29))&&(nd.getHours()<16||(nd.getHours()==16&&nd.getMinutes()<5)))return true;}else{if((nd.getHours()>stx.chart.beginHour||(nd.getHours()==stx.chart.beginHour&&nd.getMinutes()>stx.chart.beginMinute))&&(nd.getHours()<stx.chart.endHour||(nd.getHours()==stx.chart.endHour&&nd.getMinutes()<stx.chart.endMinute+5)))return true;}
return false;};STX.LegacyMarket.isAfterMarket=function(symbol){if(!STX.LegacyMarket.isMarketDay(symbol))return false;var nd=STX.getETDateTime();if((nd.getHours()>16||(nd.getHours()==16&&nd.getMinutes()>0)))return true;return false;};STX.LegacyMarket.isAfterDelayed=function(symbol){if(!STX.LegacyMarket.isMarketDay(symbol))return false;var nd=STX.getETDateTime();if((nd.getHours()>16||(nd.getHours()==16&&nd.getMinutes()>20)))return true;return false;};STX.LegacyMarket.isForexOpen=function(dt,symbol){var isMetal=STX.LegacyMarket.isForexMetal(symbol);var nd=new Date();if(dt)nd=STX.convertTimeZone(dt,null,"America/New_York");if(nd.getDay()==6)return false;if(isMetal&&nd.getHours()==17&&nd.getMinutes()>=15)return false;if(nd.getDay()==5&&nd.getHours()>=17){if(!isMetal||nd.getHours()>17)return false;}
if(nd.getDay()==0&&isMetal&&nd.getHours()<=17)return false;if(nd.getDay()>=1&&nd.getDay()<5)return true;var nzDt=STX.convertTimeZone(nd,"America/New_York","Pacific/Auckland");if(nzDt.getDay()==0)return false;if(nzDt.getDay()==1&&nzDt.getHours()<8)return false;return true;};STX.LegacyMarket.getNextOpen=function(nd,symbol){var openDate=STX.convertTimeZone(nd,null,"America/New_York");if(!symbol)return openDate;var h,m;if(STX.LegacyMarket.isForexMetal(symbol)){h=18;m=0;}else if(STX.LegacyMarket.isForexSymbol(symbol)){var dt=STX.convertTimeZone(nd,null,"Australia/Sydney");dt.setHours(7);dt=STX.convertTimeZone(dt,"Australia/Sydney","America/New_York");h=dt.getHours();m=0;}else if(symbol.indexOf(".")>0){h=0;m=0;}else{h=9;m=30;}
var goBack1Day=(openDate.getHours()<h||(openDate.getHours()==h&&openDate.getMinutes()<m));openDate.setHours(h);openDate.setMinutes(m);openDate.setSeconds(0);openDate.setMilliseconds(0);if(goBack1Day)openDate=STX.LegacyMarket.decDate(openDate);openDate=STX.LegacyMarket.incDate(openDate);if(STX.LegacyMarket.isForexFuturesSymbol(symbol)&&!STX.LegacyMarket.isForexMetal(symbol)){while(openDate.getDay()!=0)openDate=STX.LegacyMarket.incDate(openDate);}
while(!STX.LegacyMarket.isMarketDay(symbol,openDate)){openDate=STX.LegacyMarket.incDate(openDate);}
return openDate;};STX.LegacyMarket.getPreviousClose=function(nd,symbol){var closeDate=STX.convertTimeZone(nd,null,"America/New_York");if(!symbol)return closeDate;var h,m;if(STX.LegacyMarket.isForexMetal(symbol)){h=17;m=15;}else if(STX.LegacyMarket.isForexSymbol(symbol)){h=17;m=0;}else if(symbol.indexOf(".")>0){h=23;m=59;}else{h=16;m=0;if(STX.LegacyMarket.isHalfDay(nd)){h=13;}}
var goForward1Day=(closeDate.getHours()>h||(closeDate.getHours()==h&&closeDate.getMinutes()>m));closeDate.setHours(h);closeDate.setMinutes(m);closeDate.setSeconds(0);closeDate.setMilliseconds(0);if(goForward1Day)closeDate=STX.LegacyMarket.incDate(closeDate);closeDate=STX.LegacyMarket.decDate(closeDate);if(STX.LegacyMarket.isForexFuturesSymbol(symbol)&&!STX.LegacyMarket.isForexMetal(symbol)){while(closeDate.getDay()!=5)closeDate=STX.LegacyMarket.decDate(closeDate);}
while(!STX.LegacyMarket.isMarketDay(symbol,closeDate)){closeDate=STX.LegacyMarket.decDate(closeDate);}
return closeDate;};STX.LegacyMarket.getHours=function(symbol,extended){if(!symbol){return{"beginHour":9,"beginMinute":30,"endHour":16,"endMinute":0};}else if(STX.LegacyMarket.isForexFuturesSymbol(symbol)){return{"beginHour":0,"beginMinute":0,"endHour":23,"endMinute":59};}else if(symbol.indexOf(".")>1){return{"beginHour":0,"beginMinute":0,"endHour":23,"endMinute":59};}else if(extended){return{"beginHour":8,"beginMinute":0,"endHour":20,"endMinute":0};}else{return{"beginHour":9,"beginMinute":30,"endHour":16,"endMinute":0};}};STX.LegacyMarket.holidayArray=[];STX.LegacyMarket.halfDayArray=[];STX.LegacyMarket.holidayHash={};STX.LegacyMarket.halfDayHash={};STX.LegacyMarket.initializeHolidays=function(){STX.LegacyMarket.hashOffset=STX.getETDateTime().getTimezoneOffset()*60000;STX.LegacyMarket.holidayArray.push(new Date("01/02/2012").getTime());STX.LegacyMarket.holidayArray.push(new Date("01/16/2012").getTime());STX.LegacyMarket.holidayArray.push(new Date("02/20/2012").getTime());STX.LegacyMarket.holidayArray.push(new Date("04/06/2012").getTime());STX.LegacyMarket.holidayArray.push(new Date("05/28/2012").getTime());STX.LegacyMarket.holidayArray.push(new Date("07/04/2012").getTime());STX.LegacyMarket.holidayArray.push(new Date("09/03/2012").getTime());STX.LegacyMarket.holidayArray.push(new Date("10/29/2012").getTime());STX.LegacyMarket.holidayArray.push(new Date("10/30/2012").getTime());STX.LegacyMarket.holidayArray.push(new Date("11/22/2012").getTime());STX.LegacyMarket.holidayArray.push(new Date("12/25/2012").getTime());STX.LegacyMarket.holidayArray.push(new Date("01/01/2013").getTime());STX.LegacyMarket.holidayArray.push(new Date("01/21/2013").getTime());STX.LegacyMarket.holidayArray.push(new Date("02/18/2013").getTime());STX.LegacyMarket.holidayArray.push(new Date("03/29/2013").getTime());STX.LegacyMarket.holidayArray.push(new Date("05/27/2013").getTime());STX.LegacyMarket.holidayArray.push(new Date("07/04/2013").getTime());STX.LegacyMarket.holidayArray.push(new Date("09/02/2013").getTime());STX.LegacyMarket.holidayArray.push(new Date("11/28/2013").getTime());STX.LegacyMarket.holidayArray.push(new Date("12/25/2013").getTime());STX.LegacyMarket.holidayArray.push(new Date("01/01/2014").getTime());STX.LegacyMarket.holidayArray.push(new Date("01/20/2014").getTime());STX.LegacyMarket.holidayArray.push(new Date("02/17/2014").getTime());STX.LegacyMarket.holidayArray.push(new Date("04/18/2014").getTime());STX.LegacyMarket.holidayArray.push(new Date("05/26/2014").getTime());STX.LegacyMarket.holidayArray.push(new Date("07/04/2014").getTime());STX.LegacyMarket.holidayArray.push(new Date("09/01/2014").getTime());STX.LegacyMarket.holidayArray.push(new Date("11/27/2014").getTime());STX.LegacyMarket.holidayArray.push(new Date("12/25/2014").getTime());STX.LegacyMarket.holidayArray.push(new Date("01/01/2015").getTime());STX.LegacyMarket.holidayArray.push(new Date("01/19/2015").getTime());STX.LegacyMarket.holidayArray.push(new Date("02/16/2015").getTime());STX.LegacyMarket.holidayArray.push(new Date("04/03/2015").getTime());STX.LegacyMarket.holidayArray.push(new Date("05/25/2015").getTime());STX.LegacyMarket.holidayArray.push(new Date("07/03/2015").getTime());STX.LegacyMarket.holidayArray.push(new Date("09/07/2015").getTime());STX.LegacyMarket.holidayArray.push(new Date("11/26/2015").getTime());STX.LegacyMarket.holidayArray.push(new Date("12/25/2015").getTime());STX.LegacyMarket.holidayArray.push(new Date("01/01/2016").getTime());STX.LegacyMarket.halfDayArray.push(new Date("07/03/2012").getTime());STX.LegacyMarket.halfDayArray.push(new Date("11/23/2012").getTime());STX.LegacyMarket.halfDayArray.push(new Date("12/24/2012").getTime());STX.LegacyMarket.halfDayArray.push(new Date("07/03/2013").getTime());STX.LegacyMarket.halfDayArray.push(new Date("11/29/2013").getTime());STX.LegacyMarket.halfDayArray.push(new Date("12/24/2013").getTime());STX.LegacyMarket.halfDayArray.push(new Date("07/03/2014").getTime());STX.LegacyMarket.halfDayArray.push(new Date("11/28/2014").getTime());STX.LegacyMarket.halfDayArray.push(new Date("12/24/2014").getTime());STX.LegacyMarket.halfDayArray.push(new Date("11/27/2015").getTime());STX.LegacyMarket.halfDayArray.push(new Date("12/24/2015").getTime());for(var i=0;i<STX.LegacyMarket.holidayArray.length;i++){var g=STX.LegacyMarket.holidayArray[i];var midnight=g-g%(24*60*60*1000);STX.LegacyMarket.holidayHash[midnight]=true;}
for(var i=0;i<STX.LegacyMarket.halfDayArray.length;i++){var g=STX.LegacyMarket.halfDayArray[i];var midnight=g-g%(24*60*60*1000);STX.LegacyMarket.halfDayHash[midnight]=true;}};if(timezoneJS)STX.LegacyMarket.initializeHolidays();STX.LegacyMarket.isHoliday=function(dt,symbol){var ms=dt.getTime()+ STX.LegacyMarket.hashOffset;ms=ms-ms%(24*60*60*1000);if(STX.LegacyMarket.holidayHash[ms]){return true;}
return false;};STX.LegacyMarket.isHalfDay=function(dt,symbol){var ms=dt.getTime()+ STX.LegacyMarket.hashOffset;ms=ms-ms%(24*60*60*1000);if(STX.LegacyMarket.halfDayHash[ms])return true;return false;};STX.LegacyMarket.incDate=function(dt,amt){if(!amt)amt=1;dt.setDate(dt.getDate()+ amt);return dt;};STX.LegacyMarket.decDate=function(dt,amt){if(!amt)amt=1;dt.setDate(dt.getDate()- amt);return dt;};STX.LegacyMarket.nextDay=function(dt,inc,stx){if(!inc)inc=1;var dt2=new Date(dt.getTime());for(var i=0;i<inc;i++){dt2=STX.LegacyMarket.incDate(dt2);if(!stx.calendarAxis){while(!STX.LegacyMarket.isMarketDay(stx.chart.symbol,dt2)){dt2=STX.LegacyMarket.incDate(dt2);}}}
return dt2;};STX.LegacyMarket.prevDay=function(dt,inc,stx){if(!inc)inc=1;var dt2=new Date(dt.getTime());for(var i=0;i<inc;i++){dt2=STX.LegacyMarket.decDate(dt2);if(!stx.calendarAxis){while(!STX.LegacyMarket.isMarketDay(stx.chart.symbol,dt2)){dt2=STX.LegacyMarket.decDate(dt2);}}}
return dt2;};STX.LegacyMarket.nextPeriod=function(dt,interval,inc,stx,symbol){if(!symbol)symbol=stx.chart.symbol;var t1=dt.getTime();var multiplier=interval;if(interval=="minute")multiplier=1;t1+=inc*multiplier*60*1000;var future=new Date(t1);if(!stx.calendarAxis){if(STX.LegacyMarket.isForexFuturesSymbol(symbol)){if(!STX.LegacyMarket.isForexOpen(future,symbol)){future=new Date(STX.LegacyMarket.getNextOpen(future,symbol));}}else{nyDate=STX.convertTimeZone(future,null,"America/New_York");var hours=STX.LegacyMarket.getHours(symbol,stx.layout.extended);var endHour=hours.endHour;if(symbol.indexOf(".")==-1&&STX.LegacyMarket.isHalfDay(nyDate)){endHour=13;}
if(nyDate.getHours()>endHour||(nyDate.getHours()==endHour&&nyDate.getMinutes()>=hours.endMinute)||nyDate.getHours()==0){return new Date(STX.LegacyMarket.getNextOpen(future,symbol));}}}
return future;};STX.LegacyMarket.prevPeriod=function(dt,interval,inc,stx,symbol){if(!symbol)symbol=stx.chart.symbol;var multiplier=interval;if(interval=="minute")multiplier=1;var t1=dt.getTime();t1-=inc*multiplier*60*1000;var past=new Date(t1);if(!stx.calendarAxis){if(STX.LegacyMarket.isForexFuturesSymbol(symbol)){if(!STX.LegacyMarket.isForexOpen(past,symbol)){past=new Date(STX.LegacyMarket.getPreviousClose(past,symbol));}}else{nyDate=STX.convertTimeZone(past,null,"America/New_York");var hours=STX.LegacyMarket.getHours(symbol,stx.layout.extended);var endHour=hours.endHour;if(symbol.indexOf(".")==-1&&STX.LegacyMarket.isHalfDay(nyDate)){endHour=13;}
if(nyDate.getHours()<hours.beginHour||(nyDate.getHours()==hours.beginHour&&nyDate.getMinutes()<hours.beginMinute)){return new Date(STX.LegacyMarket.getPreviousClose(past,symbol));}}}
return past;};STX.LegacyMarket.nextWeek=function(dt,inc,stx){var pd=new Date(dt.getTime());if(!inc)inc=1;for(var i=0;i<inc;i++){for(var j=0;j<14;j++){dt=STX.LegacyMarket.nextDay(dt,1,stx);if(dt.getDay()<=pd.getDay())break;}
if(j==14)console.log("nextWeek function skipped 14 days. Probably infinite loop. Check dates in dataSet.");pd=new Date(dt.getTime());}
return dt;};STX.LegacyMarket.prevWeek=function(dt,inc,stx){var pd=new Date(dt.getTime());if(!inc)inc=1;for(var i=0;i<inc;i++){if(pd.getDay()==0){dt=pd;dt.setDate(dt.getDate()-7);}else{while(1){dt=STX.LegacyMarket.prevDay(dt,1,stx);if(dt.getDay()<=pd.getDay())break;}}
pd=new Date(dt.getTime());}
return dt;};STX.LegacyMarket.nextMonth=function(dt,inc,stx){if(!inc)inc=1;for(var i=0;i<inc;i++){var pd=new Date(dt.getTime());while(1){dt=STX.LegacyMarket.nextDay(dt,1,stx);if(dt.getMonth()!=pd.getMonth())break;}}
return dt;};STX.LegacyMarket.prevMonth=function(dt,inc,stx){if(!inc)inc=1;for(var i=0;i<inc;i++){var pd=new Date(dt.getTime());while(1){dt=STX.LegacyMarket.prevDay(dt,1,stx);if(dt.getMonth()!=pd.getMonth())break;}}
return dt;};STX.LegacyMarket.beginDay=function(dt,stx){if(stx.chart.beginHour!=0){return stx.chart.beginHour*60+ stx.chart.beginMinute;}
if(dt.getDay()==0)return 15*60;return stx.chart.beginHour*60+ stx.chart.beginMinute;};STX.LegacyMarket.endDay=function(dt,stx){if(stx.chart.endHour!=0){return stx.chart.endHour*60+ stx.chart.endMinute;}
if(dt.getDay()==5)return 18*60;return stx.chart.endHour*60+ stx.chart.endMinute;};STX.LegacyMarket.isQuarterEnd=function(dt){if(dt.getMonth()==2){if(dt.getDate()==31)return true;if(dt.getDay()==5&&(dt.getDate()==30||dt.getDate()==29))return true;return false;}
if(dt.getMonth()==5){if(dt.getDate()==30)return true;if(dt.getDay()==5&&(dt.getDate()==29||dt.getDate()==28))return true;return false;}
if(dt.getMonth()==8){if(dt.getDate()==30)return true;if(dt.getDay()==5&&(dt.getDate()==29||dt.getDate()==28))return true;return false;}
if(dt.getMonth()==11){if(dt.getDate()==31)return true;if(dt.getDay()==5&&(dt.getDate()==29||dt.getDate()==30))return true;return false;}
return false;};STX.Studies=function(){};STX.Studies.actualOutputs=[];STX.Studies.studyPanelMap={};STX.Studies.colorPickerDiv=null;STX.Studies.StudyDescriptor=function(name,type,panel,inputs,outputs,parameters){this.name=name;this.type=type;this.panel=panel;this.inputs=inputs;this.outputs=outputs;this.libraryEntry=STX.Studies.studyLibrary[type];this.outputMap={};this.min=null;this.max=null;this.parameters=parameters;};STX.Studies.generateID=function(stx,studyName,inputs){var translatedStudy=studyName;if(stx)translatedStudy=stx.translateIf(translatedStudy);if(STX.isEmpty(inputs))return translatedStudy;id=translatedStudy+" (";var first=false;for(var field in inputs){if(!first){first=true;}else{id+=",";}
var val=inputs[field];id+=val;}
id+=")";return id;};STX.Studies.go=function(div,stx){var inputs={};var outputs={};var translatedStudy=div.study;if(stx)translatedStudy=stx.translateIf(translatedStudy);var inputItems=div.querySelectorAll(".inputTemplate");for(var i=0;i<inputItems.length;i++){if(inputItems[i].style.display!="none"){var field=inputItems[i].querySelectorAll(".stx-heading")[0].fieldName;var inputDOM=inputItems[i].querySelectorAll(".stx-data")[0].childNodes[0];var value=inputDOM.value;if(inputDOM.getAttribute("type")=="checkbox"){inputs[field]=inputDOM.checked;}else{inputs[field]=value;}}}
var outputItems=div.querySelectorAll(".outputTemplate");for(var i=0;i<outputItems.length;i++){if(outputItems[i].style.display!="none"){var field=outputItems[i].querySelectorAll(".stx-heading")[0].fieldName;if(typeof field!=="undefined"){var color=outputItems[i].querySelectorAll(".stx-color")[0].style.backgroundColor;if(!color||color=="")color="auto";outputs[field]=color;}}}
var parameters={};STX.Studies.getCustomParameters(div,parameters);parameters.replaceID=div.replaceID;var sd=STX.Studies.addStudy(div.stx,div.study,inputs,outputs,parameters);div.stx.draw();return sd;};STX.Studies.getCustomParameters=function(div,parameters){var sd=STX.Studies.studyLibrary[div.study];if(!sd)return;if(!sd.parameters)return;if(!sd.parameters.template)return;if(!sd.parameters.init)return;var template=div.querySelectorAll("#"+ sd.parameters.template)[0];if(!template)return;for(var field in sd.parameters.init){var el=template.querySelectorAll("#"+ field)[0];if(!el)continue;if(el.tagName=="INPUT"){if(el.type=="checkbox"){parameters[field]=el.checked;}else{parameters[field]=el.value;}}else{parameters[field]=el.style.backgroundColor;}}};STX.Studies.prepareStudy=function(stx,study,sd){if(typeof(study.calculateFN)=="undefined")study.calculateFN=STX.Studies.passToModulus;if(typeof(study.seriesFN)=="undefined")study.seriesFN=STX.Studies.displaySeriesAsLine;if(sd.chart.dataSet&&study.calculateFN)study.calculateFN(stx,sd);if(STX.isEmpty(sd.outputMap)){for(var i in sd.outputs){sd.outputMap[i+" "+ sd.name]=i;}}
if(study.overlay||sd.inputs["Overlay"]){stx.overlays[sd.name]=sd;}};STX.Studies.addStudy=function(stx,type,inputs,outputs,parameters,panel){if(!inputs)inputs={};if(!inputs.id)inputs.id=STX.Studies.generateID(stx,type,inputs);var study=STX.Studies.studyLibrary[type];if(!study)study={};if(!parameters)parameters={};if(!parameters.chartName)parameters.chartName="chart";var sd=null;if(study.initializeFN){sd=study.initializeFN(stx,type,inputs,outputs,parameters,panel);}else{sd=STX.Studies.initializeFN(stx,type,inputs,outputs,parameters,panel);}
sd.chart=stx.charts[parameters.chartName];if(!sd)return;if(!stx.layout.studies)stx.layout.studies={};stx.layout.studies[sd.inputs["id"]]=sd;stx.changeOccurred("layout");STX.Studies.prepareStudy(stx,study,sd);sd.study=study;sd.type=type;if(stx.editCallback){var hasInput=false;for(var input in sd.inputs){if(input=="id")continue;if(input=="display")continue;hasInput=true;}
if(!hasInput){for(var output in sd.outputs){hasInput=true;}}
if(hasInput){if(sd.libraryEntry&&typeof sd.libraryEntry.edit!="undefined"){if(sd.libraryEntry.edit){var editFunction=(function(stx,sd,inputs,outputs){return function(){sd.library.edit(sd,{inputs:inputs,outputs:outputs,parameters:parameters});};})(stx,sd,inputs,outputs,parameters);var panel=stx.panels[sd.panel];stx.setPanelEdit(panel,editFunction);}}else if(sd.libraryEntry&&sd.libraryEntry.overlay){var editFunction=(function(stx,sd,inputs,outputs){return function(){var dialogDiv=stx.editCallback(stx,sd);STX.Studies.studyDialog(stx,type,dialogDiv,{inputs:inputs,outputs:outputs,parameters:parameters});};})(stx,sd,inputs,outputs,parameters);}else{var editFunction=(function(stx,sd,inputs,outputs){return function(){var dialogDiv=stx.editCallback(stx,sd);STX.Studies.studyDialog(stx,type,dialogDiv,{inputs:inputs,outputs:outputs,parameters:parameters});};})(stx,sd,inputs,outputs,parameters);var panel=stx.panels[sd.panel];if(panel.name!="chart"){stx.setPanelEdit(panel,editFunction);}}}}
return sd;};STX.Studies.quickAddStudy=function(stx,studyName,inputs,outputs,parameters){if(!parameters)parameters={};var sl=STX.Studies.studyLibrary[studyName];if(!inputs&&sl)inputs=sl.inputs;if(!inputs)inputs={};if(!outputs&&sl)outputs=sl.outputs;if(!outputs)outputs={"Result":"auto"};var sd=STX.Studies.addStudy(stx,studyName,inputs,outputs,parameters);stx.draw();return sd;};STX.Studies.removeStudy=function(stx,sd){if(sd.libraryEntry&&sd.libraryEntry.overlay){stx.removeOverlay(sd.name);stx.draw();}else{var panel=stx.panels[sd.panel];if(panel)
stx.panelClose(panel);}};STX.Studies.studyDialog=function(stx,study,div,override){div.study=study;div.stx=stx;if(override&&override.inputs&&override.inputs["id"])
div.replaceID=override.inputs["id"];else if(div.replaceID)
delete div.replaceID;var chart=stx.chart;var divInputs=div.querySelectorAll("#inputs")[0];var inputItems=divInputs.querySelectorAll(".inputTemplate");for(var i=0;i<inputItems.length;i++){if(inputItems[i].style.display!="none"){divInputs.removeChild(inputItems[i]);}}
var divOutputs=div.querySelectorAll("#outputs")[0];var outputItems=divOutputs.querySelectorAll(".outputTemplate");for(var i=0;i<outputItems.length;i++){if(outputItems[i].style.display!="none"){divOutputs.removeChild(outputItems[i]);}}
var sd=STX.Studies.studyLibrary[study];if(!sd)sd={};if(typeof(sd.inputs)=="undefined")sd.inputs={"Period":14};if(typeof(sd.outputs)=="undefined")sd.outputs={"Result":"auto"};for(var i in sd.inputs){var newInput=inputItems[0].cloneNode(true);divInputs.appendChild(newInput);newInput.style.display="block";newInput.querySelectorAll(".stx-heading")[0].innerHTML=stx.translateIf(i);newInput.querySelectorAll(".stx-heading")[0].fieldName=i;var formField=null;var acceptedData=sd.inputs[i];var defaultValue=(override&&override.inputs&&override.inputs[i]!=null)?override.inputs[i]:acceptedData;if(acceptedData.constructor==Number){formField=document.createElement("input");formField.setAttribute("type","number");formField.value=defaultValue;}else if(acceptedData.constructor==String){if(acceptedData=="ma"||acceptedData=="ema"){formField=document.createElement("select");var option;option=document.createElement("OPTION");option.value="simple";option.text=stx.translateIf("Simple");formField.add(option,null);option=document.createElement("OPTION");option.value="exponential";option.text=stx.translateIf("Exponential");formField.add(option,null);option=document.createElement("OPTION");option.value="time series";option.text=stx.translateIf("Time Series");formField.add(option,null);option=document.createElement("OPTION");option.value="triangular";option.text=stx.translateIf("Triangular");formField.add(option,null);option=document.createElement("OPTION");option.value="variable";option.text=stx.translateIf("Variable");formField.add(option,null);option=document.createElement("OPTION");option.value="vidya";option.text=stx.translateIf("VIDYA");formField.add(option,null);option=document.createElement("OPTION");option.value="weighted";option.text=stx.translateIf("Weighted");formField.add(option,null);option=document.createElement("OPTION");option.value="welles wilder";option.text=stx.translateIf("Welles Wilder");formField.add(option,null);formField.value=defaultValue;if(defaultValue=="ema")formField.selectedIndex=1;}else if(acceptedData=="field"){formField=document.createElement("select");var count=0;for(var field in chart.dataSet[chart.dataSet.length-1]){if(["Open","High","Low","Close","Adj_Close"].indexOf(field)==-1){if(field=="Volume"){if(!stx.panels["vchart"])continue;}
else if(STX.Studies.actualOutputs.indexOf(field)==-1)continue;}
var option=document.createElement("OPTION");option.value=field;option.text=stx.translateIf(field);formField.add(option,null);if(field=="Close")formField.selectedIndex=count;count++;}
if(defaultValue!="field"){formField.value=defaultValue;}}else{formField=document.createElement("input");formField.type="text";formField.value=defaultValue;}}else if(acceptedData.constructor==Boolean){formField=document.createElement("input");formField.setAttribute("type","checkbox");if(defaultValue==true||defaultValue=="true")formField.checked=true;}else if(acceptedData.constructor==Array){formField=document.createElement("select");for(var i=0;i<acceptedData.length;i++){var option=document.createElement("OPTION");option.value=acceptedData[i];option.text=acceptedData[i];formField.add(option,null);}
if(defaultValue.constructor!=Array){formField.value=defaultValue;}}
if(formField)newInput.querySelectorAll(".stx-data")[0].appendChild(formField);}
for(var i in sd.outputs){var newOutput=outputItems[0].cloneNode(true);divOutputs.appendChild(newOutput);newOutput.style.display="block";newOutput.querySelectorAll(".stx-heading")[0].innerHTML=stx.translateIf(i);newOutput.querySelectorAll(".stx-heading")[0].fieldName=i;var colorClick=newOutput.querySelectorAll(".stx-color")[0];var value=sd.outputs[i];if(override&&override.outputs&&override.outputs[i])value=override.outputs[i];if(value!="auto"){colorClick.style.backgroundColor=value;STX.unappendClassName(colorClick,"stxColorDarkChart");}else{if(stx.defaultColor=="#FFFFFF")STX.appendClassName(colorClick,"stxColorDarkChart");}
STX.attachColorPicker(colorClick,div);}
var parametersEL=div.querySelectorAll("#parameters")[0];if(parametersEL){STX.clearNode(parametersEL);if(sd.parameters&&sd.parameters.template&&sd.parameters.init){if(sd.parameters.condition&&!sd.parameters.condition(stx))return;var template=document.querySelectorAll("#"+ sd.parameters.template)[0];if(template){template=template.cloneNode(true);template.style.display="block";parametersEL.appendChild(template);for(var field in sd.parameters.init){var value=sd.parameters.init[field];if(override&&override.parameters&&(override.parameters[field]||override.parameters[field]==false))value=override.parameters[field];var el=template.querySelectorAll("#"+ field)[0];if(!el)continue;if(el.tagName=="INPUT"){if(el.type=="checkbox"){el.checked=(value==true||value=="true");}else{el.value=value;}}else{if(value=="auto"){value="";if(stx.defaultColor=="#FFFFFF")STX.appendClassName(el,"stxColorDarkChart");}else{STX.unappendClassName(el,"stxColorDarkChart");}
el.style.backgroundColor=value;STX.attachColorPicker(el,div);}}}}}};STX.Studies.displayStudies=function(stx){var s=stx.layout.studies;if(!s)return;for(var panelName in stx.panels){stx.panels[panelName].min=null;stx.panels[panelName].axisDrawn=false;}
for(var n in s){var sd=s[n];var panel=stx.panels[sd.panel];if(panel){if(panel.hidden)continue;if(sd.permanent){if(panel.closeX){panel.closeX.style.display="none";}else{panel.close.style.display="none";}}}
var libraryEntry=STX.Studies.studyLibrary[sd.type];var quotes=sd.chart.dataSegment;if(!libraryEntry||typeof(libraryEntry.seriesFN)=="undefined"){STX.Studies.displaySeriesAsLine(stx,sd,quotes);}else{if(libraryEntry.seriesFN){if(panel)libraryEntry.seriesFN(stx,sd,quotes);}}}};STX.Studies.calculateMinMaxForDataPoint=function(stx,name,quotes){var min=Number.MAX_VALUE;var max=Number.MIN_VALUE;for(var i=0;i<quotes.length;i++){var m=quotes[i][name];if(typeof m=="undefined"||m==null)continue;if(isNaN(m))continue;min=Math.min(m,min);max=Math.max(m,max);}
return{"min":min,"max":max};};STX.Studies.determineMinMax=function(stx,sd,quotes){var panel=stx.panels[sd.panel];if(!panel)return;if(panel.min==null){if(sd.min==null){if(sd.libraryEntry&&sd.libraryEntry.range=="0 to 100"){panel.min=0;panel.max=100;}else if(sd.libraryEntry&&sd.libraryEntry.range=="-1 to 1"){panel.min=-1;panel.max=1;}else if(!sd.libraryEntry||sd.libraryEntry.range!="bypass"){panel.min=Number.MAX_VALUE;panel.max=Number.MIN_VALUE;for(var i=0;i<quotes.length;i++){var quote=quotes[i];if(!quote)continue;for(var j in sd.outputMap){var m=quote[j];if(typeof m=="undefined"||m==null)continue;if(isNaN(m))continue;panel.min=Math.min(m,panel.min);panel.max=Math.max(m,panel.max);}
for(var h=0;h<=5;h++){var m=quote[sd.name+"_hist"+(h?h:"")];if(typeof m=="undefined"||m==null)continue;if(isNaN(m))continue;panel.min=Math.min(m,panel.min);panel.max=Math.max(m,panel.max);}}}
if(sd.libraryEntry&&sd.libraryEntry.range=="0 to max"){panel.min=0;}}else{panel.min=sd.min;panel.max=sd.max;}}
panel.shadow=panel.max-panel.min;if(panel.max>0&&panel.min<0)panel.shadow=panel.max+ panel.min*-1;panel.yAxis.high=panel.max;panel.yAxis.low=panel.min;panel.yAxis.shadow=panel.yAxis.high-panel.yAxis.low;};STX.Studies.createYAxis=function(stx,sd,quotes,panel){if(!panel.axisDrawn){panel.height=panel.bottom-panel.top;STX.Studies.determineMinMax(stx,sd,quotes);panel.yAxis.displayGridLines=false;if(sd.libraryEntry&&sd.libraryEntry.yaxis){var parameters={"dontDraw":true};stx.createYAxis(panel,parameters);stx.drawYAxis(panel,parameters);sd.libraryEntry.yaxis(stx,sd);}else{var parameters={"noDraw":(sd.parameters&&sd.parameters.studyOverZonesEnabled)};if(sd.libraryEntry.range=="0 to 100")parameters.range=[0,100];else if(sd.libraryEntry.range=="-1 to 1")parameters.range=[-1,1];stx.createYAxis(panel,parameters);stx.drawYAxis(panel,parameters);}
if(sd.libraryEntry&&sd.libraryEntry.centerline){STX.Studies.drawHorizontal(stx,sd,quotes,sd.libraryEntry.centerline);}else if(panel.min<0&&panel.max>0){STX.Studies.drawHorizontal(stx,sd,quotes,0);}
panel.axisDrawn=true;}};STX.Studies.displaySeriesAsLine=function(stx,sd,quotes){if(quotes.length==0)return;var panel=stx.panels[sd.panel];if(!panel)return;if(panel.hidden==true)return;if(panel.name!=sd.chart.name){STX.Studies.createYAxis(stx,sd,quotes,panel);}
for(var i in sd.outputMap){STX.Studies.displayIndividualSeriesAsLine(stx,sd,panel,i,quotes);}
STX.Studies.drawZones(stx,sd,quotes);};STX.Studies.fillArea=function(stx,points,color,opacity){if(points.length==0)return;stx.chart.context.lineWidth=0;var globalAlpha=stx.chart.context.globalAlpha;if(opacity==null)opacity=0.1;stx.chart.context.globalAlpha=opacity;if(color=="auto")color=stx.defaultColor;stx.chart.context.fillStyle=color;stx.chart.context.beginPath();stx.chart.context.moveTo(points[0][0],points[0][1]);for(var i=1;i<points.length;i++){stx.chart.context.lineTo(points[i][0],points[i][1]);}
stx.chart.context.closePath();stx.chart.context.fill();stx.chart.context.lineWidth=1;stx.chart.context.globalAlpha=globalAlpha;};STX.Studies.displayIndividualSeriesAsLine=function(stx,sd,panel,name,quotes){if(!panel.height)panel.height=panel.bottom-panel.top;STX.Studies.studyPanelMap[name]=panel.name;var context=stx.chart.context;context.lineWidth=1;if(sd.highlight)context.lineWidth=3;var color=sd.outputs[sd.outputMap[name]];if(color=="auto")color=stx.defaultColor;context.strokeStyle=color;var labelDecimalPlaces=0;if(panel.yAxis.shadow<1000)labelDecimalPlaces=2;if(panel.yAxis.shadow<5)labelDecimalPlaces=4;if(!sd.libraryEntry||sd.libraryEntry.overlay)labelDecimalPlaces=null;stx.plotLineChart(panel,quotes,name,{skipTransform:stx.panels[sd.panel].name!=sd.chart.name,label:stx.preferences.labels,labelDecimalPlaces:labelDecimalPlaces,noSlopes:sd.libraryEntry&&sd.libraryEntry.parameters&&sd.libraryEntry.parameters.noSlopes});if(sd.libraryEntry&&sd.libraryEntry.appendDisplaySeriesAsLine)sd.libraryEntry.appendDisplaySeriesAsLine(stx,sd,quotes,name,panel);};STX.Studies.drawHorizontal=function(stx,sd,quotes,price){var panel=stx.panels[sd.name];if(!panel)return;var y=stx.pixelFromPrice(price,panel);stx.plotLine(stx.chart.left,stx.chart.width,y,y,"#DDDDDD","line",stx.chart.context,false,{});};STX.Studies.displayKlinger=function(stx,sd,quotes){var panel=stx.panels[sd.panel];STX.Studies.createYAxis(stx,sd,quotes,panel);STX.Studies.createHistogram(stx,sd,quotes);STX.Studies.displaySeriesAsLine(stx,sd,quotes);};STX.Studies.calculateKlinger=function(stx,sd){var quotes=sd.chart.scrubbed;sd.tp=new STX.Studies.StudyDescriptor(sd.name,"typical price",sd.panel);sd.tp.chart=sd.chart;sd.tp.days=1;sd.tp.outputs={"Typ Price":null};STX.Studies.calculateTypicalPrice(stx,sd.tp);var field=sd.name+"_hist",klinger="Klinger "+ sd.name,klingerSignal="KlingerSignal "+ sd.name,signedVolume="SV "+ sd.name,shortEMA="EMA-S "+ sd.name,longEMA="EMA-L "+ sd.name;for(var i=1;i<quotes.length;i++){var sv=quotes[i].Volume;if(quotes[i]["Typ Price "+sd.name]<quotes[i-1]["Typ Price "+sd.name])sv*=-1;quotes[i][signedVolume]=sv;}
sd.ema1=new STX.Studies.StudyDescriptor(sd.name,"ma",sd.panel);sd.ema1.chart=sd.chart;sd.ema1.days=Number(sd.inputs["Short Cycle"]);sd.ema1.inputs={"Field":signedVolume,"Type":"exponential"};sd.ema1.outputs={"EMA-S":null};STX.Studies.calculateMovingAverageExponential(stx,sd.ema1);sd.ema2=new STX.Studies.StudyDescriptor(sd.name,"ma",sd.panel);sd.ema2.chart=sd.chart;sd.ema2.days=Number(sd.inputs["Long Cycle"]);sd.ema2.inputs={"Field":signedVolume,"Type":"exponential"};sd.ema2.outputs={"EMA-L":null};STX.Studies.calculateMovingAverageExponential(stx,sd.ema2);for(var i=Number(sd.inputs["Long Cycle"]);i<quotes.length;i++){quotes[i][klinger]=quotes[i][shortEMA]-quotes[i][longEMA];}
sd.ema3=new STX.Studies.StudyDescriptor(sd.name,"ma",sd.panel);sd.ema3.chart=sd.chart;sd.ema3.days=Number(sd.inputs["Signal Periods"]);sd.ema3.inputs={"Field":klinger,"Type":"exponential"};sd.ema3.outputs={"KlingerSignal":sd.outputs["KlingerSignal"]};STX.Studies.calculateMovingAverageExponential(stx,sd.ema3);for(var i=0;i<quotes.length;i++){quotes[i][field]=quotes[i][klinger]-quotes[i][klingerSignal];}};STX.Studies.displayMACD=function(stx,sd,quotes){var panel=stx.panels[sd.panel];STX.Studies.createYAxis(stx,sd,quotes,panel);STX.Studies.createHistogram(stx,sd,quotes,false);STX.Studies.displaySeriesAsLine(stx,sd,quotes);};STX.Studies.displayPSAR2=function(stx,sd,quotes){stx.startClip(sd.panel);var squareWave=(sd.inputs["Plot Type"]=="squarewave");for(var output in sd.outputs){var field=output+" "+ sd.name;stx.chart.context.beginPath();for(var x=0;x<quotes.length;x++){var quote=quotes[x];if(quote==null||quote[field]==null)continue;if(stx.panels[sd.panel].name==sd.chart.name&&quote.transform)quote=quote.transform;var x0=stx.computePosition(x,0);var y0=stx.pixelFromPrice(quote[field],stx.panels[sd.panel]);if(x==0||!quotes[x-1]||quotes[x-1][field]==null){stx.chart.context.moveTo(x0,y0);}
if(squareWave){stx.chart.context.lineTo(x0,y0);stx.chart.context.lineTo(x0+stx.layout.candleWidth,y0);if(quotes[x+1]){var quote_1=quotes[x+1];if(stx.panels[sd.panel].name==sd.chart.name&&quote_1.transform)quote_1=quote_1.transform;if(quote_1[field]==null){stx.chart.context.lineTo(x0+stx.layout.candleWidth,stx.pixelFromPrice(quote_1[sd.referenceOutput+" "+ sd.name],stx.panels[sd.panel]));}}}else{stx.chart.context.moveTo(x0,y0);stx.chart.context.lineTo(x0+3,y0);}}
stx.chart.context.lineWidth=1;if(sd.highlight)stx.chart.context.lineWidth=3;var color=sd.outputs[output];if(color=="auto")color=stx.defaultColor;stx.chart.context.strokeStyle=color;stx.chart.context.stroke();stx.chart.context.closePath();}
stx.endClip();};STX.Studies.createHistogram=function(stx,sd,quotes,centered){var panel=stx.panels[sd.name];var myWidth=stx.layout.candleWidth-2;if(myWidth<2)myWidth=1;var y=stx.pixelFromPrice(0,panel);if(centered){y=Math.floor(panel.top+ panel.height/2);}
var context=stx.chart.context;var field=sd.name+"_hist";stx.canvasColor("stx_histogram");var negativeOffset=(stx.tmpWidth-stx.layout.candleWidth)/2;
for(var i=0;i<quotes.length;i++){var quote=quotes[i];if(quote==null)continue;var x0=Math.floor(stx.computePosition(i,1)+negativeOffset);var x1=Math.floor(myWidth);var y1=Math.floor(stx.pixelFromPrice(quote[field],panel)-y);context.fillRect(x0,y,x1,y1);}
context.globalAlpha=1;};STX.Studies.volumeChart=function(stx,sd,colorMap,borderMap){var maximum=Number.MIN_VALUE;for(var color in colorMap){for(var i=0;i<colorMap[color].length;i++){var value=colorMap[color][i];if(value==null)continue;if(value>maximum)maximum=value;}}
var panel=stx.panels[sd.name];var b=Math.floor(panel.yAxis.bottom)+.5;var t=Math.floor(panel.yAxis.top)+.5;var h=(b-t);var candleWidth=stx.layout.candleWidth;var negativeOffset=(stx.tmpWidth-candleWidth)/2;
var multiplier=panel.height/maximum;var borderColor=null;var context=stx.chart.context;for(var color in colorMap){if(borderMap)borderColor=borderMap[color];context.fillStyle=color;if(borderColor)context.strokeStyle=borderColor;context.beginPath();var prevTop=b+.5;var farLeft=(borderMap?.5:0);var prevRight=farLeft;for(var i=0;i<colorMap[color].length;i++){var value=colorMap[color][i];if(value==null){prevTop=b;prevRight+=candleWidth;continue;}
var y=value*(h/maximum);var top=Math.min(Math.floor((b- h)+(h- y))+.5,b);if(borderMap){var x0=Math.floor(prevRight+Math.floor(negativeOffset))+.5;var x1=Math.floor(prevRight+candleWidth+Math.floor(negativeOffset))+.5;x0=Math.max(x0,farLeft);}else{var x0=Math.floor(i*candleWidth);var x1=x0+stx.tmpWidth;}
context.moveTo(x0+.5,b);context.lineTo(x1,b);context.lineTo(x1,top);context.lineTo(x0,top);if(borderMap){if(prevTop>top||i==0)context.lineTo(x0,prevTop);}else{context.lineTo(x0,b);}
prevTop=top;prevRight+=candleWidth;}
context.fill();context.strokeStyle=borderColor;if(borderMap)context.stroke();context.closePath();}};STX.Studies.prettify={"Close":"C","Open":"O","High":"H","Low":"L",",simple":"","simple":"","exponential":"ema","time series":"ts","triangular":"tri","variable":"var","VIDYA":"vidya","weighted":"wa","welles wilder":"ww"};STX.Studies.prettyRE=/^.*\((.*?)\).*$/;STX.Studies.prettyDisplay=function(id){var match=STX.Studies.prettyRE.exec(id);if(!match)return id;var guts=match[1];if(guts){for(var i in STX.Studies.prettify){guts=guts.replace(i,STX.Studies.prettify[i]);}
id=id.replace(match[1],guts);}
return id;};STX.Studies.initializeFN=function(stx,type,inputs,outputs,parameters,panel){function determinePanelForOverlay(inputs,parameters){var panel=null;if(inputs["Field"]){panel=STX.Studies.studyPanelMap[inputs["Field"]];if(inputs["Field"]=="Volume")panel="vchart";}
if(!panel)panel=parameters.chartName;return panel;}
if(!inputs)inputs={id:type};if(!parameters)parameters={};if(!inputs.display)inputs.display=STX.Studies.prettyDisplay(inputs.id);var sd=new STX.Studies.StudyDescriptor(inputs.id,type,inputs.id,inputs,outputs,parameters);if(inputs["Period"])sd.days=parseFloat(sd.inputs["Period"]);var study=STX.Studies.studyLibrary[type];if(study&&study.display)inputs.display=study.display;var panelName=panel;if(!panelName)panelName=inputs.id;var isOverlay=(study&&study.overlay)||inputs["Overlay"];if(parameters.replaceID&&(stx.panelExists(parameters.replaceID)||isOverlay)){if(isOverlay){sd.panel=determinePanelForOverlay(inputs,parameters);delete stx.layout.studies[parameters.replaceID];delete stx.overlays[parameters.replaceID];}else{sd.panel=panelName;var newPanels={};for(var p in stx.panels){if(p!=parameters.replaceID){newPanels[p]=stx.panels[p];}else{var tmp=stx.panels[p];tmp.name=panelName;tmp.display=inputs.display;newPanels[panelName]=tmp;}}
stx.panels=newPanels;delete stx.layout.studies[parameters.replaceID];if(panelName!=parameters.replaceID){for(var s in stx.layout.studies){var st=stx.layout.studies[s];if(st.panel==parameters.replaceID)
delete stx.layout.studies[s];}}}
delete parameters.replaceID;}else if(stx.panelExists(panelName)){sd.panel=panelName;}else if(!isOverlay){stx.createPanel(inputs.display,inputs.id,null,parameters.chartName);}else{sd.panel=determinePanelForOverlay(inputs,parameters);}
var panel=stx.panels[sd.panel];if(panel&&panel.chart.name!=panel.name){if(study&&study.parameters&&(study.parameters.zoom||study.parameters.zoom==0)){panel.yAxis.zoom=study.parameters.zoom;}else{panel.yAxis.zoom=10;}}
return sd;};STX.Studies.initializeStochastics=function(stx,type,inputs,outputs){inputs.display="Stoch ("+ inputs["Period"]+")";return STX.Studies.initializeFN.apply(null,arguments);};STX.Studies.calculateVolume=function(stx,sd){if(sd.name=="vchart"){stx.setStyle("stx_volume_up","color",sd.outputs["Up Volume"]);stx.setStyle("stx_volume_down","color",sd.outputs["Down Volume"]);}else{if(!stx||!stx.chart.dataSet)return;var remove=sd.parameters["removeStudy"];stx.layout.volumeUnderlay=!remove;stx.changeOccurred("layout");if(remove){STX.Studies.removeStudy(stx,sd);}else{stx.setStyle("stx_volume_underlay_up","color",sd.outputs["Up Volume"]);stx.setStyle("stx_volume_underlay_down","color",sd.outputs["Down Volume"]);}}};STX.Studies.overZones=function(stx,sd,quotes){if(quotes.length==0)return;var panel=stx.panels[sd.panel];if(!panel)return;if(panel.hidden==true)return;STX.Studies.displaySeriesAsLine(stx,sd,quotes);if(sd.parameters&&sd.parameters.studyOverZonesEnabled){var overBought=parseFloat(sd.parameters.studyOverBoughtValue),overSold=parseFloat(sd.parameters.studyOverSoldValue);var ypx=panel.height/panel.shadow;var overBoughtY=panel.bottom-ypx*overBought;var overSoldY=panel.bottom-ypx*overSold;var parameters={lineWidth:1};stx.chart.context.globalAlpha=.2;stx.plotLine(0,stx.chart.width-5,overBoughtY,overBoughtY,sd.parameters.studyOverBoughtColor,"segment",stx.chart.context,false,parameters);stx.chart.context.globalAlpha=.2;stx.plotLine(0,stx.chart.width-5,overSoldY,overSoldY,sd.parameters.studyOverSoldColor,"segment",stx.chart.context,false,parameters);if(!sd.libraryEntry.yaxis){var fontHeight=stx.getCanvasFontSize("stx_yaxis");stx.canvasFont("stx_yaxis");stx.canvasColor("stx_yaxis");stx.chart.context.fillText(overBought,stx.chart.width,overBoughtY+(fontHeight/2));stx.chart.context.fillText(overSold,stx.chart.width,overSoldY+(fontHeight/2));panel.axisDrawn=true;}}};STX.Studies.calculateMACD=function(stx,sd){STX.Studies._calculateMACD(stx,sd);};STX.Studies.calculateRSI=function(stx,sd){STX.Studies._calculateRSI(stx,sd);};STX.Studies.calculateStochastics=function(stx,sd){STX.Studies._calculateStochastics(stx,sd);};STX.Studies.passToModulus=function(stx,sd){if(!stx.masterData||stx.masterData.length===0){return;}
STX.Studies._passToModulus(stx,sd);};STX.Studies.calculateMovingAverage=function(stx,sd){STX.Studies._calculateMovingAverage(stx,sd);};STX.Studies.studyLibrary={"rsi":{"inputs":{"Period":14},"calculateFN":STX.Studies.calculateRSI,"range":"0 to 100","outputs":{"RSI":"auto"},"parameters":{template:"studyOverZones",init:{studyOverZonesEnabled:true,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},"ma":{"overlay":true,"range":"bypass","calculateFN":STX.Studies.calculateMovingAverage,"inputs":{"Period":50,"Field":"field","Type":"ma"},"outputs":{"MA":"#FF0000"}},"macd":{"calculateFN":STX.Studies.calculateMACD,"seriesFN":STX.Studies.displayMACD,"inputs":{"Fast MA Period":12,"Slow MA Period":26,"Signal Period":9},"outputs":{"MACD":"auto","Signal":"#FF0000"}},"stochastics":{"range":"0 to 100","initializeFN":STX.Studies.initializeStochastics,"calculateFN":STX.Studies.calculateStochastics,"inputs":{"Period":14,"Smooth":true},"outputs":{"Fast":"auto","Slow":"#FF0000"},"parameters":{template:"studyOverZones",init:{studyOverZonesEnabled:true,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},"correl":{"range":"-1 to 1","calculateFN":function(stx,sd){return STX.Studies.calculateCorrelationCoefficient(stx,sd);},"edit":null},"Aroon":{"range":"0 to 100","calculateFN":function(stx,sd){return STX.Studies.calculateAroon(stx,sd);},"outputs":{"Aroon Up":"#00DD00","Aroon Down":"#FF0000"}},"Aroon Osc":{"calculateFN":function(stx,sd){return STX.Studies.calculateAroon(stx,sd);},"outputs":{"Aroon Oscillator":"auto"}},"Lin R2":{"calculateFN":function(stx,sd){return STX.Studies.calculateLinearRegressionIndicator(stx,sd);},"inputs":{"Period":14,"Field":"field"},"outputs":{"RSquared":"auto"}},"Lin Fcst":{"overlay":true,"calculateFN":function(stx,sd){return STX.Studies.calculateLinearRegressionIndicator(stx,sd);},"inputs":{"Period":14,"Field":"field"},"outputs":{"Forecast":"auto"}},"Lin Incpt":{"overlay":true,"calculateFN":function(stx,sd){return STX.Studies.calculateLinearRegressionIndicator(stx,sd);},"inputs":{"Period":14,"Field":"field"},"outputs":{"Intercept":"auto"}},"Time Fcst":{"overlay":true,"calculateFN":function(stx,sd){return STX.Studies.calculateLinearRegressionIndicator(stx,sd);},"inputs":{"Period":14,"Field":"field"},"outputs":{"Forecast":"auto"}},"VT HZ Filter":{"calculateFN":function(stx,sd){return STX.Studies.calculateVerticalHorizontalFilter(stx,sd);},"inputs":{"Period":28}},"TRIX":{"calculateFN":function(stx,sd){return STX.Studies.calculateTRIX(stx,sd);}},"STD Dev":{"calculateFN":function(stx,sd){return STX.Studies.calculateStandardDeviation(stx,sd);},"inputs":{"Period":14,"Field":"field","Standard Deviations":2,"Moving Average Type":"ma"}},"Trade Vol":{"calculateFN":function(stx,sd){return STX.Studies.calculateOnBalanceVolume(stx,sd);},"inputs":{"Field":"field","Min Tick Value":.5}},"Swing":{"calculateFN":function(stx,sd){return STX.Studies.calculateSwingIndex(stx,sd);},"inputs":{"Limit Move Value":.5}},"Acc Swing":{"calculateFN":function(stx,sd){return STX.Studies.calculateSwingIndex(stx,sd);},"inputs":{"Limit Move Value":.5}},"Price ROC":{"calculateFN":function(stx,sd){return STX.Studies.calculateRateOfChange(stx,sd);},"inputs":{"Field":"field","Period":14}},"Vol ROC":{"calculateFN":function(stx,sd){return STX.Studies.calculateRateOfChange(stx,sd);}},"Momentum":{"calculateFN":function(stx,sd){return STX.Studies.calculateRateOfChange(stx,sd);},"inputs":{"Period":14},"centerline":0},"Price Vol":{"calculateFN":function(stx,sd){return STX.Studies.calculatePriceVolumeTrend(stx,sd);},"inputs":{"Field":"field"}},"Pos Vol":{"calculateFN":function(stx,sd){return STX.Studies.calculateVolumeIndex(stx,sd);},"inputs":{"Field":"field","Moving Average Type":"ma","Period":255},"outputs":{"Index":"auto","MA":"#FF0000"}},"Neg Vol":{"calculateFN":function(stx,sd){return STX.Studies.calculateVolumeIndex(stx,sd);},"inputs":{"Field":"field","Moving Average Type":"ma","Period":255},"outputs":{"Index":"auto","MA":"#FF0000"}},"On Bal Vol":{"calculateFN":function(stx,sd){return STX.Studies.calculateOnBalanceVolume(stx,sd);},"inputs":{"Field":"field"}},"Perf Idx":{"calculateFN":function(stx,sd){return STX.Studies.calculatePerformance(stx,sd);},"inputs":{"Field":"field"}},"Stch Mtm":{"calculateFN":function(stx,sd){return STX.Studies.calculateStochMomentum(stx,sd);},"inputs":{"%K Periods":10,"%K Smoothing Periods":3,"%K Double Smoothing Periods":3,"%D Periods":10,"%D Moving Average Type":"ema"},"outputs":{"%K":"auto","%D":"#FF0000"},"parameters":{template:"studyOverZones",init:{studyOverZonesEnabled:true,studyOverBoughtValue:40,studyOverBoughtColor:"auto",studyOverSoldValue:-40,studyOverSoldColor:"auto"}}},"Hist Vol":{"calculateFN":function(stx,sd){return STX.Studies.calculateHistoricalVolatility(stx,sd);},"inputs":{"Field":"field","Period":10,"Days Per Year":[252,365],"Standard Deviations":1}},"Pretty Good":{"seriesFN":function(stx,sd,quotes){return STX.Studies.displayPrettyGoodOscillator(stx,sd,quotes);},"calculateFN":function(stx,sd){return STX.Studies.calculatePrettyGoodOscillator(stx,sd);},},"Awesome":{"seriesFN":function(stx,sd,quotes){return STX.Studies.displayAwesomeOscillator(stx,sd,quotes);},"calculateFN":function(stx,sd){return STX.Studies.calculateAwesomeOscillator(stx,sd);},"inputs":{},"outputs":{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"Ultimate":{"calculateFN":function(stx,sd){return STX.Studies.calculateUltimateOscillator(stx,sd);},"inputs":{"Cycle 1":7,"Cycle 2":14,"Cycle 3":28},"parameters":{template:"studyOverZones",init:{studyOverZonesEnabled:true,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},"W Acc Dist":{"inputs":{}},"Vol Osc":{"calculateFN":function(stx,sd){return STX.Studies.calculatePriceOscillator(stx,sd,true);},"inputs":{"Short Cycle":12,"Long Cycle":26,"Points Or Percent":["Points","Percent"]}},"Twiggs":{"calculateFN":function(stx,sd){return STX.Studies.calculateTwiggsMoneyFlow(stx,sd);},"inputs":{"Period":21}},"Chaikin MF":{"calculateFN":function(stx,sd){return STX.Studies.calculateChaikinMoneyFlow(stx,sd);},"inputs":{"Period":20}},"Chaikin Vol":{"calculateFN":function(stx,sd){return STX.Studies.calculateChaikinVolatility(stx,sd);},"inputs":{"Period":14,"Rate Of Change":2,"Moving Average Type":"ma"}},"Price Osc":{"calculateFN":function(stx,sd){return STX.Studies.calculatePriceOscillator(stx,sd);},"inputs":{"Field":"field","Long Cycle":26,"Short Cycle":12,"Moving Average Type":"ema"}},"EOM":{"calculateFN":function(stx,sd){return STX.Studies.calculateEaseOfMovement(stx,sd);},"inputs":{"Period":14,"Moving Average Type":"ma"}},"CCI":{"calculateFN":function(stx,sd){return STX.Studies.calculateCCI(stx,sd);},"inputs":{"Period":20},"parameters":{template:"studyOverZones",init:{studyOverZonesEnabled:true,studyOverBoughtValue:100,studyOverBoughtColor:"auto",studyOverSoldValue:-100,studyOverSoldColor:"auto"}}},"Detrended":{"calculateFN":function(stx,sd){return STX.Studies.calculateDetrendedPrice(stx,sd);},"inputs":{"Field":"field","Period":14,"Moving Average Type":"ma"}},"True Range":{"calculateFN":function(stx,sd){return STX.Studies.calculateStudyATR(stx,sd);},"inputs":{},"outputs":{"True Range":"auto"}},"ATR":{"calculateFN":function(stx,sd){return STX.Studies.calculateStudyATR(stx,sd);},"outputs":{"ATR":"auto"}},"ATR Bands":{"overlay":true,"seriesFN":function(stx,sd,quotes){return STX.Studies.displayChannel(stx,sd,quotes);},"calculateFN":function(stx,sd){return STX.Studies.calculateATRBands(stx,sd);},"inputs":{"Period":5,"Shift":3,"Field":"field","Channel Fill":true},"outputs":{"ATR Bands Top":"auto","ATR Bands Bottom":"auto","ATR Bands Channel":"auto"}},"ATR Trailing Stop":{"overlay":true,"seriesFN":STX.Studies.displayPSAR2,"calculateFN":function(stx,sd){return STX.Studies.calculateATRStops(stx,sd);},"inputs":{"Multiplier":3,"Period":21,"Plot Type":["points","squarewave"],"HighLow":false},"outputs":{"Buy Stops":"#FF0000","Sell Stops":"#00FF00"}},"Ehler Fisher":{"calculateFN":function(stx,sd){return STX.Studies.calculateEhlerFisher(stx,sd);},"inputs":{"Period":10},"outputs":{"EF":"auto","EF Trigger":"#FF0000"}},"Schaff":{"range":"0 to 100","calculateFN":function(stx,sd){return STX.Studies.calculateSchaff(stx,sd);},"inputs":{"Field":"field","Period":10,"Short Cycle":23,"Long Cycle":50,"Moving Average Type":"ema"},"parameters":{template:"studyOverZones",init:{studyOverZonesEnabled:true,studyOverBoughtValue:75,studyOverBoughtColor:"auto",studyOverSoldValue:25,studyOverSoldColor:"auto"}}},"QStick":{"calculateFN":function(stx,sd){return STX.Studies.calculateQStick(stx,sd);},"inputs":{"Period":8,"Moving Average Type":"ma"}},"Coppock":{"calculateFN":function(stx,sd){return STX.Studies.calculateCoppock(stx,sd);},"inputs":{"Field":"field","Short RoC":11,"Long RoC":14,"Period":10}},"Chande Mtm":{"calculateFN":function(stx,sd){return STX.Studies.calculateChandeMomentum(stx,sd);},"inputs":{"Period":9},"parameters":{template:"studyOverZones",init:{studyOverZonesEnabled:true,studyOverBoughtValue:50,studyOverBoughtColor:"auto",studyOverSoldValue:-50,studyOverSoldColor:"auto"}}},"Chande Fcst":{"calculateFN":function(stx,sd){return STX.Studies.calculateChandeForecast(stx,sd);},"inputs":{"Field":"field","Period":14}},"Intraday Mtm":{"calculateFN":function(stx,sd){return STX.Studies.calculateIntradayMomentum(stx,sd);},"inputs":{"Period":20},"parameters":{template:"studyOverZones",init:{studyOverZonesEnabled:true,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},"RAVI":{"seriesFN":function(stx,sd,quotes){return STX.Studies.displayRAVI(stx,sd,quotes);},"calculateFN":function(stx,sd){return STX.Studies.calculatePriceOscillator(stx,sd);},"inputs":{"Field":"field","Short Cycle":7,"Long Cycle":65},"outputs":{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"},"parameters":{template:"studyOverZones",init:{studyOverZonesEnabled:true,studyOverBoughtValue:.3,studyOverBoughtColor:"auto",studyOverSoldValue:-.3,studyOverSoldColor:"auto"}}},"Random Walk":{"calculateFN":function(stx,sd){return STX.Studies.calculateRandomWalk(stx,sd);},"outputs":{"Random Walk High":"#FF0000","Random Walk Low":"#0000FF"}},"ADX":{"calculateFN":function(stx,sd){return STX.Studies.calculateADX(stx,sd);},"outputs":{"ADX":"auto","+DI":"#00FF00","-DI":"#FF0000"}},"Directional":{"calculateFN":function(stx,sd){return STX.Studies.calculateADX(stx,sd);},"outputs":{"ADX":"auto","+DI":"#00FF00","-DI":"#FF0000"}},"High Low":{"overlay":true,"seriesFN":function(stx,sd,quotes){return STX.Studies.displayChannel(stx,sd,quotes);},"calculateFN":function(stx,sd){sd.inputs["Moving Average Type"]="triangular";STX.Studies.calculateMAEnvelope(stx,sd);},"inputs":{"Field":"field","Period":10,"Shift Percentage":5,"Channel Fill":true},"outputs":{"High Low Top":"auto","High Low Median":"auto","High Low Bottom":"auto"}},"High-Low":{"calculateFN":function(stx,sd){var quotes=sd.chart.scrubbed;for(var i=0;i<quotes.length;i++){quotes[i]["Result "+ sd.name]=quotes[i]["High"]- quotes[i]["Low"];}},"inputs":{}},"Med Price":{"calculateFN":function(stx,sd){return STX.Studies.calculateMedianPrice(stx,sd);},"inputs":{}},"MA Env":{"overlay":true,"seriesFN":function(stx,sd,quotes){return STX.Studies.displayChannel(stx,sd,quotes);},"calculateFN":function(stx,sd){return STX.Studies.calculateMAEnvelope(stx,sd);},"inputs":{"Field":"field","Period":50,"Shift Percentage":5,"Moving Average Type":"ma","Channel Fill":true},"outputs":{"MA Env Top":"auto","MA Env Median":"auto","MA Env Bottom":"auto"}},"Fractal Chaos Bands":{"overlay":true,"calculateFN":function(stx,sd){return STX.Studies.calculateFractalChaos(stx,sd);},"seriesFN":function(stx,sd,quotes){return STX.Studies.displayChannel(stx,sd,quotes);},"inputs":{"Channel Fill":true},"outputs":{"Fractal High":"auto","Fractal Low":"auto","Fractal Channel":"auto"}},"Fractal Chaos":{"range":"-1 to 1","calculateFN":function(stx,sd){return STX.Studies.calculateFractalChaos(stx,sd);},"inputs":{}},"GAPO":{"calculateFN":function(stx,sd){return STX.Studies.calculateMaxHighMinLow(stx,sd);}},"Gopala":{"calculateFN":function(stx,sd){return STX.Studies.calculateMaxHighMinLow(stx,sd);}},"Prime Number Bands":{"overlay":true,"calculateFN":function(stx,sd){return STX.Studies.calculatePrimeNumber(stx,sd);},"seriesFN":function(stx,sd,quotes){return STX.Studies.displayChannel(stx,sd,quotes);},"inputs":{"Channel Fill":true},"outputs":{"Prime Bands Top":"auto","Prime Bands Bottom":"auto","Prime Bands Channel":"auto"}},"Prime Number":{"range":"-1 to 1","calculateFN":function(stx,sd){return STX.Studies.calculatePrimeNumber(stx,sd);},"inputs":{"Tolerance Percentage":5}},"Bollinger Bands":{"overlay":true,"calculateFN":function(stx,sd){return STX.Studies.calculateBollinger(stx,sd);},"seriesFN":function(stx,sd,quotes){return STX.Studies.displayChannel(stx,sd,quotes);},"inputs":{"Field":"field","Period":20,"Standard Deviations":2,"Moving Average Type":"ma","Channel Fill":true},"outputs":{"Bollinger Bands Top":"auto","Bollinger Bands Median":"auto","Bollinger Bands Bottom":"auto"}},"Boll %b":{"calculateFN":function(stx,sd){return STX.Studies.calculateBollinger(stx,sd);},"inputs":{"Field":"field","Period":20,"Standard Deviations":2,"Moving Average Type":"ma"},"outputs":{"%b":"auto"}},"Boll BW":{"calculateFN":function(stx,sd){return STX.Studies.calculateBollinger(stx,sd);},"inputs":{"Field":"field","Period":20,"Standard Deviations":2,"Moving Average Type":"ma"},"outputs":{"Bandwidth":"auto"}},"Donchian Channel":{"overlay":true,"calculateFN":function(stx,sd){return STX.Studies.calculateMaxHighMinLow(stx,sd);},"seriesFN":function(stx,sd,quotes){return STX.Studies.displayChannel(stx,sd,quotes);},"inputs":{"High Period":20,"Low Period":20,"Channel Fill":true},"outputs":{"Donchian High":"auto","Donchian Median":"auto","Donchian Low":"auto"}},"Donchian Width":{"calculateFN":function(stx,sd){return STX.Studies.calculateMaxHighMinLow(stx,sd);},"inputs":{"High Period":20,"Low Period":20},},"HHV":{"calculateFN":function(stx,sd){return STX.Studies.calculateMaxHighMinLow(stx,sd);},"inputs":{"Period":14},},"LLV":{"calculateFN":function(stx,sd){return STX.Studies.calculateMaxHighMinLow(stx,sd);},"inputs":{"Period":14},},"Mass Idx":{"seriesFN":function(stx,sd,quotes){return STX.Studies.displayMassIndex(stx,sd,quotes);},"calculateFN":function(stx,sd){return STX.Studies.calculateMassIndex(stx,sd);},"inputs":{"Period":25,"Bulge Threshold":27},},"Keltner":{"overlay":true,"seriesFN":function(stx,sd,quotes){return STX.Studies.displayChannel(stx,sd,quotes);},"calculateFN":function(stx,sd){return STX.Studies.calculateKeltner(stx,sd);},"inputs":{"Period":50,"Shift":5,"Moving Average Type":"ema","Channel Fill":true},"outputs":{"Keltner Top":"auto","Keltner Median":"auto","Keltner Bottom":"auto"}},"PSAR":{"overlay":true,"calculateFN":function(stx,sd){return STX.Studies.calculatePSAR(stx,sd);},"seriesFN":STX.Studies.displayPSAR2,"inputs":{"Minimum AF":.02,"Maximum AF":.2}},"Klinger":{"seriesFN":STX.Studies.displayKlinger,"calculateFN":STX.Studies.calculateKlinger,"inputs":{"Signal Periods":13,"Short Cycle":34,"Long Cycle":55},"outputs":{"Klinger":"auto","KlingerSignal":"#FF0000"}},"Elder Ray":{"seriesFN":function(stx,sd,quotes){return STX.Studies.displayElderRay(stx,sd,quotes);},"calculateFN":function(stx,sd){return STX.Studies.calculateElderRay(stx,sd);},"inputs":{"Period":13},"outputs":{"Elder Bull Power":"#00DD00","Elder Bear Power":"#FF0000"}},"Elder Force":{"calculateFN":function(stx,sd){return STX.Studies.calculateElderForce(stx,sd);},"inputs":{}},"LR Slope":{"calculateFN":function(stx,sd){return STX.Studies.calculateLinearRegressionIndicator(stx,sd);},"inputs":{"Period":14,"Field":"field"},"outputs":{"Slope":"auto"}},"COG":{"calculateFN":function(stx,sd){return STX.Studies.calculateCenterOfGravity(stx,sd);},"inputs":{"Period":10,"Field":"field"},},"Typical Price":{"calculateFN":function(stx,sd){return STX.Studies.calculateTypicalPrice(stx,sd);},"inputs":{"Period":14,"Overlay":false}},"Weighted Close":{"calculateFN":function(stx,sd){return STX.Studies.calculateWeightedClose(stx,sd);},"inputs":{"Period":14,"Overlay":false}},"Pivot Points":{"overlay":true,"seriesFN":function(stx,sd,quotes){return STX.Studies.displayPivotPoints(stx,sd,quotes);},"calculateFN":function(stx,sd){return STX.Studies.calculatePivotPoints(stx,sd);},"inputs":{"Shading":false},"outputs":{"Pivot":"auto","Resistance 1":"rgb(184,44,11)","Support 1":"rgb(105,145,88)","Resistance 2":"rgb(227,100,96)","Support 2":"rgb(179,217,135)","Resistance 3":"rgb(255,208,207)","Support 3":"rgb(211,232,174)"},"parameters":{noSlopes:true}},"M Flow":{"range":"0 to 100","calculateFN":function(stx,sd){return STX.Studies.calculateMoneyFlowIndex(stx,sd);},"inputs":{"Period":14},"parameters":{template:"studyOverZones",init:{studyOverZonesEnabled:true,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},"Williams %R":{"calculateFN":function(stx,sd){return STX.Studies.calculateMaxHighMinLow(stx,sd);},"inputs":{"Period":14},"parameters":{template:"studyOverZones",init:{studyOverZonesEnabled:true,studyOverBoughtValue:-20,studyOverBoughtColor:"auto",studyOverSoldValue:-80,studyOverSoldColor:"auto"}}},"W Acc Dist":{"calculateFN":function(stx,sd){return STX.Studies.calculateAccumulationDistribution(stx,sd);},"inputs":{}},"Ichimoku Clouds":{"overlay":true,"range":"bypass","calculateFN":function(stx,sd){return STX.Studies.calculateIchimoku(stx,sd);},"seriesFN":function(stx,sd,quotes){return STX.Studies.displayIchimoku(stx,sd,quotes);},"nohorizontal":true,"inputs":{"Conversion Line Period":9,"Base Line Period":26,"Leading Span B Period":52,"Lagging Span Period":26},"outputs":{"Conversion Line":"#0000FF","Base Line":"#FF0000","Leading Span A":"#00FF00","Leading Span B":"#FF0000","Lagging Span":"#808000"}},"P Rel":{"seriesFN":function(stx,sd,quotes){return STX.Studies.displayPriceRelative(stx,sd,quotes);},"calculateFN":function(stx,sd){return STX.Studies.calculatePriceRelative(stx,sd);},"inputs":{"Comparison Symbol":"SPY"}},"vchart":{"display":"Volume","range":"bypass","seriesFN":null,"calculateFN":STX.Studies.calculateVolume,"inputs":{},"outputs":{"Up Volume":"#8cc176","Down Volume":"#b82c0c"},"parameters":{"zoom":0}},"vol undr":{"overlay":true,"seriesFN":null,"calculateFN":STX.Studies.calculateVolume,"inputs":{},"outputs":{"Up Volume":"#8cc176","Down Volume":"#b82c0c"},"parameters":{template:"studyRemoveOverlay",condition:function(stx){return stx.layout.volumeUnderlay;},init:{removeStudy:false}}}};if(!Function.prototype.stxInheritsFrom){Function.prototype.stxInheritsFrom=function(parentClassOrObject){this.prototype=new parentClassOrObject;this.prototype.constructor=this;this.prototype.parent=parentClassOrObject.prototype;};}
STX.Drawing=function(){this.chartsOnly=false;this.dragToDraw=false;this.penDown=false;};STX.Drawing.prototype.abort=function(forceClear){};STX.Drawing.prototype.measure=function(){};STX.Drawing.prototype.construct=function(stx,panel){this.stx=stx;this.panelName=panel.name;};STX.Drawing.prototype.render=function(context){alert("must implement render function!");};STX.Drawing.prototype.click=function(context,tick,value){alert("must implement click function!");};STX.Drawing.prototype.move=function(context,tick,value){alert("must implement move function!");};STX.Drawing.prototype.reposition=function(context,repositioner,tick,value){};STX.Drawing.prototype.intersected=function(tick,value,box){alert("must implement intersected function!");};STX.Drawing.prototype.reconstruct=function(stx,obj){alert("must implement reconstruct function!");};STX.Drawing.prototype.serialize=function(){alert("must implement serialize function!");};STX.Drawing.prototype.adjust=function(){alert("must implement adjust function!");};STX.Drawing.prototype.highlight=function(highlighted){if(highlighted&&!this.highlighted){this.highlighted=highlighted;}else if(!highlighted&&this.highlighted){this.highlighted=highlighted;}
return this.highlighted;};STX.Drawing.prototype.littleCircle=function(ctx,x,y,fill){var strokeColor=this.stx.defaultColor;var fillColor=STX.chooseForegroundColor(strokeColor);ctx.beginPath();ctx.lineWidth=1;var radius=Math.max(12,8)/2;
ctx.arc(x,y,radius,0,2*Math.PI,false);if(fill)ctx.fillStyle=strokeColor;else ctx.fillStyle=fillColor;ctx.strokeStyle=strokeColor;ctx.fill();ctx.stroke();ctx.closePath();};STX.Drawing.prototype.pointIntersection=function(tick,value,box){var panel=this.stx.panels[this.panelName];if(!panel)return false;if(tick>=box.x0&&tick<=box.x1&&value>=box.y1&&value<=box.y0)return true;return false;};STX.Drawing.BaseTwoPoint=function(){this.p0=null;this.p1=null;this.color="";};STX.Drawing.BaseTwoPoint.stxInheritsFrom(STX.Drawing);STX.Drawing.BaseTwoPoint.prototype.copyConfig=function(){this.color=this.stx.currentVectorParameters.currentColor;};STX.Drawing.BaseTwoPoint.prototype.lineIntersection=function(tick,value,box,type){if(!this.p0||!this.p1)return false;if(this.stx.layout.semiLog){return STX.boxIntersects(box.x0,STX.log10(box.y0),box.x1,STX.log10(box.y1),this.p0[0],STX.log10(this.p0[1]),this.p1[0],STX.log10(this.p1[1]),type);}else{return STX.boxIntersects(box.x0,box.y0,box.x1,box.y1,this.p0[0],this.p0[1],this.p1[0],this.p1[1],type);}};STX.Drawing.BaseTwoPoint.prototype.boxIntersection=function(tick,value){if(!this.p0||!this.p1)return false;if(tick>Math.max(this.p0[0],this.p1[0])||tick<Math.min(this.p0[0],this.p1[0]))return false;if(value>Math.max(this.p0[1],this.p1[1])||value<Math.min(this.p0[1],this.p1[1]))return false;return true;};STX.Drawing.BaseTwoPoint.prototype.accidentalClick=function(tick,value){var panel=this.stx.panels[this.panelName];var x0=this.stx.pixelFromTick(this.p0[0],panel.chart);var x1=this.stx.pixelFromTick(tick,panel.chart);var y0=this.stx.pixelFromValueAdjusted(panel,this.p0[0],this.p0[1]);var y1=this.stx.pixelFromValueAdjusted(panel,tick,value);var h=Math.abs(x1-x0);var v=Math.abs(y1-y0);var length=Math.sqrt(h*h+v*v);if(length<10){this.penDown=false;if(this.dragToDraw)this.stx.undo();return true;}};STX.Drawing.BaseTwoPoint.prototype.click=function(context,tick,value){this.copyConfig();if(!this.penDown){this.p0=[tick,value];this.penDown=true;return false;}
if(this.accidentalClick(tick,value))return this.dragToDraw;var panel=this.stx.panels[this.panelName];this.p1=[tick,value];this.d0=this.stx.dateFromTick(this.p0[0],panel.chart);this.d1=this.stx.dateFromTick(this.p1[0],panel.chart);this.v0=this.p0[1];this.v1=this.p1[1];this.penDown=false;return true;};STX.Drawing.BaseTwoPoint.prototype.adjust=function(){var panel=this.stx.panels[this.panelName];if(!panel)return;this.p0=[this.stx.tickFromDate(this.d0,panel.chart),this.v0];this.p1=[this.stx.tickFromDate(this.d1,panel.chart),this.v1];};STX.Drawing.BaseTwoPoint.prototype.move=function(context,tick,value){if(!this.penDown)return;this.copyConfig();this.p1=[tick,value];this.render(context);};STX.Drawing.BaseTwoPoint.prototype.measure=function(){this.stx.setMeasure(this.p0[1],this.p1[1],this.p0[0],this.p1[0],true);};STX.Drawing.segment=function(){this.name="segment";};STX.Drawing.segment.stxInheritsFrom(STX.Drawing.BaseTwoPoint);STX.Drawing.segment.prototype.render=function(context){var panel=this.stx.panels[this.panelName];if(!panel)return;var x0=this.stx.pixelFromTick(this.p0[0],panel.chart);var x1=this.stx.pixelFromTick(this.p1[0],panel.chart);var y0=this.stx.pixelFromValueAdjusted(panel,this.p0[0],this.p0[1]);var y1=this.stx.pixelFromValueAdjusted(panel,this.p1[0],this.p1[1]);var color=this.color;if(color=="auto"||STX.isTransparent(color))color=this.stx.defaultColor;var width=this.lineWidth;if(this.highlighted){color=this.stx.getCanvasColor("stx_highlight_vector");}else{this.stx.setMeasure(null,null,null,null,false);}
var parameters={pattern:this.pattern,lineWidth:width};this.stx.plotLine(x0,x1,y0,y1,color,this.name,context,panel,parameters);if(this.axisLabel&&!this.highlighted){if(this.name=="horizontal"){this.stx.endClip();var txt=this.p0[1];if(panel.chart.transformFunc)txt=panel.chart.transformFunc(this.stx,panel.chart,txt);if(panel.yAxis.priceFormatter)
txt=panel.yAxis.priceFormatter(this.stx,panel,txt);else
txt=this.stx.formatYAxisPrice(txt,panel);this.stx.createYAxisLabel(panel,txt,y0,color);this.stx.startClip(panel.name);}else if(this.name=="vertical"){var myDate=this.d0;if(panel.chart.xAxis.formatter){myDate=panel.chart.xAxis.formatter(myDate);}else if(this.stx.internationalizer){var str=this.stx.internationalizer.monthDay.format(myDate);if(myDate.getHours()!=0||myDate.getMinutes()!=0)
str+=" "+ this.stx.internationalizer.hourMinute.format(myDate);myDate=str;}else{myDate=STX.mmddhhmm(myDate);}
this.stx.endClip();this.stx.createXAxisLabel(panel,myDate,x0,color);this.stx.startClip(panel.name);}}
if(this.highlighted&&this.name!="horizontal"&&this.name!="vertical"){var p0Fill=this.whichPoint=="p0"?true:false;var p1Fill=this.whichPoint=="p1"?true:false;this.littleCircle(context,x0,y0,p0Fill);this.littleCircle(context,x1,y1,p1Fill);}};STX.Drawing.segment.prototype.abort=function(){this.stx.setMeasure(null,null,null,null,false);};STX.Drawing.BaseTwoPoint.prototype.reposition=function(context,repositioner,tick,value){var panel=this.stx.panels[this.panelName];var tickDiff=repositioner.tick-tick;var valueDiff=repositioner.value-value;if(repositioner.action=="move"){this.p0=[repositioner.p0[0]-tickDiff,repositioner.p0[1]-valueDiff];this.p1=[repositioner.p1[0]-tickDiff,repositioner.p1[1]-valueDiff];this.d0=this.stx.dateFromTick(this.p0[0],panel.chart);this.d1=this.stx.dateFromTick(this.p1[0],panel.chart);this.v0=this.p0[1];this.v1=this.p1[1];this.render(context);}else if(repositioner.action=="drag"){this[repositioner.point]=[tick,value];this.d0=this.stx.dateFromTick(this.p0[0],panel.chart);this.d1=this.stx.dateFromTick(this.p1[0],panel.chart);this.v0=this.p0[1];this.v1=this.p1[1];this.render(context);}};STX.Drawing.segment.prototype.intersected=function(tick,value,box){this.whichPoint=null;if(!this.p0||!this.p1)return null;if(this.name!="horizontal"&&this.name!="vertical"){if(this.pointIntersection(this.p0[0],this.p0[1],box)){this.whichPoint="p0";this.highlighted="p0";return{action:"drag",point:"p0"};}else if(this.pointIntersection(this.p1[0],this.p1[1],box)){this.highlighted="p1";this.whichPoint="p1";return{action:"drag",point:"p1"};}}
var isIntersected=this.lineIntersection(tick,value,box,this.name);if(isIntersected){this.highlighted=true;return{action:"move",p0:STX.clone(this.p0),p1:STX.clone(this.p1),tick:tick,value:value};}else{return null;}};STX.Drawing.segment.prototype.copyConfig=function(){this.color=this.stx.currentVectorParameters.currentColor;this.lineWidth=this.stx.currentVectorParameters.lineWidth;this.pattern=this.stx.currentVectorParameters.pattern;if(this.pattern=="none")this.pattern="solid";};STX.Drawing.segment.prototype.reconstruct=function(stx,obj){this.stx=stx;this.color=obj["col"];this.panelName=obj["pnl"];this.pattern=obj["ptrn"];this.lineWidth=obj["lw"];this.d0=obj["d0"];this.d1=obj["d1"];this.v0=obj["v0"];this.v1=obj["v1"];this.adjust();};STX.Drawing.segment.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,v0:this.v0,v1:this.v1};};STX.Drawing.rectangle=function(){this.name="rectangle";};STX.Drawing.rectangle.stxInheritsFrom(STX.Drawing.BaseTwoPoint);STX.Drawing.rectangle.prototype.render=function(context){var panel=this.stx.panels[this.panelName];if(!panel)return;var x0=this.stx.pixelFromTick(this.p0[0],panel.chart);var x1=this.stx.pixelFromTick(this.p1[0],panel.chart);var y0=this.stx.pixelFromValueAdjusted(panel,this.p0[0],this.p0[1]);var y1=this.stx.pixelFromValueAdjusted(panel,this.p1[0],this.p1[1]);var x=Math.round(Math.min(x0,x1))+.5;var y=Math.min(y0,y1);var width=Math.max(x0,x1)-x;var height=Math.max(y0,y1)-y;var edgeColor=this.color;if(this.highlighted){edgeColor=this.stx.getCanvasColor("stx_highlight_vector");}
var fillColor=this.fillColor;if(fillColor&&!STX.isTransparent(fillColor)&&fillColor!="auto"){context.beginPath();context.rect(x,y,width,height);context.fillStyle=fillColor;context.globalAlpha=.2;context.fill();context.closePath();context.globalAlpha=1;}
var parameters={pattern:this.pattern,lineWidth:this.lineWidth};if(this.highlighted&&parameters.pattern=="none"){parameters.pattern="solid";if(parameters.lineWidth==.1)parameters.lineWidth=1;}
this.stx.plotLine(x0,x1,y0,y0,edgeColor,"segment",context,panel,parameters);this.stx.plotLine(x1,x1,y0-.5,y1+.5,edgeColor,"segment",context,panel,parameters);this.stx.plotLine(x1,x0,y1,y1,edgeColor,"segment",context,panel,parameters);this.stx.plotLine(x0,x0,y1+.5,y0-.5,edgeColor,"segment",context,panel,parameters);if(this.highlighted){var p0Fill=this.whichPoint=="p0"?true:false;var p1Fill=this.whichPoint=="p1"?true:false;this.littleCircle(context,x0,y0,p0Fill);this.littleCircle(context,x1,y1,p1Fill);}};STX.Drawing.rectangle.prototype.intersected=function(tick,value,box){this.whichPoint=null;if(!this.p0||!this.p1)return null;if(this.pointIntersection(this.p0[0],this.p0[1],box)){this.highlighted="p0";this.whichPoint="p0";return{action:"drag",point:"p0"};}else if(this.pointIntersection(this.p1[0],this.p1[1],box)){this.highlighted="p1";this.whichPoint="p1";return{action:"drag",point:"p1"};}
if(this.boxIntersection(tick,value)){this.highlighted=true;return{action:"move",p0:STX.clone(this.p0),p1:STX.clone(this.p1),tick:tick,value:value};}
return null;};STX.Drawing.rectangle.prototype.copyConfig=function(){this.color=this.stx.currentVectorParameters.currentColor;this.fillColor=this.stx.currentVectorParameters.fillColor;this.lineWidth=this.stx.currentVectorParameters.lineWidth;this.pattern=this.stx.currentVectorParameters.pattern;};STX.Drawing.rectangle.prototype.reconstruct=function(stx,obj){this.stx=stx;this.color=obj["col"];this.fillColor=obj["fc"];this.panelName=obj["pnl"];this.pattern=obj["ptrn"];this.lineWidth=obj["lw"];this.d0=obj["d0"];this.d1=obj["d1"];this.v0=obj["v0"];this.v1=obj["v1"];this.adjust();};STX.Drawing.rectangle.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,v0:this.v0,v1:this.v1};};var STXTouchAction="onclick";if(STX.touchDevice&&(STX.ipad||STX.iphone))STXTouchAction="ontouchend";STX.DropDownManager=function(){};STX.DropDownManager.dropDowns=[];STX.DropDownManager.callback=null;STX.DropDownManager.listeners={};STX.DropDownManager.newDropDown=function(dropDown){function toggle(dropDown){return function(e){if($$$("ul",dropDown).style.display=="block"){$$$("ul",dropDown).style.display="none";return;}
$$$("ul",dropDown).style.display="block";STX.DropDownManager.callback=function(dropDown){return function(e){if((e.which&&e.which>=2)||(e.button&&e.button>=2))return;var menu=$$$("ul",dropDown);if(!STX.withinElement(dropDown,e.pageX,e.pageY)&&!STX.withinElement(menu,e.pageX,e.pageY))
menu.style.display="none";for(var event in STX.DropDownManager.listeners){document.removeEventListener(event,STX.DropDownManager.listeners[event]);}};}(dropDown);setTimeout(function(){if(e.type=="click"){document.addEventListener("mousedown",STX.DropDownManager.callback);STX.DropDownManager.listeners["mousedown"]=STX.DropDownManager.callback;}
if(e.type=="pointerup"){document.addEventListener("pointerdown",STX.DropDownManager.callback);STX.DropDownManager.listeners["pointerdown"]=STX.DropDownManager.callback;}
if(e.type=="touchend"){document.addEventListener("touchstart",STX.DropDownManager.callback);STX.DropDownManager.listeners["touchstart"]=STX.DropDownManager.callback;}},0);};}
$$$("ul",dropDown).style.display="none";STX.safeClickTouch(dropDown,toggle(dropDown));};STX.DropDownManager.initialize=function(){var dropDowns=document.querySelectorAll(".stx-dropdown");for(var i=0;i<dropDowns.length;i++){var dropDown=dropDowns[i];STX.DropDownManager.newDropDown(dropDown);}};STX.MenuManager=function(){};STX.MenuManager.registeredCharts=[];STX.MenuManager.openMenu=null;STX.MenuManager.useOverlay=true;STX.MenuManager.menusDisabled=false;STX.MenuManager.menusDisabledDialog=false;STX.MenuManager.onClass=null;STX.MenuManager.offClass=null;STX.MenuManager.menus=[];STX.MenuManager.stack=[];STX.MenuManager.registerChart=function(stx){STX.MenuManager.registeredCharts.push(stx);if(!STX.MenuManager.bodyOverlay){STX.MenuManager.bodyOverlay=STX.newChild(document.body,"DIV","stxBodyOverlay");}};STX.MenuManager.useOverlays=function(useOverlay){STX.MenuManager.useOverlay=useOverlay;};STX.MenuManager.cancelSingleClick=function(){for(var i=0;i<STX.MenuManager.registeredCharts.length;i++){STX.MenuManager.registeredCharts[i].cancelTouchSingleClick=true;}};STX.MenuManager.menuOn=function(name,callback,cascading){function tapMe(callback,name){return function(e){STX.MenuManager.menuOff();};}
if(STX.MenuManager.registeredCharts.length==0)return;if(STX.MenuManager.openMenu){if(name==STX.MenuManager.openMenu)return;if(!cascading)STX.MenuManager.menuOff(true);}
STX.MenuManager.openMenu=name;if(!cascading&&STX.MenuManager.useOverlay){STX.MenuManager.bodyOverlay.style.display="block";STX.MenuManager.bodyOverlay[STXTouchAction]=tapMe(name);}
STX.MenuManager.stack.push({closeCurrentMenu:callback,cascading:cascading});for(var i=0;i<STX.MenuManager.registeredCharts.length;i++){STX.MenuManager.registeredCharts[i].openDialog=name;}};STX.MenuManager.menuOff=function(closeAll,dontBlur){if(STX.MenuManager.stack.length==0)return;if(STX.MenuManager.registeredCharts.length==0)return;if(!dontBlur&&document.activeElement&&document.activeElement.tagName!="BODY"&&document.activeElement.blur)document.activeElement.blur();while(STX.MenuManager.stack.length){var obj=STX.MenuManager.stack.pop();obj.closeCurrentMenu();if(!closeAll)break;}
if(STX.MenuManager.stack.length==0){STX.MenuManager.openMenu=null;if(STX.MenuManager.useOverlay){STX.MenuManager.bodyOverlay.style.display="none";STX.MenuManager.bodyOverlay[STXTouchAction]=null;}}
this.cancelSingleClick();if(STX.DialogManager.stack.length==0){for(var i=0;i<STX.MenuManager.registeredCharts.length;i++){STX.MenuManager.registeredCharts[i].openDialog="";}}};STX.MenuManager.makeMenus=function(){function toggle(div,menu){return function(e){function turnMeOff(div){return function(){div.style.display="none";if(div.colorPickerDiv!=null)div.colorPickerDiv.style.display="none";};}
var dom=STX.getEventDOM(e);do{if(dom.className&&dom.className.indexOf("menuOutline")!=-1)return;if(dom.className&&dom.className.indexOf("stxMenu")!=-1)break;dom=dom.parentNode;}while(dom);if(div.style.display=="none"){var menuName=STX.uniqueID();if((STX.MenuManager.menusDisabled&&!menu.alwaysOn)||STX.MenuManager.menusDisabledDialog)return;STX.MenuManager.menuOn(menuName,turnMeOff(div));div.style.display="block";}else{STX.MenuManager.menuOff();div.style.display="none";}};}
function activate(menuOutline,clickable,priorClick){return function(e){STX.MenuManager.menuOff();menuOutline.style.display="none";var action=clickable.getAttribute("stxToggle");eval(action);};}
STX.MenuManager.menus=document.querySelectorAll(".stxMenu");for(var i=0;i<STX.MenuManager.menus.length;i++){var menu=STX.MenuManager.menus[i];var menuOutline=menu.querySelectorAll(".menuOutline")[0];menu.alwaysOn=(menu.className.indexOf("stxAlwaysOn")!=-1);menu[STXTouchAction]=toggle(menuOutline,menu);var clickables=menuOutline.querySelectorAll("*[stxToggle]");for(var j=0;j<clickables.length;j++){clickables[j][STXTouchAction]=activate(menuOutline,clickables[j],clickables[j][STXTouchAction]);}}};STX.MenuManager.disableMenus=function(){STX.MenuManager.menusDisabled=true;for(var i=0;i<STX.MenuManager.menus.length;i++){var menu=STX.MenuManager.menus[i];if(STX.MenuManager.onClass)STX.unappendClassName(menu,STX.MenuManager.onClass);if(STX.MenuManager.offClass)STX.appendClassName(menu,STX.MenuManager.offClass);}};STX.MenuManager.enableMenus=function(){STX.MenuManager.menusDisabled=false;for(var i=0;i<STX.MenuManager.menus.length;i++){var menu=STX.MenuManager.menus[i];if(STX.MenuManager.offClass)STX.unappendClassName(menu,STX.MenuManager.offClass);if(STX.MenuManager.onClass)STX.appendClassName(menu,STX.MenuManager.onClass);}};STX.MenuManager.closeThisMenu=function(el){while(el&&typeof(el.className)!="undefined"&&el.className.indexOf("menuOutline")==-1){el=el.parentNode;}
if(el){el.style.display="none";}
STX.MenuManager.menuOff();};STX.MenuManager.attachColorPicker=function(colorClick,cpHolder,cb,noMenuBehavior){var closure=function(colorClick,cpHolder,cb){return function(color){if(cpHolder.colorPickerDiv)cpHolder.colorPickerDiv.style.display="none";colorClick.style.backgroundColor="#"+color;if(cb)cb(color);if(!noMenuBehavior)STX.MenuManager.menuOff();};};function closeMe(cpHolder){return function(){if(cpHolder.colorPickerDiv)cpHolder.colorPickerDiv.style.display="none";};}
colorClick[STXTouchAction]=(function(fc,cpHolder){return function(){if(!noMenuBehavior)STX.MenuManager.menuOn("colorPicker",closeMe(cpHolder));if(cpHolder.colorPickerDiv==null){cpHolder.colorPickerDiv=document.createElement("DIV");cpHolder.colorPickerDiv.className="ciqColorPicker";document.body.appendChild(cpHolder.colorPickerDiv);}
STX.createColorPicker(cpHolder.colorPickerDiv,fc);cpHolder.colorPickerDiv.style.display="block";var xy=STX.getPos(this);var x=xy.x+this.clientWidth;if((x+cpHolder.colorPickerDiv.offsetWidth)>STX.pageWidth())
x-=(x+cpHolder.colorPickerDiv.offsetWidth)-STX.pageWidth()+20;cpHolder.colorPickerDiv.style.left=x+"px";var y=(xy.y);if(y+cpHolder.colorPickerDiv.clientHeight>STX.pageHeight())
y-=(y+cpHolder.colorPickerDiv.clientHeight)-STX.pageHeight();cpHolder.colorPickerDiv.style.top=y+"px";};})(closure(colorClick,cpHolder,cb),cpHolder);};STX.DialogManager=function(){};STX.DialogManager.useOverlay=false;STX.DialogManager.stack=[];STX.DialogManager.modalBegin=function(){STX.MenuManager.menusDisabledDialog=true;for(var i=0;i<STXChart.registeredContainers.length;i++){var stx=STXChart.registeredContainers[i].stx;stx.modalBegin();}};STX.DialogManager.modalEnd=function(){STX.MenuManager.menusDisabledDialog=false;for(var i=0;i<STXChart.registeredContainers.length;i++){var stx=STXChart.registeredContainers[i].stx;stx.modalEnd();}};STX.DialogManager.displayDialog=function(id){STX.hideKeyboard();STX.DialogManager.modalBegin();if(STX.DialogManager.useOverlay&&!STX.DialogManager.bodyOverlay){STX.DialogManager.bodyOverlay=STX.newChild(document.body,"DIV","stxDialogOverlay");}
if(STX.DialogManager.useOverlay){STX.DialogManager.bodyOverlay.style.display="block";}
var node=id;if(typeof id=="string")node=$$(id);node.style.display="block";STX.DialogManager.stack.push(node);};STX.DialogManager.dismissDialog=function(){document.activeElement.blur();var node=STX.DialogManager.stack.pop();if(!node)return;node.style.display="none";if(node.colorPickerDiv!=null)node.colorPickerDiv.style.display="none";if(STX.DialogManager.stack.length==0){if(STX.DialogManager.bodyOverlay&&STX.DialogManager.bodyOverlay.style.display=="block"){STX.DialogManager.bodyOverlay.style.display="none";}
STX.DialogManager.modalEnd();}
STX.fixScreen();};STX.ThemeManager=function(){};STX.ThemeManager.builtInThemes={};STX.ThemeManager.themes={enabledTheme:null,customThemes:{}};STX.ThemeManager.classMapping={stx_candle_up:{stx_candle_up:true,stx_bar_up:true,stx_hollow_candle_up:true,stx_line_up:true,stx_baseline_up:true},stx_candle_down:{stx_candle_down:true,stx_bar_down:true,stx_hollow_candle_down:true,stx_line_down:true,stx_baseline_down:true},stx_candle_shadow:{stx_candle_shadow:true,stx_line_chart:true,stx_hollow_candle_even:true},stx_candle_shadow_up:{stx_candle_shadow_up:true},stx_candle_shadow_down:{stx_candle_shadow_down:true},stx_grid:{stx_grid:true},stx_grid_dark:{stx_grid_dark:true},stx_xaxis_dark:{stx_xaxis_dark:true,stx_xaxis:true,stx_yaxis:true,stx_yaxis_dark:true},stx_mountain:{stx_mountain_chart:true},backgroundColor:null};STX.ThemeManager.populateDialog=function(id,stx){var mountainGradientCheckbox=$$$("#mountainGradientOn",$$(id));function toggleBorders(){if($$$("#candleBordersOn",$$(id)).checked){stx.styles["stx_candle_up"]["border-left-color"]=$$(id).querySelectorAll(".stx-border-color.stx_candle_up")[0].style.backgroundColor;stx.styles["stx_candle_down"]["border-left-color"]=$$(id).querySelectorAll(".stx-border-color.stx_candle_down")[0].style.backgroundColor;}else{stx.styles["stx_candle_up"]["border-left-color"]="transparent";stx.styles["stx_candle_down"]["border-left-color"]="transparent";}
if(stx.displayInitialized)stx.draw();}
function toggleMountainGradient(){if(mountainGradientCheckbox&&mountainGradientCheckbox.checked){stx.styles["stx_mountain_chart"]["color"]=STX.hexToRgba($$(id).querySelectorAll(".stx-border-color.stx_mountain")[0].style.backgroundColor,1);stx.styles["stx_mountain_chart"]["backgroundColor"]=STX.hexToRgba($$(id).querySelectorAll(".stx-border-color.stx_mountain")[0].style.backgroundColor,50);}else{stx.styles["stx_mountain_chart"]["color"]=$$(id).querySelectorAll(".stx-border-color.stx_mountain")[0].style.backgroundColor;stx.styles["stx_mountain_chart"]["backgroundColor"]=$$(id).querySelectorAll(".stx-border-color.stx_mountain")[0].style.backgroundColor;}
if(stx.displayInitialized)stx.draw();}
function chooseColor(property,className){return function(color){var mapping=STX.ThemeManager.classMapping[className];if(mapping){for(var mapped in mapping){stx.canvasStyle(mapped);stx.styles[mapped][property]="#"+color;if(className=="stx_mountain"){if(mountainGradientCheckbox&&mountainGradientCheckbox.checked){stx.styles[mapped]["color"]=STX.hexToRgba("#"+color,1);stx.styles[mapped]["backgroundColor"]=STX.hexToRgba("#"+color,50);}else{stx.styles[mapped]["color"]="#"+color;stx.styles[mapped]["backgroundColor"]="#"+color;}
stx.styles[mapped]["borderTopColor"]="#"+color;}}}else{stx.chart.container.style[className]="#"+ color;}
if(stx.displayInitialized)stx.draw();if(property=="border-left-color"&&color&&color!="transparent"){$$$("#candleBordersOn",$$(id)).checked=true;}};}
$$$("#candleBordersOn",$$(id)).checked=false;$$$("#candleBordersOn",$$(id)).onclick=toggleBorders;if(mountainGradientCheckbox){mountainGradientCheckbox.checked=false;mountainGradientCheckbox.onclick=toggleMountainGradient;}
var computed="#FFFFFF";if(stx.chart.container){computed=getComputedStyle(stx.chart.container);}
for(var className in STX.ThemeManager.classMapping){var mapping=STX.ThemeManager.classMapping[className];var color=null;var borderColor=null;if(mapping){var firstClass=STX.first(mapping);var style=stx.canvasStyle(firstClass);color=style.color;borderColor=style["border-left-color"];if(!borderColor||borderColor=="transparent")borderColor=style["borderLeftColor"];}else{color=computed[className];if(STX.isTransparent(color)&&className=="backgroundColor")color=stx.containerColor;}
var picker=$$(id).querySelectorAll(".stx-color."+ className)[0];if(picker){picker.style.backgroundColor=color;if(!picker[STXTouchAction]){STX.MenuManager.attachColorPicker(picker,STX.DialogManager,chooseColor("color",className));}}
var picker=$$(id).querySelectorAll(".stx-border-color."+ className)[0];if(picker){picker.style.backgroundColor=borderColor;if(!picker[STXTouchAction]){STX.MenuManager.attachColorPicker(picker,STX.DialogManager,chooseColor("border-left-color",className));}
if(borderColor&&borderColor!="transparent")$$$("#candleBordersOn",$$(id)).checked=true;if(mountainGradientCheckbox&&color&&color.indexOf("rgba("==0))mountainGradientCheckbox.checked=true;}}};STX.ThemeManager.createTheme=function(stx){var theme={};if(STX.ThemeManager.baseTheme)theme["baseTheme"]=STX.ThemeManager.baseTheme;for(var className in STX.ThemeManager.classMapping){var mapping=STX.ThemeManager.classMapping[className];if(mapping){var firstClass=STX.first(mapping);var style=stx.canvasStyle(firstClass);theme[className]={color:style.color};if(style.borderTopColor)theme[className]["borderTopColor"]=style.borderTopColor;if(style.backgroundColor)theme[className]["backgroundColor"]=style.backgroundColor;if(style["border-left-color"]&&style["border-left-color"]!="transparent"){theme[className]["border-left-color"]=style["border-left-color"];}else{theme[className]["border-left-color"]="transparent";}}else{if(stx.chart.container)
theme[className]=stx.chart.container.style[className];}}
return theme;};STX.ThemeManager.saveTheme=function(name,stx){var theme=STX.ThemeManager.createTheme(stx);STX.ThemeManager.themes.customThemes[name]=theme;STX.ThemeManager.themes.enabledTheme=name;if(STX.ThemeManager.storageCB)STX.ThemeManager.storageCB(JSON.stringify(STX.ThemeManager.themes),stx);STX.ThemeManager.themesToMenu(STX.ThemeManager.el,STX.ThemeManager.el2,STX.ThemeManager.stx,STX.ThemeManager.storageCB);};STX.ThemeManager.setThemes=function(obj,stx){if(obj!=null){if(obj.customThemes)STX.ThemeManager.themes.customThemes=obj.customThemes;STX.ThemeManager.themes.enabledTheme=obj.enabledTheme;if(STX.ThemeManager.themes.enabledTheme){STX.ThemeManager.enableTheme(stx,STX.ThemeManager.themes.enabledTheme);}}};STX.ThemeManager.enableTheme=function(stx,theme){function addCustomizations(){var obj=STX.ThemeManager.themes.customThemes[theme];for(var className in obj){if(className=="baseTheme")continue;var mapping=STX.ThemeManager.classMapping[className];if(mapping){for(var mapped in mapping){stx.canvasStyle(mapped);stx.styles[mapped].color=obj[className].color;if(obj[className]["border-left-color"]){stx.styles[mapped]["border-left-color"]=obj[className]["border-left-color"];}
if(className=="stx_mountain"){stx.styles[mapped]["backgroundColor"]=obj[className].backgroundColor;stx.styles[mapped]["borderTopColor"]=obj[className].borderTopColor;if(!stx.styles[mapped]["backgroundColor"])stx.styles[mapped]["backgroundColor"]=obj[className].color;if(!stx.styles[mapped]["borderTopColor"])stx.styles[mapped]["borderTopColor"]=obj[className].color;}}}else{if(stx.chart.container)stx.chart.container.style[className]=obj[className];}}
if(stx.chart.container){stx.clearPixelCache();stx.draw();}}
var obj=STX.ThemeManager.themes.customThemes[theme];if(obj){var baseTheme=obj["baseTheme"];STX.ThemeManager.loadBuiltInTheme(stx,baseTheme,addCustomizations);STX.ThemeManager.themes.enabledTheme=theme;if(STX.ThemeManager.storageCB)STX.ThemeManager.storageCB(JSON.stringify(STX.ThemeManager.themes),stx);}else{STX.ThemeManager.loadBuiltInTheme(stx,theme);}};STX.ThemeManager.enableBuiltInTheme=function(stx,theme){STX.ThemeManager.loadBuiltInTheme(stx,theme);STX.ThemeManager.themes.enabledTheme=theme;if(STX.ThemeManager.storageCB)STX.ThemeManager.storageCB(JSON.stringify(STX.ThemeManager.themes),stx);};STX.ThemeManager.loadBuiltInTheme=function(stx,theme,cb){if(!theme){if(cb)cb();return;}
var themeName=STX.ThemeManager.builtInThemes[STX.ThemeManager.baseTheme];if(typeof themeName!="string")themeName=STX.ThemeManager.baseTheme;STX.unappendClassName($$$("body"),themeName);var themeName=STX.ThemeManager.builtInThemes[theme];if(typeof themeName!="string")themeName=theme;STX.appendClassName($$$("body"),themeName);stx.styles={};stx.chart.container.style.backgroundColor="";if(stx.displayInitialized){stx.initializeChart();stx.clearPixelCache();stx.draw();}
STX.ThemeManager.baseTheme=theme;if(cb)cb();};STX.ThemeManager.themesToMenu=function(el,el2,stx,cb){STX.ThemeManager.el=el;STX.ThemeManager.el2=el2;STX.ThemeManager.stx=stx;STX.ThemeManager.storageCB=cb;function useBuiltInTheme(theme){return function(){STX.ThemeManager.enableBuiltInTheme(stx,theme);};}
function useTheme(theme){return function(){STX.ThemeManager.enableTheme(stx,theme);};}
function deleteTheme(theme){return function(){STX.ThemeManager.enableBuiltInTheme(stx,STX.ThemeManager.baseTheme);delete STX.ThemeManager.themes.customThemes[theme];STX.ThemeManager.themesToMenu(el,el2,stx,cb);if(cb)cb(JSON.stringify(STX.ThemeManager.themes),stx);};}
var els=el.querySelectorAll("li");for(var i=0;i<els.length;i++){if(els[i].style.display=="block")
el.removeChild(els[i]);}
var template=el.querySelectorAll(".themeSelectorTemplate")[0];for(var theme in STX.ThemeManager.themes.customThemes){var li=template.cloneNode(true);li.style.display="block";var stxItem=$$$(".stxItem",li);stxItem.innerHTML=theme;stxItem[STXTouchAction]=useTheme(theme);el.appendChild(li);$$$(".stxClose",li)[STXTouchAction]=deleteTheme(theme);}
STX.clearNode(el2);for(var theme in STX.ThemeManager.builtInThemes){var li=STX.newChild(el2,"li");li.innerHTML=STX.I18N.translate(theme);li[STXTouchAction]=useBuiltInTheme(theme);}};STX.iscroll=function(){};STX.iscroll.scrollers=[];STX.iscroll.newScroller=function(node,params){var iscroll;if(params.version){iscroll=new iScroll5(node,params);}else{iscroll=new iScroll(node,params);}
STX.iscroll.scrollers.push(iscroll);return iscroll;};STX.iscroll.refresh=function(){for(var i=0;i<STX.iscroll.scrollers;i++){var iscroll=STX.iscroll.scrollers[i];iscroll.refresh();}};STX.LookupWidget=function(config){this.config=config;this.div=null;this.currentFilter=null;this.filterButtons=[];this.height=480;};STX.LookupWidget.prototype.displayResults=function(results){function select(that,symbol){return function(e){that.config.input.value=symbol;that.config.selectCallback(that,symbol,that.currentFilter);that.close();that.config.input.blur();};}
if(this.ul)STX.clearNode(this.ul);if(results.length>0){this.display();}else{return;}
for(var i=0;i<results.length;i++){var result=results[i];var li=STX.newChild(this.ul,"LI");var symbolSpan=STX.newChild(li,"span");symbolSpan.innerHTML=result.symbol;var descriptionSpan=STX.newChild(li,"span");if(result.description==null)result.description=result.name;descriptionSpan.innerHTML=result.description;var exchangeSpan=STX.newChild(li,"span");if(result.exchange==null)result.exchange=result.exchDisp;if(result.exchange)exchangeSpan.innerHTML=STX.I18N.translate(result.exchange);STX.ScrollManager.attach(li,select(this,result.symbol));}
if(!this.iscroll){this.iscroll=STX.iscroll.newScroller(this.ul.parentNode,{vScrollbar:true,hScroll:false,hideScrollbar:false});}else{this.iscroll.refresh();}};STX.LookupWidget.prototype.init=function(){function closure(that){return function(e){var div=STX.getEventDOM(e);var key=(window.event)?event.keyCode:e.keyCode;switch(key){case 13:var symbol=div.value;that.close();that.config.selectCallback(that,symbol,that.currentFilter);div.blur();break;case 27:that.close();div.blur();break;default:that.config.textCallback(that,div.value,that.currentFilter,false);break;}
e=e||event;e.stopPropagation?e.stopPropagation():e.cancelBubble=true;};}
function closure2(that){return function(e){var div=STX.getEventDOM(e);that.config.textCallback(that,div.value,that.currentFilter,true);};}
this.config.input.onkeyup=closure(this);this.config.input.onclick=closure2(this);if(this.config.ciqLookupService&&this.config.ciqLookupService.enable){this.loadService(this.config.ciqLookupService.exchanges);}};STX.LookupWidget.prototype.loadService=function(exchanges){if(typeof require==="function"&&require.defined){require(["stxSymLookup_Xignite"],function(_stx_exports){(function(){_stx_exports.STX.SymbolLookupModule.subscribedExchanges=exchanges;_stx_exports.STX.SymbolLookupModule.loadSymbolLookupTables(false);}());});}else{var script="stxSymLookup_Xignite.js";STX.loadScript(script,function(){STX.SymbolLookupModule.subscribedExchanges=exchanges;STX.SymbolLookupModule.loadSymbolLookupTables(false);});}};STX.LookupWidget.prototype.display=function(){function pressFilter(that,div,filter){return function(){for(var i=0;i<that.filterButtons.length;i++){STX.unappendClassName(that.filterButtons[i],"on");}
STX.appendClassName(div,"on");that.currentFilter=filter;that.config.textCallback(that,that.config.input.value,that.currentFilter);};}
if(this.div==null){this.div=STX.newChild(this.config.input.parentNode,"DIV","menuOutline stxLookupResults");var ul=STX.newChild(this.div,"UL","stxResults");if(this.config.filters){var li=STX.newChild(ul,"LI","stxLookupFilter");for(var i=0;i<this.config.filters.length;i++){var filter=this.config.filters[i];var div=STX.newChild(li,"div","stx-btn");div.innerHTML=STX.I18N.translate(filter);div[STXTouchAction]=pressFilter(this,div,filter);this.filterButtons.push(div);}
STX.newChild(ul,"LI","divider");}
var li=STX.newChild(ul,"LI");this.ul=STX.newChild(li,"UL","menuSelect stxLookupSymbols");li.style.maxHeight=this.height+"px";if(!this.config.cascade)STX.MenuManager.menuOff(true,true);}else{if(this.div.style.display=="none"){if(!this.config.cascade)STX.MenuManager.menuOff(true,true);}
this.div.style.display="inline-block";}
function closeCallback(that){return function(){if(that.div)that.div.style.display="none";};}
STX.MenuManager.menuOn("lookup",closeCallback(this),this.config.cascade);};STX.LookupWidget.prototype.close=function(){if(this.div)this.div.style.display="none";STX.MenuManager.menuOff(true);};STX.ScrollManager=function(){};STX.ScrollManager.x=0;STX.ScrollManager.y=0;STX.ScrollManager.downTime=0;STX.ScrollManager.attach=function(node,fc){if(navigator.pointerEnabled){node.addEventListener("pointerdown",STX.ScrollManager.start);}else if(navigator.msMaxTouchPoints>1){node.addEventListener("MSPointerDown",STX.ScrollManager.start);}else{node.addEventListener("mousedown",STX.ScrollManager.start);node.addEventListener("touchstart",STX.ScrollManager.start);}
node.addEventListener("click",function(fc){return function(e){if(STX.ScrollManager.isClick(e)){fc(e);}};}(fc));};STX.ScrollManager.start=function(e){STX.ScrollManager.x=e.pageX;STX.ScrollManager.y=e.pageY;if(e.touches&&e.touches.length>=1){STX.ScrollManager.x=e.touches[0].pageX;STX.ScrollManager.y=e.touches[0].pageY;}
STX.ScrollManager.downTime=new Date().getTime();};STX.ScrollManager.isClick=function(e){var now=new Date().getTime();if(now-STX.ScrollManager.downTime>2000)return false;if(Math.abs(e.pageX-STX.ScrollManager.x)>10)return false;if(Math.abs(e.pageY-STX.ScrollManager.y)>10)return false;return true;};STX.ScrollManager.attachRightClick=function(node,fc){function closure(fc){return function(e){if((e.which&&e.which>=2)||(e.button&&e.button>=2)){fc(e);}};}
if(navigator.pointerEnabled){node.addEventListener("pointerup",closure(fc));}else if(navigator.msMaxTouchPointers>1){node.addEventListener("MSPointerUp",closure(fc));}else{node.addEventListener("mouseup",closure(fc));}
node.rightClickable=true;};STX.ScrollManager.onContextMenu=function(e){if(e.target.rightClickable){e.preventDefault();return false;}};document.addEventListener("contextmenu",STX.ScrollManager.onContextMenu,false);STX.TimeZoneWidget=function(){};STX.TimeZoneWidget.init=function(){if(typeof timezoneJS!="undefined"){STX.TimeZoneWidget.timezoneMenu={};for(var i in timezoneJS.timezone.zones){var s=i.split("/");var region=s[0];if(!STX.TimeZoneWidget.timezoneMenu[region])STX.TimeZoneWidget.timezoneMenu[region]=[];if(s.length>1){var city=s[1];if(s.length>2)city+="/"+ s[2];STX.TimeZoneWidget.timezoneMenu[region].push(city);}}}};STX.TimeZoneWidget.setTimeZone=function(zone){STXChart.defaultDisplayTimeZone=zone;for(var i=0;i<STXChart.registeredContainers.length;i++){var stx=STXChart.registeredContainers[i].stx;stx.setTimeZone(stx.dataZone,zone);stx.draw();}};STX.TimeZoneWidget.removeTimeZone=function(){STXChart.defaultDisplayTimeZone=null;for(var i=0;i<STXChart.registeredContainers.length;i++){var stx=STXChart.registeredContainers[i].stx;stx.displayZone=null;stx.setTimeZone();if(STX.TimeZoneWidget.storageCB){STX.TimeZoneWidget.storageCB(null);}
if(stx.displayInitialized)stx.draw();}};STX.TimeZoneWidget.timeZoneMap={"(GMT-12:00) International Date Line West":"Asia/Anadyr","(GMT-11:00) Midway Island, Samoa":"Pacific/Midway","(GMT-10:00) Hawaii":"Pacific/Honolulu","(GMT-09:00) Alaska":"America/Juneau","(GMT-08:00) Pacific Time (US and Canada); Tijuana":"America/Los_Angeles","(GMT-07:00) Mountain Time (US and Canada)":"America/Denver","(GMT-07:00) Chihuahua, La Paz, Mazatlan":"America/Chihuahua","(GMT-07:00) Arizona":"America/Phoenix","(GMT-06:00) Central Time (US and Canada)":"America/Chicago","(GMT-06:00) Saskatchewan":"Canada/Saskatchewan","(GMT-06:00) Guadalajara, Mexico City, Monterrey":"America/Mexico_City","(GMT-06:00) Central America":"America/Panama","(GMT-05:00) Eastern Time (US and Canada)":"America/New_York","(GMT-05:00) Indiana (East)":"America/Indiana/Knox","(GMT-05:00) Bogota, Lima, Quito":"America/Bogota","(GMT-04:00) Atlantic Time (Canada)":"Canada/Atlantic","(GMT-04:00) Caracas, La Paz":"America/Caracas","(GMT-04:00) Santiago":"America/Santiago","(GMT-03:30) Newfoundland and Labrador":"Canada/Newfoundland","(GMT-03:00) Brasilia":"Brazil/East","(GMT-03:00) Buenos Aires, Georgetown":"America/Argentina/Buenos_Aires","(GMT-03:00) Greenland":"America/Argentina/Buenos_Aires","(GMT-02:00) Mid-Atlantic":"Atlantic/South_Georgia","(GMT-01:00) Azores":"Atlantic/Azores","(GMT-01:00) Cape Verde Islands":"Atlantic/Cape_Verde","(GMT) Greenwich Mean Time: Reykjavik":"Atlantic/Reykjavik","(GMT) Dublin, Edinburgh, Lisbon, London":"Europe/London","(GMT+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague":"Europe/Belgrade","(GMT+01:00) Sarajevo, Skopje, Warsaw, Zagreb":"Europe/Sarajevo","(GMT+01:00) Brussels, Copenhagen, Madrid, Paris":"Europe/Brussels","(GMT+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna":"Europe/Amsterdam","(GMT+01:00) West Central Africa":"Africa/Windhoek","(GMT+02:00) Bucharest":"Europe/Bucharest","(GMT+02:00) Cairo":"Africa/Cairo","(GMT+02:00) Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius":"Europe/Helsinki","(GMT+02:00) Athens, Istanbul, Minsk":"Europe/Athens","(GMT+02:00) Jerusalem":"Asia/Jerusalem","(GMT+02:00) Harare, Pretoria":"Africa/Harare","(GMT+03:00) Moscow, St. Petersburg, Volgograd":"Europe/Moscow","(GMT+03:00) Kuwait, Riyadh":"Asia/Kuwait","(GMT+03:00) Nairobi":"Africa/Nairobi","(GMT+03:00) Baghdad":"Asia/Baghdad","(GMT+03:30) Tehran":"Asia/Tehran","(GMT+04:00) Abu Dhabi, Muscat":"Asia/Muscat","(GMT+04:00) Baku, Tbilisi, Yerevan":"Asia/Baku","(GMT+04:30) Kabul":"Asia/Kabul","(GMT+05:00) Ekaterinburg":"Asia/Yekaterinburg","(GMT+05:00) Islamabad, Karachi, Tashkent":"Asia/Karachi","(GMT+05:30) Chennai, Kolkata, Mumbai, New Delhi":"Asia/Kolkata","(GMT+05:45) Kathmandu":"Asia/Katmandu","(GMT+06:00) Astana, Dhaka":"Asia/Dhaka","(GMT+06:00) Sri Jayawardenepura":"Asia/Colombo","(GMT+06:00) Almaty, Novosibirsk":"Asia/Novosibirsk","(GMT+06:30) Yangon Rangoon":"Asia/Rangoon","(GMT+07:00) Bangkok, Hanoi, Jakarta":"Asia/Bangkok","(GMT+07:00) Krasnoyarsk":"Asia/Krasnoyarsk","(GMT+08:00) Beijing, Chongqing, Hong Kong SAR, Urumqi":"Asia/Hong_Kong","(GMT+08:00) Kuala Lumpur, Singapore":"Asia/Kuala_Lumpur","(GMT+08:00) Taipei":"Asia/Taipei","(GMT+08:00) Perth":"Australia/Perth","(GMT+08:00) Irkutsk, Ulaanbaatar":"Asia/Irkutsk","(GMT+09:00) Seoul":"Asia/Seoul","(GMT+09:00) Osaka, Sapporo, Tokyo":"Asia/Tokyo","(GMT+09:00) Yakutsk":"Asia/Yakutsk","(GMT+09:30) Darwin":"Australia/Darwin","(GMT+09:30) Adelaide":"Australia/Adelaide","(GMT+10:00) Canberra, Melbourne, Sydney":"Australia/Canberra","(GMT+10:00) Brisbane":"Australia/Brisbane","(GMT+10:00) Hobart":"Australia/Hobart","(GMT+10:00) Vladivostok":"Asia/Vladivostok","(GMT+10:00) Guam, Port Moresby":"Pacific/Guam","(GMT+11:00) Magadan, Solomon Islands, New Caledonia":"Etc/GMT+11","(GMT+12:00) Fiji Islands, Kamchatka, Marshall Islands":"Pacific/Fiji","(GMT+12:00) Auckland, Wellington":"Pacific/Auckland","(GMT+13:00) Nuku'alofa":"Pacific/Tongatapu"};STX.TimeZoneWidget.populateDialog=function(id){if(!STX.TimeZoneWidget.timezoneMenu)STX.TimeZoneWidget.init();function setTimezone(zone){return function(e){STX.DialogManager.dismissDialog();var translatedZone=STX.TimeZoneWidget.timeZoneMap[zone];STX.TimeZoneWidget.setTimeZone(translatedZone);if(STX.TimeZoneWidget.storageCB){STX.TimeZoneWidget.storageCB(translatedZone);}};}
if(typeof timezoneJS=="undefined")return;var el=$$(id);if(!el)return;var ul=el.querySelector("ul");var template=ul.querySelector("li#timezoneTemplate").cloneNode(true);STX.clearNode(ul);ul.appendChild(template);var arr=[];for(var zone in STX.TimeZoneWidget.timeZoneMap){arr.push(zone);}
for(var i=0;i<arr.length;i++){var zone=arr[i];var display=zone;var li=template.cloneNode(true);li.style.display="block";li.innerHTML=display;STX.ScrollManager.attach(li,setTimezone(zone));ul.appendChild(li);}
if(!STX.TimeZoneWidget.iscroll){STX.TimeZoneWidget.iscroll=new iScroll("timezoneDialogWrapper",{vScrollbar:false,hScroll:false,hideScrollbar:false,vScroll:true});}else{STX.TimeZoneWidget.iscroll.refresh();}};STX.TimeZoneWidget.initialize=function(initialTimeZone,cb){if(initialTimeZone){STX.TimeZoneWidget.setTimeZone(initialTimeZone);}
STX.TimeZoneWidget.storageCB=cb;};STX.StorageManager=function(){};STX.StorageManager.get=function(key){if(!STX.localStorage)return null;var datum=STX.localStorage.getItem(key);return datum;};STX.StorageManager.store=function(key,value){STX.localStorage.setItem(key,value);};STX.StorageManager.remove=function(key){STX.localStorage.removeItem(key);};STX.StorageManager.callbacker=function(key){return function(value,stx){if(value==null){STX.StorageManager.remove(key);}else{STX.StorageManager.store(key,value);}};};STX.FibDialog=function(){};STX.FibDialog.initialize=function(element){var template=$$$(".fib-template",element);var fibs=[-.786,-.618,-.5,-.382,-.236,0,.236,.382,.5,.618,.786,1,1.382,1.618,2.618,4.236];for(var i=0;i<fibs.length;i++){var fib=fibs[i];var li=template.cloneNode(true);li.style.display="block";$$$(".stx-fib-level",li).innerHTML=fib;li.fib=fib;li.id="stx-fib-"+ fib.toString().replace(".","");template.parentNode.appendChild(li);}};STX.FibDialog.restore=function(fibonacci){STX.FibDialog.fibonacci=fibonacci;var fibTemplates=document.querySelectorAll(".fib-template");for(var i=0;i<fibTemplates.length;i++){$$$(".check input",fibTemplates[i]).checked=false;}
for(var i=0;i<fibonacci.fibs.length;i++){var fibdef=fibonacci.fibs[i];var template=$$$("#stx-fib-"+ fibdef.level.toString().replace(".",""));if(!template)continue;$$$(".check input",template).checked=true;}};STX.FibDialog.save=function(){var fibonacci=STX.FibDialog.fibonacci;fibonacci.fibs=[];var fibTemplates=document.querySelectorAll(".fib-template");for(var i=0;i<fibTemplates.length;i++){var fibTemplate=fibTemplates[i];if($$$(".check input",fibTemplate).checked){fibonacci.fibs.push({level:fibTemplate.fib,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}});}}
if(STX.FibDialog.drawingToolbar){STX.FibDialog.drawingToolbar.stx.currentVectorParameters.fibonacci=fibonacci;if(STX.FibDialog.drawingToolbar.callback)STX.FibDialog.drawingToolbar.callback();}
return fibonacci;};STX.FibDialog.setLine=function(weight,pattern,htmlElement){alert(pattern);};STX.FibDialog.display=function(drawingToolbar){var dialog=$$$("#fibDialog");STX.FibDialog.drawingToolbar=drawingToolbar;STX.FibDialog.restore(drawingToolbar.stx.currentVectorParameters.fibonacci);STX.DialogManager.displayDialog(dialog);};STX.DrawingToolbar=function(htmlElement,stx,callback){this.stx=stx;this.callback=callback;this.initialize(htmlElement);this.setVectorType(null);};STX.DrawingToolbar.prototype.initialize=function(htmlElement){this.htmlElement=htmlElement;htmlElement.DrawingToolbar=this;function setLineColor(self){return function(color){if(color=="000000"||color=="ffffff")self.stx.currentVectorParameters.currentColor="auto";else self.stx.currentVectorParameters.currentColor="#"+ color;if(self.callback)self.callback();};}
function setFillColor(self){return function(color){self.stx.currentVectorParameters.fillColor="#"+ color;if(self.callback)self.callback();};}
var toolbar=this.htmlElement;var lineColorPicker=$$$(".stxLineColorPicker",toolbar);if(this.stx.currentVectorParameters.currentColor=="auto")
this.stx.currentVectorParameters.currentColor=lineColorPicker.style.backgroundColor;else
lineColorPicker.style.backgroundColor=this.stx.currentVectorParameters.currentColor;STX.MenuManager.attachColorPicker(lineColorPicker,toolbar,setLineColor(this));var fillColorPicker=$$$(".stxFillColorPicker",toolbar);if(this.stx.currentVectorParameters.fillColor=="auto")
this.stx.currentVectorParameters.fillColor=fillColorPicker.style.backgroundColor;else
fillColorPicker.style.backgroundColor=this.stx.currentVectorParameters.fillColor;STX.MenuManager.attachColorPicker(fillColorPicker,toolbar,setFillColor(this));var display=$$$(".stxAxisLabel",toolbar);if(display){STX.unappendClassName(display,!this.stx.currentVectorParameters.axisLabel);STX.appendClassName(display,this.stx.currentVectorParameters.axisLabel);}
if(this.stx.currentVectorParameters.annotation.font.style=="italic")
STX.appendClassName($$$(".stx-toolbar .stx-annotation-italic",htmlElement),"active");if(this.stx.currentVectorParameters.annotation.font.weight=="bold")
STX.appendClassName($$$(".stx-toolbar .stx-annotation-bold",htmlElement),"active");if(this.stx.currentVectorParameters.annotation.font.size)STX.DrawingToolbar.setFont(htmlElement,this.stx.currentVectorParameters.annotation.font.size);if(this.stx.currentVectorParameters.annotation.font.family)STX.DrawingToolbar.setFont(htmlElement,this.stx.currentVectorParameters.annotation.font.family);this.setLine(this.stx.currentVectorParameters.lineWidth,this.stx.currentVectorParameters.pattern);};STX.DrawingToolbar.initialize=function(){};STX.DrawingToolbar.prototype.setLineColor=function(stx){var lineColorPicker=$$$(".stxLineColorPicker",this.htmlElement);if(this.stx.currentVectorParameters.currentColor=="transparent"){lineColorPicker.style.backgroundColor=stx.defaultColor;}else{lineColorPicker.style.backgroundColor=this.stx.currentVectorParameters.currentColor;}};STX.DrawingToolbar.configurator={".stxToolbarFill":{"measure":false,"line":false,"ray":false,"segment":false,"annotation":false,"horizontal":false,"vertical":false,"continuous":false,"fibonacci":false,"freeform":false},".stxToolbarLine":{},".stxToolbarLinePicker":{"fibonacci":false,"annotation":false},".stxToolbarNone":{"measure":false,"line":false,"ray":false,"segment":false,"annotation":false,"horizontal":false,"vertical":false,"continuous":false,"fibonacci":false,"freeform":false},".stxToolbarDotted":{},".stxToolbarDashed":{},".stxToolbarAxisLabel":{"measure":false,"line":false,"ray":false,"segment":false,"annotation":false,"rectangle":false,"ellipse":false,"continuous":false,"fibonacci":false,"freeform":false},".stxToolbarAnnotation":{"measure":false,"line":false,"ray":false,"segment":false,"horizontal":false,"vertical":false,"rectangle":false,"ellipse":false,"continuous":false,"fibonacci":false,"freeform":false},"#stx-toolbar-settings":{"measure":false,"line":false,"ray":false,"segment":false,"annotation":false,"horizontal":false,"vertical":false,"rectangle":false,"ellipse":false,"continuous":false,"freeform":false},};STX.DrawingToolbar.prototype.setLine=function(width,pattern){var className="stx-line stxLineDisplay weight"+ width;this.stx.currentVectorParameters.lineWidth=width;if(this.stx.currentVectorParameters.lineWidth==Math.floor(this.stx.currentVectorParameters.lineWidth))
this.stx.currentVectorParameters.lineWidth+=.1;if(pattern=="solid"){this.stx.currentVectorParameters.pattern="solid";className+=" style1";}else if(pattern=="dotted"){this.stx.currentVectorParameters.pattern="dotted";className+=" style2";}else if(pattern=="dashed"){this.stx.currentVectorParameters.pattern="dashed";className+=" style3";}else if(pattern=="none"){this.stx.currentVectorParameters.pattern="none";}
var display=$$$(".stx-toolbar .stxLineDisplay",this.htmlElement);if(display)display.className=className;if(this.callback)this.callback();};STX.DrawingToolbar.setLine=function(width,pattern,div){var self=STX.DrawingToolbar.findInstance(div);self.setLine(width,pattern);};STX.DrawingToolbar.prototype.settingsDialog=function(){if(this.stx.currentVectorParameters.vectorType=="fibonacci"){STX.FibDialog.display(this);}};STX.DrawingToolbar.settingsDialog=function(div){var self=STX.DrawingToolbar.findInstance(div);self.settingsDialog();};STX.DrawingToolbar.prototype.toggleAxisLabel=function(){this.stx.currentVectorParameters.axisLabel=!this.stx.currentVectorParameters.axisLabel;var display=$$$(".stx-toolbar .stxAxisLabel",this.htmlElement);if(display){STX.unappendClassName(display,(!this.stx.currentVectorParameters.axisLabel).toString());STX.appendClassName(display,this.stx.currentVectorParameters.axisLabel.toString());}
if(this.callback)this.callback();};STX.DrawingToolbar.toggleAxisLabel=function(div){var self=STX.DrawingToolbar.findInstance(div);self.toggleAxisLabel();};STX.DrawingToolbar.setFont=function(div,txt){var fontSizeRegEx=new RegExp("[0-9]+px");var self=STX.DrawingToolbar.findInstance(div);if(txt=="italic"){var button=$$$(".stx-toolbar .stx-annotation-italic",self.htmlElement);if(self.stx.currentVectorParameters.annotation.font.style=="italic"){self.stx.currentVectorParameters.annotation.font.style=null;STX.unappendClassName(button,"active");}else{self.stx.currentVectorParameters.annotation.font.style="italic";STX.appendClassName(button,"active");}}else if(txt=="bold"){var button=$$$(".stx-toolbar .stx-annotation-bold",self.htmlElement);if(self.stx.currentVectorParameters.annotation.font.weight=="bold"){self.stx.currentVectorParameters.annotation.font.weight=null;STX.unappendClassName(button,"active");}else{self.stx.currentVectorParameters.annotation.font.weight="bold";STX.appendClassName(button,"active");}}else if(fontSizeRegEx.test(txt)){self.stx.currentVectorParameters.annotation.font.size=txt;$$$(".stx-toolbar .stx-annotation-size > span",self.htmlElement).innerHTML=STX.stripPX(txt);}else if(txt=="Default"){self.stx.currentVectorParameters.annotation.font.family=null;$$$(".stx-toolbar .stx-annotation-family > span",self.htmlElement).innerHTML=txt;}else{self.stx.currentVectorParameters.annotation.font.family=txt;$$$(".stx-toolbar .stx-annotation-family > span",self.htmlElement).innerHTML=txt;}
if(self.callback)self.callback();};STX.DrawingToolbar.prototype.setVectorType=function(vectorType){var stx=this.stx;if(vectorType==null||vectorType==""){stx.changeVectorType("");for(var i in STX.DrawingToolbar.configurator){var all=this.htmlElement.querySelectorAll(i);for(var j=0;j<all.length;j++){all[j].style.display="none";}}
$$$("#toolSelection",this.htmlElement).innerHTML=STX.I18N.translate("Select Tool");return;}
for(var i in STX.DrawingToolbar.configurator){var all=this.htmlElement.querySelectorAll(i);for(var j=0;j<all.length;j++){if(STX.DrawingToolbar.configurator[i][vectorType]==false){all[j].style.display="none";}else{all[j].style.display="";}}}
if(stx.currentVectorParameters.pattern=="none"&&!STX.DrawingToolbar.configurator[".stxToolbarNone"][vectorType])
this.setLine(stx.currentVectorParameters.lineWidth,"solid");stx.changeVectorType(vectorType);var prettyDisplay=STX.I18N.translate(vectorType.capitalize());$$$("#toolSelection",this.htmlElement).innerHTML=prettyDisplay;this.setLineColor(stx);};STX.DrawingToolbar.setVectorType=function(stx,vectorType,div){var self=STX.DrawingToolbar.findInstance(div);if(!self){self=STX.DrawingToolbar._default=new STX.DrawingToolbar($$$(".stx-toolbar"),stx);}
self.stx=stx;self.setVectorType(vectorType);};STX.DrawingToolbar.setDrawingType=function(vectorType,div){var self=STX.DrawingToolbar.findInstance(div);self.setVectorType(vectorType);};STX.DrawingToolbar.findInstance=function(div){if(!div)return STX.DrawingToolbar._default;for(var i=0;i<40;i++){if(STX.hasClassName(div,"stx-toolbar"))break;div=div.parentNode;if(!div)return STX.DrawingToolbar._default;}
if(div.DrawingToolbar)return div.DrawingToolbar;return STX.DrawingToolbar._default;};STX.DrawingToolbar.prototype.crosshairs=function(state){var stx=this.stx;this.setVectorType(null);stx.layout.crosshair=state;if(state){$$$("#toolSelection",this.htmlElement).innerHTML=STX.I18N.translate("Crosshairs");}else{$$$("#toolSelection",this.htmlElement).innerHTML=STX.I18N.translate("Select Tool");}
stx.doDisplayCrosshairs();stx.positionCrosshairsAtPointer();stx.findHighlights(false,true);stx.changeOccurred("layout");stx.draw();};STX.DrawingToolbar.crosshairs=function(stx,state,div){var self=STX.DrawingToolbar.findInstance(div);self.stx=stx;self.crosshairs(state);};STX.DrawingToolbar.setCrosshairs=function(state,div){var self=STX.DrawingToolbar.findInstance(div);self.crosshairs(state);};STXChart.version=["Version 2014-12-02"];STXChart.drawingLine=false;STXChart.resizingPanel=null;STXChart.vectorType="";STXChart.crosshairX=0;STXChart.crosshairY=0;STXChart.insideChart=false;STXChart.overXAxis=false;STXChart.overYAxis=false;STXChart.currentColor="auto";STXChart.drawingTools={};STXChart.useAnimation=false;STXChart.ipadMaxTicks=1500;STXChart.enableCaching=false;STXChart.ignoreTouch=false;STXChart.useOldAndroidClear=true;STXChart.currentVectorParameters={vectorType:null,pattern:"solid",lineWidth:1,fillColor:"#7DA6F5",currentColor:"auto",axisLabel:"true",fibonacci:{trend:{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},fibs:[{level:-.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:-.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:0,color:"auto",parameters:{pattern:"solid",lineWidth:1}},{level:.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:.5,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:1,color:"auto",parameters:{pattern:"solid",lineWidth:1}},{level:1.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:1.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}}],extendLeft:false,printLevels:true,printValues:false},annotation:{font:{style:null,size:null,weight:null,family:null}}};STXChart.defaultDisplayTimeZone=null;if(typeof $$=="undefined"){$$=function(node){return{};};}
STX.MILLISECOND=0;STX.SECOND=1000;STX.MINUTE=60*STX.SECOND;STX.HOUR=60*STX.MINUTE;STX.DAY=24*STX.HOUR;STX.MONTH=31*STX.DAY;STX.YEAR=365*STX.DAY;STX.DECADE=10*STX.YEAR;STXChart.Chart=function(){};STXChart.YAxis=function(){};STXChart.XAxis=function(){};STXChart.Panel=function(name){this.yAxis=new STXChart.YAxis();this.name=name;};STXChart.YAxis.prototype={high:null,low:null,shadow:null,logHigh:null,logLow:null,logShadow:null,multiplier:null,bottomOffset:0,topOffset:0,initialMarginTop:10,initialMarginBottom:10,zoom:0,scroll:0,bottom:null,top:null,height:null,decimalPlaces:null,idealTickSizePixels:null,displayBorder:false,displayGridLines:true,noDraw:null,priceFormatter:null};STXChart.Panel.prototype={name:null,display:null,chart:null,yAxis:null,top:null,bottom:null,height:null,percent:null};STXChart.XAxis.prototype={formatter:null,adjustTimeZone:true,idealTickSizePixels:100,timeUnit:null,timeUnitMultiplier:null,axisType:null,displayBorder:false,displayGridLines:true,minimumLabelWidth:50,futureTicks:true};STXChart.Chart.prototype={name:null,panel:null,symbol:null,symbolDisplay:null,series:{},scroll:0,standStill:0,maxTicks:0,xaxisFactor:30,masterData:null,dataSet:null,scrubbed:null,dataSegment:null,xaxis:[],volumeMax:0,decimalPlaces:2,roundit:100,beginHour:0,beginMinute:0,endHour:23,endMinute:59,minutesInSession:1440,xAxis:new STXChart.XAxis(),customChart:null};function STXChart(config){if(!config)config={container:null};if(config.constructor==HTMLDivElement){var newConfig={container:config};config=newConfig;}
this.panels={};this.overlays={};this.charts={};this.controls={};this.goneVertical=false;this.pinchingScreen=false;this.grabbingScreen=false;this.grabStartX=0;this.grabStartY=0;this.grabStartScrollX=0;this.grabStartScrollY=0;this.yTolerance=50;this.grabStartCandleWidth=0;this.grabStartZoom=0;this.grabOverrideClick=false;this.grabMode="";this.vectorsShowing=false;this.mouseMode=true;this.anyHighlighted=false;this.accessoryTimer=null;this.lastAccessoryUpdate=new Date().getTime();this.displayCrosshairs=true;this.hrPanel=null;this.annotationTA=null;this.editingAnnotation=false;this.openDialog="";this.displayIconsUpDown=true;this.displayIconsSolo=true;this.displayIconsClose=true;this.displayPanelResize=true;this.manageTouchAndMouse=true;this.touches=[];this.changedTouched=[];this.crosshairTick=null;this.crosshairValue=null;this.yaxisWidth=45;this.yaxisLeft=null;this.yaxisLabelStyle="roundRectArrow";this.axisBorders=true;this.pt={x1:-1,x2:-1,y1:-1,y2:-1};this.moveA=-1;this.moveB=-1;this.touchStartTime=-1;this.cancelSwipe=false;this.momentumDistance=0;this.momentumTime=0;this.gestureStartDistance=-1;this.grabStartPeriodicity=1;this.grabEndPeriodicity=-1;this.scrollEvent=null;this.cmd=false;this.ctrl=false;this.shift=false;this.userPointerDown=false;this.crosshairXOffset=-40;this.crosshairYOffset=-40;this.displayInitialized=false;this.underlayPercentage=.25;this.extendLastTick=true;this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1};this.cancelTouchSingleClick=false;this.layout={interval:"day",periodicity:1,candleWidth:8,volumeUnderlay:false,adj:true,chartType:"candle",studies:{},panels:{}};this.preferences={magnet:false,labels:true,whitespace:100};this.streamParameters={count:0,maxWait:100,maxTicks:100,timeout:-1};this.translationCallback=null;this.locale=null;this.dataZone=null;this.displayZone=null;this.timeZoneOffset=0;this.changeCallback=null;this.masterData=null;this.transformDataSetPre=null;this.transformDataSetPost=null;this.dataCallback=null;this.dontRoll=false;this.drawingObjects=[];this.undoStamps=[];this.dataSetContainsGaps=true;this.cleanupGaps=false;this.resizeDetectMS=1000;this.chart=new STXChart.Chart();this.chart.name="chart";this.chart.top=0;this.chart.width=null;this.chart.left=0;this.chart.right=-1;this.chart.canvas=null;this.chart.tempCanvas=null;this.chart.canvasHeight=null;this.chart.canvasWidth=null;this.chart.container=config.container;this.chart.allowScrollPast=true;this.chart.hideDrawings=false;this.candleWidthPercent=.65;this.charts["chart"]=this.chart;this.styles={};this.currentVectorParameters=STX.clone(STXChart.currentVectorParameters); // contains the current drawing parameters for this chart
			STX.extend(this, config);

			if(config.container){
				this.registerHTMLElements();
				// Initialize the very basic dimensions of chart so that it is operational immediately
				this.chart.width=this.chart.container.clientWidth-this.yaxisWidth;
				this.chart.maxTicks=Math.round((this.chart.width/this.layout.candleWidth)-.499);
				this.chart.canvasHeight=this.chart.container.clientHeight;

				// This prevents mousewheel events from inadvertently triggering page scroll in Firefox and IE
				if(!STX.FireFoxWheelWorkaround){
					if(STX.isIE){
						document.body.addEventListener("wheel", function(e){
							if(STXChart.insideChart){
								e.preventDefault();
								// IE won't propagate the event so we need to manually figure out if we're inside the chart
								for(var i=0;i<STXChart.registeredContainers.length;i++){
									var stx=STXChart.registeredContainers[i].stx;
									if(STXChart.crosshairX>=stx.chart.left &&
										STXChart.crosshairX<=stx.chart.canvasRight &&
										STXChart.crosshairY>=stx.chart.top &&
										STXChart.crosshairY<=stx.chart.bottom){
										stx.mouseWheel(e, "onmousewheel");
									}
								}
							}
						});
					}else{
						document.body.addEventListener("wheel", function(e){if(STXChart.insideChart) e.preventDefault();});
					}
					STX.FireFoxWheelWorkaround=true;
				}
			}
		}
		
		_exports.STXChart=STXChart;
		
		/**
		 * @deprecated
		 */
		STXChart.DrawingDescriptor={
				"name": "",
				"render": null, /// function(vector, color, context, highlight (boolean), temporary (boolean), stx)
				"intersected": null,	/// function(vector, x, y) returns whether coordinates intersect the object
				"click": null,	/// function(vector, clickNumber) called when mouse click or tap. Return true to end drawing. False to accept more clicks.
				"abort": null	/// called when user has aborted drawing action (esc key for instance)
		};
		
		/**
		 * Prepends custom developer functionality to an internal chart member. See Injection API tutorial.
		 * @param  {string} o Signature of member
		 * @param  {function} n Callback function, will be called with "apply"
		 * @memberOf  STXChart
		 */
		STXChart.prototype.prepend=function(o,n){
			var prepends=STXChart.prototype["prepend"+o];
			if(!prepends){
				STXChart.prototype["prepend"+o]=[n];
			}else{
				STXChart.prototype["prepend"+o]=[n].concat(prepends);
			}
		};
		
		/**
		 * Appends custom developer functionality to an internal chart member. See Injection API tutorial.
		 * @param  {string} o Signature of member
		 * @param  {function} n Callback function, will be called with "apply"
		 * @memberOf  STXChart
		 */
		STXChart.prototype.append=function(o,n){
			var appends=STXChart.prototype["append"+o];
			if(!appends){
				STXChart.prototype["append"+o]=[n];
			}else{
				appends.push(n);
			}
		};
		/**
		 * Removes custom developer functionality from an internal chart member. Will remove any and all appends or prepends.
		 * @param  {string} o Signature of member
		 * @memberOf  STXChart
		 */
		STXChart.prototype.remove=function(o){
			delete STXChart.prototype["append"+o];
			delete STXChart.prototype["prepend"+o];
		};
		
		STXChart.registeredContainers=[];	// This will contain an array of all of the STX container objects
		// Note that if you are dynamically destroying containers in the DOM you should delete them from this array when you do so
		
		/**
		 * @deprecated Use STX.ScrollManager.attachRightClick
		 */
		STXChart.handleContextMenu=function(e){ // This code prevents the browser context menu from popping up if you right click on a drawing or overlay
			if(!e) e=event;
			for(var i=0;i<STXChart.registeredContainers.length;i++){
				var stx=STXChart.registeredContainers[i].stx;
				if(stx){
					if(stx.anyHighlighted){
						if(e.preventDefault) e.preventDefault();
						return false;
					}
				}
			}
		};
		
		/**
		 * Base class for Quotes infrastructure. Many of the built in UI capabilities such as comparison charts expect
		 * to follow this infrastructure. You should define your own classes that follow this pattern (or derive a class from STX.Quotes)
		 * in order to adapt your quote feed to make the most use of the built in componentry.
		 * @name  STX.QuoteFeed
		 * @constructor
		 */
		STX.QuoteFeed=function(){};
		
		/**
		 * @callback STX.QuoteFeed~dataCallback
		 * @param {object} [error] Null if no error, otherwise an error object or condition
		 * @param {array} quotes An array of Quotes in required JSON format
		 * @param {boolean} [moreAvailable] Set this to true to enable pagination when user scrolls off the left of the chart.
		 */
		
		/**
		 * Override this method with your implementation to fetch data from your server. The charting engine will call this whenever
		 * it needs more data.
		 * @param  {object}   params Describes the data requested by the chart
		 * @param {STXChart} params.stx The chart object requesting data
		 * @param {string} params.symbol The symbol to fetch
		 * @param {number} params.period The period to fetch
		 * @param {string} params.interval The interval to fetch "minute","day","week","month"
		 * @param {Date} [params.startDate] The starting datetime. This will be sent for instance when the chart requires an update, to stream.
		 * @param {Date} [params.endDate] The ending datetime. This will be null unless it is a "loadMore" pagination operation.
		 * @param {number} params.ticks The number of ticks required to fill the chart screen. This can be used to determine how much data to fetch.
		 * @param  {STX.QuoteFeed~dataCallback} cb     Call this function with the data to update the chart
		 * @abstract
		 * @memberOf  STX.QuoteFeed
		 */
		STX.QuoteFeed.prototype.fetch=function(params, cb){

			// This is an outline for how to implement fetch in your custom feed
			if(params.startDate){
				// This means the chart is asking for refresh (stream) of most recent data. If you don't support
				// streaming then just do nothing and return.
			}else if(params.endDate){
				// This means the user has scrolled past the end of the chart. The chart needs older data, if it's available.
				// If you don't support pagination just return and do nothing.
			}else{
				// The chart needs an initial load. params.tick tells you how many bars are needed to fill up the chart
				// but you can return as many as you want. We recommend always returning at least 1,000 bars on initial load
				// 
				// Now fetch your data, probably using Ajax, and call the callback with your data when it comes in. See STX.QuoteFeed.Demo below for an actual implementation.
				// STX.postAjax(url, null, function(status, response){
				//     cb({quotes:yourData, moreAvailable:false}); // set moreAvailable to true or false if you know that more, older, data is available for when the user scrolls back in time.
				// });
			}
		};
				
		/**
		 * Whenever an error occurs the params and dataCallback from fetch will be passed to this method. Use this to alert the user if desired.
		 * Override this with your own alerting mechanisms.
		 * @param  {object} params The params originally passed into fetch()
		 * @param {object} dataCallback The data returned to fetch
		 * @memberOf  STX.QuoteFeed
		 */
		STX.QuoteFeed.prototype.announceError=function(params, dataCallback){
			if(params.startDate){
				// Perhaps some sort of "disconnected" message on screen
			}else if(params.endDate){
				// Perhaps something indicating the end of the chart
			}else{
				STX.alert("Error fetching quote:" + dataCallback.error);	// Probably a not found error?
			}
		};
		
		/**
		 * Fetches multiple quotes asynchronously, possibly from various data sources. This method is used to update a chart with multiple symbols
		 * such as a comparison chart.
		 * @param  {array}   arr Array of stock symbols
		 * @param  {Function} cb  Function to callback when quotes are fetched. Will be passed an array of results. Each result is an object {dataCallback, params}.
		 * @memberOf  STX.QuoteFeed
		 */
		STX.QuoteFeed.prototype.multiFetch=function(arr, cb){
			var tracker={
				counter:0,
				finished: arr.length,
				results: []
			};
		
			function handleResponse(params, tracker, cb){
				return function(dataCallback){
					tracker.results.push({dataCallback:dataCallback, params: params});
					tracker.counter++;
					if(tracker.counter==tracker.finished){
						cb(tracker.results);
					}
				};
			}
			for(var i=0;i<arr.length;i++){
				var params=arr[i];
				this.fetch(params, handleResponse(params, tracker, cb));
			}
		};
		
		/**
		 * Demo version of quotes which uses EOD data
		 * @name  STX.QuoteFeed.Demo
		 * @constructor
		 */
		STX.QuoteFeed.Demo=function(){};
		
		STX.QuoteFeed.Demo.stxInheritsFrom(STX.QuoteFeed);
		
		/*
		 * This is a demo version of fetch. You will need to create one for your own quote feed that behaves similarly.
		 * @memberOf  STX.QuoteFeed.Demo
		 */
		STX.QuoteFeed.Demo.prototype.fetch=function(params, cb){
			return;
			function setQuotes(response){
				var varName=response.substr(0,response.indexOf("="));
				try{
					return JSON.parse(response.substring(response.indexOf(varName+"=")+(varName+"=").length,response.length-1));
				}catch(e){
					return {};
				}
			}
			
			if(params.startDate){
				if(params.interval=="minute"){
					this.update(params, cb);
				}else{
					cb({error:"STX.QuoteFeed.Demo does not support updates for daily charts"});			
				}
				return;
			}
			if(params.endDate){
				if(params.interval=="minute"){
					this.loadMore(params, cb);
				}else{
					cb({error:"STX.QuoteFeed.Demo does not support loadMore for daily charts"});			
				}
				return;
			}
			if(params.interval=="minute"){
				this.generateIntraday(params, cb);
				return;
			}
			var url="http://demoquotes.whitelabelstockcharts.com/" + params.symbol.toUpperCase();
			STX.postAjax(url, null, function(status, response){
				if(status!=200){
					cb({error:status});
					return;
				}
				var quotes=setQuotes(response);
				var newQuotes=[];
				for(var i=0;i<quotes.length;i++){
					newQuotes[i]={};
					newQuotes[i].Date=quotes[i][0]; // Or set newQuotes[i].DT if you have a JS Date
					newQuotes[i].Open=quotes[i][1];
					newQuotes[i].High=quotes[i][2];
					newQuotes[i].Low=quotes[i][3];
					newQuotes[i].Close=quotes[i][4];
					newQuotes[i].Volume=quotes[i][5];
					newQuotes[i].Adj_Close=quotes[i][6];
				}
				cb({quotes:newQuotes, moreAvailable:false}); // set moreAvailable to true so that the chart will request more when scrolling into the past. Set to false if at the end of data.
			});
		};
		
		
		/**
		 * Creates a random update. Note that updates are returned as an array. You should check params.startDate to decide
		 * the starting point for an update.
		 * @memberOf  STX.QuoteFeed.Demo
		 */
		STX.QuoteFeed.Demo.prototype.update=function(params, cb){
			var masterData=params.stx.chart.masterData;
			var current=masterData[masterData.length-1];
			var ms=new Date().getTime();
			ms=ms-ms%(params.period*60*1000); // move to evenly divided bar
		
			var newQuote={};
			var now=new Date(ms);
			newQuote.DT=now; // Or set newQuote.Date if you have a string form date
			var field=params.symbol;
			if(!params.chart.series[field]) field="Close";
			if(!current[field]) current=masterData[masterData.length-2]; // get series which might be lagging behind a bar
			newQuote.Close=Math.round((current[field]-(Math.random()-.5)*.8)*100)/100;
		
			if(ms==masterData[masterData.length-1].DT.getTime()){
				newQuote.Open=current.Open;
				newQuote.High=Math.max(current.High, newQuote.Close);
				newQuote.Low=Math.min(current.Low, newQuote.Close);
				newQuote.Volume=current.Volume+Math.round(Math.random()*10000);
			}else{
				newQuote.Open=newQuote.High=newQuote.Low=newQuote.Close;
				newQuote.Volume=1000;
			}
			cb({quotes:[newQuote]});
		};
		
		STX.QuoteFeed.Demo.prototype.randomQuote=function(seed){
			var Open=seed-(Math.random()-.5)*2;
			var Close=seed-(Math.random()-.5)*2;
			var High=Math.max(seed-(Math.random()-.5)*2, Open, Close);
			var Low=Math.min(seed-(Math.random()-.5)*2, Open, Close);
			var newQuote={
				Open: Math.round(Open*100)/100,
				Close: Math.round(Close*100)/100,
				High: Math.round(High*100)/100,
				Low: Math.round(Low*100)/100,
				Volume: 1000000+Math.round(Math.random()*100000)
			};
			return newQuote;
		};
		
		/**
		 * Creates a random intraday chart (based on 24 hour security for simplicity sake)
		 * @memberOf  STX.QuoteFeed.Demo
		 */
		STX.QuoteFeed.Demo.prototype.generateIntraday=function(params, cb){
			var seed=155.43;
			var quotes=[];
			var ticksToLoad=params.ticks*3; // load extra to fill up space before chart
		
			var now=new Date().getTime();
			var ms=now-(params.period*60*1000)*ticksToLoad;
			ms=ms-ms%(params.period*60*1000); // move to evenly divided bar
			for(var i=0;i<ticksToLoad;i++){
				var newQuote=this.randomQuote(seed);
				newQuote.Date=STX.yyyymmddhhmm(new Date(ms));
				quotes.push(newQuote);
				ms+=params.period*60*1000;
				seed=newQuote.Close;
			}
			cb({quotes:quotes, moreAvailable:true});
		};
		
		/**
		 * Loads more random data when the user scrolls back.
		 * @memberOf  STX.QuoteFeed.Demo
		 */
		STX.QuoteFeed.Demo.prototype.loadMore=function(params, cb){
			var firstQuote=params.chart.masterData[0];
			var field=params.symbol;
			if(!params.chart.series[field]) field="Close";
			for(var i=0;i<params.chart.masterData.length;i++){
				if(params.chart.masterData[i].DT.getTime()==params.endDate.getTime()){
					firstQuote=params.chart.masterData[i];
					break;
				}
			}
			var seed=firstQuote[field];
			var quotes=[];

			var ms=params.endDate.getTime()-(params.period*60*1000);
			for(var i=0;i<params.ticks;i++){
				var newQuote=this.randomQuote(seed);
				newQuote.Date=STX.yyyymmddhhmm(new Date(ms));
				quotes.push(newQuote);
				ms-=params.period*60*1000;
				seed=newQuote.Close;
			}
			quotes.reverse();
			cb({quotes:quotes, moreAvailable:true});
		};
		
		
		

		STX.QuoteFeed.ChartIQEOD=function(url){
			this.url=url;
		};
		
		STX.QuoteFeed.ChartIQEOD.stxInheritsFrom(STX.QuoteFeed);
		
		/*
		 * This is a demo version of fetch. You will need to create one for your own quote feed that behaves similarly.
		 * This only supports end of day quotes.
		 * @memberOf  STX.QuoteFeed.ChartIQEOD
		 */
		STX.QuoteFeed.ChartIQEOD.prototype.fetch=function(params, cb){
			function setQuotes(response){
				eval(response);
				return historicalQuote;
			}
			
			if(params.startDate){
				cb({error:"STX.QuoteFeed.ChartIQEOD does not support updates for daily charts"});
				return;
			}
			if(params.endDate){
				cb({error:"STX.QuoteFeed.ChartIQEOD does not support loadMore for daily charts"});
				return;
			}
			if(params.interval=="minute"){
				cb({error:"STX.QuoteFeed.ChartIQEOD does not support intraday charts"});
				return;
			}
			var url=this.url + "/" + params.symbol.toUpperCase();
			STX.postAjax(url, null, function(status, response){
				if(status!=200){
					cb({error:status});
					return;
				}
				var quotes=setQuotes(response);
				var newQuotes=[];
				for(var i=0;i<quotes.length;i++){
					newQuotes[i]={};
					newQuotes[i].Date=quotes[i][0]; // Or set newQuotes[i].DT if you have a JS Date
					newQuotes[i].Open=quotes[i][1];
					newQuotes[i].High=quotes[i][2];
					newQuotes[i].Low=quotes[i][3];
					newQuotes[i].Close=quotes[i][4];
					newQuotes[i].Volume=quotes[i][5];
					newQuotes[i].Adj_Close=quotes[i][6];
				}
				cb({quotes:newQuotes});
			});
		};

		if(typeof document!="undefined") document.addEventListener("contextmenu", STXChart.handleContextMenu);
		
		return _exports;
	
	}
	
	{
		var _stx_js_exports={};
		if(typeof exports!=="undefined") _stx_js_exports=exports;
		
		if ( typeof define === "function" && define.amd ) {
			define( ["stxThirdParty"], function(_stxThirdParty) { return _stx_js(_stx_js_exports,_stxThirdParty); } );
		}else{
			var _stxThirdParty={};
			if(typeof(window.STXThirdParty)!="undefined") _stxThirdParty=window.STXThirdParty;
			
			var _=_stx_js(_stx_js_exports,_stxThirdParty);
			window.STX=_.STX;
			window.STXChart=_.STXChart;
			window.$$=_.$$;
			window.$$$=_.$$$;  
		}
	}

})();

