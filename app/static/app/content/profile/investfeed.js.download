var investFeed={config:null,base:location.protocol+'//'+ location.host+'/',modal:{open:function(selector,call,delay){delay=(typeof delay==='undefined')?180:delay;var elm=$(selector);var modal=$(elm).find('.modal');$(elm).stop().css('display','block').animate({opacity:1},delay).click(function(){investFeed.modal.close(selector);});investFeed.modal.reposition(selector)
$(modal).click(function(e){e.stopPropagation();}).keyup(function(e){if(e.keyCode==27){investFeed.modal.close(selector);}});if(typeof call==='function'){call();}},close:function(selector,call,delay){delay=(typeof delay==='undefined')?180:delay;$(selector).stop().animate({opacity:0},delay,function(){$(this).css('display','none');if(typeof call==='function'){call();}});},reposition:function(selector){var elm=$(selector);var modal=$(elm).find('.modal');$(modal).css({'marginLeft':-$(modal).width()/ 2, 'marginTop': -$(modal).height() / 2});
}},notify:{addNotification:function(pid,user,uid,action,type){type=(typeof type==='undefined')?'post':type;$('.notify').css('display','block').text(parseInt($('.notify').text())+ 1);var li=document.createElement('li');if(type=='post'){$(li).attr('onClick',"location.href='"+ investFeed.base+"posts/"+ pid+"';").append('<a href="'+ investFeed.base+'profile/'+ uid+'"><span class="username">'+ user+'<span></a> '+ action+'<br/><span class="date"> moments ago </span>');}else if(type=='message'){$(li).addClass('action-direct-message').data('user-id',uid).append('<a href="javascript:void(0)"><span class="username">'+ user+'<span></a> '+ action+'<br/><span class="date"> moments ago </span>');}
$('.notification_hover').prepend(li);},showToaster:function(data,delay,type,action,call){var $toaster=$('.toaster');$toaster.find('img').attr('src','https://investfeed-prod.s3.amazonaws.com/upload/'+ data.user_img).parent().attr('href',investFeed.base+'profile/'+ data.user_id);if(type=="contact"){$toaster.find('.user').find('a').attr('href',investFeed.base+'profile/'+ data.user_id).text(data.user);$toaster.find('.action').text(action).parent().attr('href',investFeed.base+"posts/"+ data.post_id);}else if(type=="subscribed"){$toaster.find('.user').find('a').attr('href','/profile/'+ data.user_id).text(data.user);$toaster.find('.action').text(action).parent().attr('href',investFeed.base+'profile/'+ data.user_id);}else if(type=="message"){$toaster.find('.user').find('a').attr('href','/profile/'+ data.user_id).text(data.user);$toaster.find('.action').text(action).parent().attr('href','javascript:void(0)').addClass('action-direct-message').data('user-id',data.user_id);}
$toaster.fadeIn(delay).delay(5000).fadeOut(delay);if(typeof call==='function'){call();}}},post:{add:function(pID,uID){var checkURL=investFeed.base+"permission/?post="+ pID+"&id="+ uID+"&controller="+ investFeed.config.data.controller+"&action="+ investFeed.config.data.action;$.get(checkURL,function(data){if(data){iFRealtime.offset.increment();$("#postWrap").prepend(data);$('.tipsy-init').tipsy();findTickerTag();}});},remove:function(post_id){$("#row_"+ post_id).slideUp("normal",function(){$(this).remove();});},edit:{stored_content:""},update:function(id,content,call){var $post=$("#row_"+ id).find('.content');$post.html(content);}},messages:{open:function(other_id){investFeed.modal.open('.investfeed-modal#messaging',function(){if(typeof other_id!=='undefined'){investFeed.messages.openConversation(other_id);}else{investFeed.messages.openConversationHistory();}
investFeed.modal.reposition('.investfeed-modal#messaging');});},openConversation:function(other_id){investFeed.messages.clearConversationData();$('.modal.messaging .dm-view, .modal.messaging .dm-history-view').hide();var $view=$('.modal.messaging .dm-view').fadeIn(600);var $loader=$('.modal.messaging .dm-loader').show();$.ajax({url:investFeed.base+'messages/ajax/conversation/'+ other_id,type:'GET',success:function(resp){resp=jQuery.parseJSON(resp);if(resp.status==true){$view.find('.dm-message-list').html(resp.content);$view.find('h3#full-name').text(resp.full_name);$view.find('p#username').text('@'+ resp.username);$view.data('other-id',resp.id);$view.find('.dm-message-input button.dm-send').data('other-id',resp.id);investFeed.messages.scrollMessages();}else{investFeed.messages.openConversationHistory();}},error:function(){investFeed.messages.openConversationHistory();},complete:function(){$loader.hide();investFeed.modal.reposition('.investfeed-modal#messaging');}});},openConversationHistory:function(){$('.modal.messaging .dm-view, .modal.messaging .dm-history-view').hide();var $view=$('.modal.messaging .dm-history-view').show();var $loader=$('.modal.messaging .dm-loader').show();$.ajax({url:investFeed.base+'messages/ajax/conversations/',type:'GET',success:function(resp){resp=jQuery.parseJSON(resp);if(resp.status==true){$view.find('.dm-history-container').html(resp.content);}},complete:function(){$loader.hide();investFeed.modal.reposition('.investfeed-modal#messaging');}});},clearConversationData:function(){var $view=$('.modal.messaging .dm-view');$view.find('.dm-message-list').html('');$view.find('h3#full-name').text('');$view.find('p#username').text('');$view.data('other-id',0);$view.find('.dm-message-input button.dm-send').data('other-id',0);},cleanMessageList:function(){$('.dm-messages-container .dm-message-list').find('> p').remove();},sendMessage:function(ref){var $con=$(ref).parents('.dm-message-input');var $textArea=$con.find('textarea');var other_id=$(ref).data('other-id');$.ajax({url:investFeed.base+'messages/ajax/send',type:'POST',data:{other_id:other_id,content:$textArea.val()},success:function(resp){resp=jQuery.parseJSON(resp);if(resp.status==true){investFeed.messages.cleanMessageList();$('.dm-messages-container .dm-message-list').append(resp.message);investFeed.messages.scrollMessages();$textArea.val('');}}});},receivedMessage:function(message_id){$.ajax({url:investFeed.base+'messages/ajax/receive',type:'POST',data:{message_id:message_id},success:function(resp){resp=jQuery.parseJSON(resp);if(resp.status==true){investFeed.messages.cleanMessageList();$('.dm-messages-container .dm-message-list').append(resp.message);investFeed.messages.scrollMessages();}}});},deleteMessage:function(ref){var $message=$(ref).closest('.dm-container');console.log($message);$.ajax({url:investFeed.base+'messages/ajax/delete',type:'POST',data:{message_id:$message.data('message-id')},success:function(resp){resp=jQuery.parseJSON(resp);if(resp.status==true){$message.slideUp();investFeed.messages.scrollMessages();}}});},scrollMessages:function(){var $scrollMessages=$('.modal.messaging .dm-view').find('.dm-message-list-container');$scrollMessages[0].scrollTop=$scrollMessages[0].scrollHeight;},closeMessages:function(){$('.modal.messaging .dm-view').data('other-id',0);investFeed.modal.close('.investfeed-modal#messaging');}},publicActions:{openSignUpModal:function(){investFeed.modal.open('.investfeed-modal#public-account',function(){$('.public-account-header .tab-select').removeClass('active-tab');$('.public-account-header .tab-select.tab-signup').addClass('active-tab');$('.public-account-content > div').removeClass('active-tab');$('.public-account-content .tab-signup-content').addClass('active-tab');$('.public-account-content input#fullname').focus();investFeed.modal.reposition('.investfeed-modal#public-account');});}},comments:{incrementCount:function(pID){var count=$('#row_'+ pID).find('.comments > a');$(count).text(parseInt($(count).text())+ 1);}},get:{registrationStatus:function(){return investFeed.config.user.status;}}};$(window).resize(function(){var modal=$('.investfeed-modal .modal.responsive');$(modal).css({'marginLeft':-$(modal).outerWidth()/ 2, 'marginTop': -$(modal).outerHeight() / 2})
});