var reqCount=0;function changePeriodicity(newInterval){_status=false;var params={"stx":stxx,"symbol":stxx.chart.symbol,"interval":newInterval};fetchMyData(params,handleMyData(params));_interval=newInterval;}
function displayChart(sym){var params={"stx":stxx,"symbol":sym,"interval":"day"};fetchMyData(params,handleMyData(params));}
function fetchMyData(params,cb){var symbol=params.symbol;var interval=params.interval;if(interval=="day"||interval=="week"||interval=="month"){STX.Quotes.fetch({"symbol":symbol,"stx":stxx},cb);}else if(interval==1){fetchMinutes({"symbol":symbol,"stx":stxx,"interval":interval},cb);}else if(interval==5){fetchMinutes({"symbol":symbol,"stx":stxx,"interval":interval},cb);}else if(interval==30){fetchMinutes({"symbol":symbol,"stx":stxx,"interval":interval},cb);}}
function handleMyData(params){var displayMap={"day":{"1":"1D"},"week":{"1":"1W"},"month":{"1":"1M"},"1":{"1":"1m"},"5":{"1":"5m"},"30":{"1":"30m"}};return function(err,data){if(err||err==0){STX.alert("error: "+ err);return;}
if(STXChart.isDailyInterval(params.interval)){params.stx.setPeriodicityV2(1,params.interval);}else{params.stx.setPeriodicityV2(params.interval,params.interval);}
params.stx.newChart(params.symbol,data);$$$("#periodBtn").childNodes[0].data=displayMap[params.interval][1];if(STXChart.isDailyInterval(params.interval)){enableStreaming=false;}else{enableStreaming=true;}
$$("symbol").value=params.symbol;if(params.stx.chart.symbol!=params.symbol){STX.Comparison.reset(params.stx);}else if(!params.refresh){loadComparisonSymbols(params);}}};function loadComparisonSymbols(params){var arr=[];for(var field in params.stx.chart.series){var seriesParam=STX.shallowClone(params);seriesParam.symbol=field;arr.push(seriesParam);}
STX.Quotes.multiFetch(arr,function(results){for(var i=0;i<results.length;i++){var result=results[i];if(!result.err){STX.Comparison.processComparison(params.stx,result.params.symbol,result.data);}}
params.stx.createDataSet();params.stx.draw();});}
function runSampleUI(){STX.ThemeManager.builtInThemes={"Light":true,"Dark":true};STX.MenuManager.makeMenus();STX.MenuManager.registerChart(stxx);var currentTheme=STX.StorageManager.get("themes");if(currentTheme){STX.ThemeManager.setThemes(JSON.parse(currentTheme),stxx);}else{STX.ThemeManager.loadBuiltInTheme(stxx,"Light");}
STX.ThemeManager.themesToMenu($$("customThemeSelector"),$$("builtInThemeSelector"),stxx,STX.StorageManager.callbacker("themes"));STX.DrawingToolbar.initialize();STX.DrawingToolbar.setVectorType(stxx,null);}
function createVolumePanel(){if(stxx.panelExists("vchart"))
return;stxx.createPanel("Volume","vchart",100);stxx.draw();}
function toggleVolumeUnderlay(){stxx.setVolumeUnderlay(!stxx.layout.volumeUnderlay);}
function prependHeadsUpHR(){var tick=Math.floor((STXChart.crosshairX- this.chart.left)/ this.layout.candleWidth);
var prices=this.chart.xaxis[tick];$$("huOpen").innerHTML="";$$("huClose").innerHTML="";$$("huHigh").innerHTML="";$$("huLow").innerHTML="";$$("huVolume").innerHTML="";if(prices!=null){if(prices.data){$$("huOpen").innerHTML=this.formatPrice(prices.data.Open);$$("huClose").innerHTML=this.formatPrice(prices.data.Close);$$("huHigh").innerHTML=this.formatPrice(prices.data.High);$$("huLow").innerHTML=this.formatPrice(prices.data.Low);$$("huVolume").innerHTML=STX.condenseInt(prices.data.Volume);}}}
STXChart.prototype.prepend("headsUpHR",prependHeadsUpHR);var stxx=new STXChart({container:$$("chartContainer")});stxx.preferences.whitespace=10;var _interval="day";var _status=false;if(stxx.container){var behavior={};stxx.attachQuoteFeed(new STX.QuoteFeed.Demo(),behavior);runSampleUI();}
var newQuotes;var apikey='cf537557cb2a567ff409372e874dea45';STX.Quotes.Demo.fetch=function(params,cb){fetchDailys(params.symbol.toUpperCase(),'daily',setstartDate('daily',365),cb)
return;}
function fetchDailys(symbol,type,startdate,cb){getQuotes(symbol);var url='https://ondemand.websol.barchart.com/getHistory.jsonp?';url+='symbol='+ symbol+'&';url+='type='+ type+'&';url+='startDate='+ startdate+'&';url+='apikey='+ apikey+'&callback=';$.ajax({url:url,type:"GET",dataType:'jsonp',beforeSend:function(){$("#loading").css({display:"block"});},success:function(data){var objData=data.results;var _newData=[];for(var i=0;i<objData.length;i++){_newData[i]={};_newData[i].Date=objData[i].tradingDay;_newData[i].Open=objData[i].open;_newData[i].High=objData[i].high;_newData[i].Low=objData[i].low;_newData[i].Close=objData[i].close;_newData[i].Volume=objData[i].volume;}
cb(null,_newData);},error:function(){},complete:function(){$("#loading").css({display:"none"});$("#chartContainer").trigger('loadComplete');_status=true;}});}
function fetchMinutes(params,cb){getQuotes(params.symbol.toUpperCase());var url='https://ondemand.websol.barchart.com/getHistory.jsonp?';url+='symbol='+ params.symbol.toUpperCase()+'&';url+='type='+'minutes'+'&';url+='startDate='+ setstartDate('minutes',30)+'&';url+='apikey='+ apikey+'&callback=';$.ajax({url:url,type:"GET",dataType:'jsonp',beforeSend:function(){$("#loading").css({display:"block"});},success:function(data){var objData=data.results;var _newData=[];for(var i=0;i<objData.length;i++){_newData[i]={};var _newTime=String(objData[i].timestamp).substr(0,10)+" "+ String(objData[i].timestamp).substr(11,8);_newData[i].Date=_newTime;_newData[i].Open=objData[i].open;_newData[i].High=objData[i].high;_newData[i].Low=objData[i].low;_newData[i].Close=objData[i].close;_newData[i].Volume=objData[i].volume;}
cb(null,_newData);},error:function(){},complete:function(){$("#loading").css({display:"none"});_status=true;}});}
function setstartDate(_type,_number){var today=new Date();dd=today.getDate();mm=today.getMonth();yyyy=today.getFullYear();var startDate;var year;var month;var date;if(_type=='daily'){startDate=new Date(today.getTime()- _number*24*60*60*1000);year=startDate.getFullYear();month=(startDate.getMonth()+ 1)<10?"0"+ String(startDate.getMonth()+ 1):startDate.getMonth()+ 1;date=(startDate.getDate())<10?"0"+ String(startDate.getDate()):startDate.getDate();return(year+''+ month+ date+'0000');}
else if(_type=='minutes'){startDate=new Date(today.getTime()- _number*24*60*60*1000);year=startDate.getFullYear();month=(startDate.getMonth()+ 1)<10?"0"+ String(startDate.getMonth()+ 1):startDate.getMonth()+ 1;date=(startDate.getDate())<10?"0"+ String(startDate.getDate()):startDate.getDate();return(year+''+ month+ date+'0000');}
return null}
function getQuotes(sym){var onDemand=new OnDemandClient();onDemand.setAPIKey('cf537557cb2a567ff409372e874dea45');onDemand.setJsonP(true);onDemand.getQuote({symbols:sym,fields:'open,high,close,low,netChange,lastPrice,percentChange,fiftyTwoWkHigh,fiftyTwoWkLow,avgVolume'},function(err,data){var quote=data.results;var netChange=quote[0]['netChange'];var percentChange=quote[0]['percentChange'];if(parseFloat(netChange)<0){netChange="<span style='color:#AA0000;'>"+ netChange+"</span>";}else
if(parseFloat(netChange)>0){netChange="<span style='color:#008800;'>"+ netChange+"</span>";}
if(parseFloat(percentChange)<0){percentChange="<span style='color:#AA0000;'>("+ percentChange+"%)</span>";}else
if(parseFloat(percentChange)>0){percentChange="<span style='color:#008800;'>("+ percentChange+"%)</span>";}
$('[data-role=open] span').text(quote[0]['open']);$('[data-role=high] span').text(quote[0]['high']);$('[data-role=close] span').text(quote[0]['close']);$('[data-role=low] span').text(quote[0]['low']);$('[data-role=net] span').html(netChange);$('[data-role=price] span').text(quote[0]['lastPrice']);$('[data-role=change] span').html(percentChange);$('[data-role=volume] span').text(quote[0]['volume']);$('[data-role=52-week-high] span').text(quote[0]['fiftyTwoWkHigh']);$('[data-role=52-week-low] span').text(quote[0]['fiftyTwoWkLow']);$('[data-role=avg-volume] span').text(quote[0]['avgVolume']);});}
findTickerTag();function findTickerTag(){handleTickerTag();}
function handleTickerTag(){var $tickerContent=$('body');var $tickerTag=$tickerContent.find('.ticker-tag');var $tickerTooltip=$('.ticker-tooltip');var hTooltip=$tickerTooltip.outerHeight();var requestTickerInfor=null;$tickerTag.mouseover(function(e){var symbol=$(this).attr('data-symbol');var tootipPositionTop=$(this).offset().top- $tickerTooltip.parent().offset().top- hTooltip- 5;var tootipPositionLeft=($(this).offset().left- $tickerTooltip.parent().offset().left);var wContent=$(window).outerWidth();var wTicker=$tickerTooltip.outerWidth();var hContent=$(window).outerHeight();var hTicker=$tickerTooltip.outerHeight();if(e.pageX<=wContent/2){$tickerTooltip.css({left:tootipPositionLeft});}else{$tickerTooltip.css({left:tootipPositionLeft- wTicker+ $(this).outerWidth()});}
if(e.pageY>=hContent/2){$tickerTooltip.css({top:tootipPositionTop});}else{$tickerTooltip.css({top:tootipPositionTop+ hTicker+ $(this).outerHeight()+ 5});}
$tickerTooltip.show();requestTickerInfor=$.ajax({url:'https://ondemand.websol.barchart.com/getQuote.jsonp?symbols='+ symbol+'&mode=r&apikey=cf537557cb2a567ff409372e874dea45&&fields=symbol%2name%2volume%2ClastPrice%2CpercentChange%2CfiftyTwoWkHigh%2CfiftyTwoWkLow%2CavgVolume&callback=',type:"get",dataType:'jsonp',reqCount:++reqCount,beforeSend:function(){$tickerTooltip.find('.loader').show();},success:function(data){if(reqCount!==this.reqCount)
return;var respond=data["results"];displayTickerTooltipInfor(respond);displayTickerTooltipChart(symbol);},error:function(){},complete:function(){$tickerTooltip.find('.loader').hide();}});}).mouseout(function(){$tickerTooltip.hide();})}
function displayTickerTooltipInfor(respond){var $tickerTooltip=$('.ticker-tooltip');if(respond!=null){var tickerInfor=respond[0];var lastPrice=tickerInfor["lastPrice"];var netChange=tickerInfor["netChange"];var percentChange=tickerInfor["percentChange"];var symbol=tickerInfor["symbol"];var name=tickerInfor["name"];var volume=tickerInfor["volume"];$tickerTooltip.find('[data-role|="last-price"]').text(lastPrice);$tickerTooltip.find('[data-role|="net-change"]').text(netChange);parseFloat(netChange)>0?$tickerTooltip.find('[data-role|="net-change"]').wrap('<font color="#008800"></font>'):$tickerTooltip.find('[data-role|="net-change"]').wrap('<font color="#AA0000"></font>');$tickerTooltip.find('[data-role|="percent-change"]').text('('+ percentChange+')');parseFloat(percentChange)>0?$tickerTooltip.find('[data-role|="percent-change"]').wrap('<font color="#008800"></font>'):$tickerTooltip.find('[data-role|="percent-change"]').wrap('<font color="#AA0000"></font>');$tickerTooltip.find('[data-role|="symbol"]').text(symbol);$tickerTooltip.find('[data-role|="name"]').text(name);$tickerTooltip.find('[data-role|="volume"]').text("Volume: "+ volume);}else{$tickerTooltip.find('[data-role|="last-price"]').text('...');$tickerTooltip.find('[data-role|="net-change"]').text('...');$tickerTooltip.find('[data-role|="percent-change"]').text('...');$tickerTooltip.find('[data-role|="symbol"]').text('...');$tickerTooltip.find('[data-role|="name"]').text('...');$tickerTooltip.find('[data-role|="volume"]').text('...');}}
function displayTickerTooltipChart(symbol){var $tickerTooltip=$('.ticker-tooltip');$('#tickerTooltipChart').empty();var mstxx=new STXChart({container:$$("tickerTooltipChart")});var currentTheme=STX.StorageManager.get("themes");if(currentTheme){STX.ThemeManager.setThemes(JSON.parse(currentTheme),mstxx);}else{STX.ThemeManager.loadBuiltInTheme(mstxx,"Light");}
mstxx.manageTouchAndMouse=false;mstxx.preferences.whitespace=5;mstxx.layout.candleWidth=4.3;mstxx.setVolumeUnderlay(!mstxx.layout.volumeUnderlay);var onDemand=new OnDemandClient();onDemand.setAPIKey('cf537557cb2a567ff409372e874dea45');onDemand.setJsonP(true);onDemand.getHistory({symbol:symbol,type:"daily",startDate:setstartDate("daily",90)},function(err,data){var objData=data.results;var _newData=[];for(var i=0;i<objData.length;i++){_newData[i]={};_newData[i].Date=objData[i].tradingDay;_newData[i].Open=objData[i].open;_newData[i].High=objData[i].high;_newData[i].Low=objData[i].low;_newData[i].Close=objData[i].close;_newData[i].Volume=objData[i].volume;}
mstxx.newChart(symbol,_newData);$tickerTooltip.find('.loader').hide();});}
watchlist();function watchlist(){var arr=[];$('#watch > tbody  > tr').each(function(){var ticker=$(this).attr('data-ticker');arr.push([ticker,$(this)]);});getWatchlist(arr);$('table#watch').trigger('listComplete');}
function watchlistNew(){var arr=[];$('#watch > tbody  > tr.new').each(function(){var ticker=$(this).attr('data-ticker');arr.push([ticker,$(this)]);});getWatchlist(arr);}
function getWatchlist(arr){var sym="";for(var i in arr){sym+=arr[i][0]+",";}
var onDemand=new OnDemandClient();if(sym.length>0){onDemand.setAPIKey('cf537557cb2a567ff409372e874dea45');onDemand.setJsonP(true);onDemand.getQuote({symbols:sym,fields:'name,lastPrice,percentChange,netChange,open'},function(err,data){for(var i=0;i<data.results.length;i++){var s=arr[i][1];var quote=data.results[i];var name=quote['name'];var price=quote['lastPrice'];var open=quote['open'];var percent=quote['percentChange'];var percentText=parseFloat(percent)>=0?'<font color="#008800">('+ percent+'%'+')</font>':'<font color="#AA0000">('+ percent+'%'+')</font>';var change=parseFloat(quote['netChange']);var change=change.toFixed(2);var changeText=change>=0?'<font color="#008800">'+ change+'</font>':'<font color="#AA0000">'+ change+'</font>';var html='<td class="ticker-column"> <span class="symbol"><a href="/symbol/'+ quote['symbol']+'">'+ quote['symbol']+'</a></span> <br /><span class="company">'+ name+'</span></td>  <td class="price-column" data-open="'+ open+'"><span class="price">'+ price+'</span> <br /><span class="change">'+ changeText+' '+ percentText+'</span></td><td class="actions" data-ticker="'+ quote['symbol']+'"><div class="watch-remove tipsy-init" title="Remove From Watchlist"><i class="fa fa-fw fa-trash-o" aria-hidden="true"></i></div><div class="watch-buy broker-order-action tipsy-init" data-action="buy" data-symbol="'+ quote['symbol']+'" title="Buy"><i class="fa fa-fw fa-plus-square" aria-hidden="true"></i></div><div class="watch-sell broker-order-action tipsy-init" data-action="sell" data-symbol="'+ quote['symbol']+'" title="Sell"><i class="fa fa-fw fa-minus-square" aria-hidden="true"></i></div></td>';s.html(html);}});}}
indices();function indices(){var arr=[];$('#snapshot > li.index').each(function(){var ticker=$(this).attr('data-ticker');arr.push([ticker,$(this)]);});getIndices(arr)}
function getIndices(arr){var sym="";for(var i in arr){sym+=arr[i][0]+",";}
if(sym.length>0){var onDemand=new OnDemandClient();onDemand.setAPIKey('cf537557cb2a567ff409372e874dea45');onDemand.setJsonP(true);onDemand.getQuote({symbols:sym,fields:'lastPrice,percentChange,netChange'},function(err,data){for(var i=0;i<data.results.length;i++){var s=arr[i][1];var quote=data.results[i];var change=parseFloat(quote['netChange']);var change=change.toFixed(2);var percentText=change>=0?'<span class="change green" data-role="change">'+ change+'</span>':'<span class="change red" data-role="change">'+ Math.abs(change)+'</span>';s.html(percentText);}});}}
unrealized();function unrealized(){var arr=[];$('span.unrealized_gl').each(function(){var ticker=$(this).attr('data-ticker');var outlook=$(this).attr('data-outlook');var entry=$(this).attr('data-entry');arr.push([ticker,outlook,entry,$(this)]);});getUnrealized(arr);};function getUnrealized(arr){var sym="";for(var i in arr){sym+=arr[i][0]+",";}
if(sym.length>0){var onDemand=new OnDemandClient();onDemand.setAPIKey('cf537557cb2a567ff409372e874dea45');onDemand.setJsonP(true);onDemand.getQuote({symbols:sym,fields:'lastPrice'},function(err,data){for(var i=0;i<data.results.length;i++){var s=arr[i][3];var unrealized;var val1;var val2;var perc;var quote=data.results[i];var price=quote['lastPrice'];var entry=parseFloat(arr[i][2]);var outlook=arr[i][1];val1=Math.abs(price- entry);val2=entry;change=val1.toFixed(2);perc=(val1/val2)*100;perc=perc.toFixed(2);if(outlook=='Bullish'){if(entry<=price){unrealized='<font color="#008800">'+ change+' ('+ perc+'%)'+'</font>';}else{unrealized='<font color="#AA0000">-'+ change+' ('+ perc+'%)'+'</font>';}}else if(outlook=='Bearish'){if(entry>=price){unrealized='<font color="#008800">'+ change+' ('+ perc+'%)'+'</font>';}else{unrealized='<font color="#AA0000">-'+ change+' ('+ perc+'%)'+'</font>';}}
if(entry==price){unrealized='<font color="#F5802D">0%</font>';}
s.html(unrealized);}});}}