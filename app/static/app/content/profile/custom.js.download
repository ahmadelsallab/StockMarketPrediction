$(document).ready(function(){$.fn.tipsy.defaults={delayIn:0,delayOut:0,fade:false,fallback:'',gravity:'s',html:false,live:true,offset:0,opacity:0.8,title:'title',trigger:'hover'};$('.sidetab').sideTab();$('.soc_icon').tipsy();$('span.col').tipsy();$('#tracking-hint, .fa-reply, .verified-icon, #rank-hint').tipsy();$('.tipsy-init').tipsy();$('.welcome_container .hiw a').click(function(){$('.welcome_container .hiw-video').slideToggle(600);});$('header .header-button.action-login, .public-account-header .tab-login').on('click',function(){investFeed.modal.open('.investfeed-modal#public-account',function(){$('.public-account-header .tab-select').removeClass('active-tab');$('.public-account-header .tab-select.tab-login').addClass('active-tab');$('.public-account-content > div').removeClass('active-tab');$('.public-account-content .tab-login-content').addClass('active-tab');$('.public-account-content input#username').focus();investFeed.modal.reposition('.investfeed-modal#public-account');});return false;});$('body#hp a.action-signup, .public-account-header .tab-signup, .page.about .action-signup').on('click',function(){investFeed.modal.open('.investfeed-modal#public-account',function(){$('.public-account-header .tab-select').removeClass('active-tab');$('.public-account-header .tab-select.tab-signup').addClass('active-tab');$('.public-account-content > div').removeClass('active-tab');$('.public-account-content .tab-signup-content').addClass('active-tab');$('.public-account-content input#fullname').focus();investFeed.modal.reposition('.investfeed-modal#public-account');});return false;});$('.homepage .join-container form').on('submit',function(){investFeed.modal.open('.investfeed-modal#public-account',function(){$('.public-account-header .tab-select').removeClass('active-tab');$('.public-account-header .tab-select.tab-signup').addClass('active-tab');$('.public-account-content > div').removeClass('active-tab');$('.public-account-content .tab-signup-content').addClass('active-tab');$('.public-account-content input#email').val($('.homepage .join-container form input#reserve-email').val());$('.public-account-content input#fullname').focus();investFeed.modal.reposition('.investfeed-modal#public-account');});return false;});$('.public-account .public-account-close').on('click',function(){investFeed.modal.close('.investfeed-modal#public-account');return false;});$('.tab-signup-content > form').submit(function(e){var $self=$(this);var errors=[];var $name=$(this).find('#fullname');var $username=$(this).find('#username');var $email=$(this).find('#email');var $pass=$(this).find('#password');var emailRegEx=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!$name.val()>0){errors.push([$name,'Full Name Required']);}
if(!$pass.val()>0){errors.push([$pass,'Password Required']);}else if($pass.val().length<6){errors.push([$pass,'Password Legnth']);}
$.ajax({url:investFeed.base+'ajax/checkAvailability',type:'POST',dataType:'json',data:{username:$username.val(),email:$email.val()},success:function(resp){if(!$email.val()>0){errors.push([$email,'Email Required']);}else if(!emailRegEx.test($email.val())){errors.push([$email,'Email Invalid']);}else if(!resp.emailAvailable){errors.push([$email,'Email Not Available']);}
if(!$username.val()>0){errors.push([$username,'Username Required']);}else if(!resp.usernameAvailable){errors.push([$username,'Username Not Available']);}
if(errors.length==0){ga('send',{hitType:'event',eventCategory:'Signup',eventAction:'Submit'});$self[0].submit();}},complete:function(){$('.tab-signup-content input').removeClass('parsley-error');var $errorList=$('.signup-errors').html('');for(var i=0;i<errors.length;i++){$(errors[i][0]).addClass('parsley-error');var $li=$('<li></li>');$li.html(errors[i][1]);$errorList.append($li);}
investFeed.modal.reposition('.investfeed-modal#public-account');}});e.preventDefault();return false;});$('.tab-login-content form').on('submit',function(){ga('send',{hitType:'event',eventCategory:'Login',eventAction:'Submit'});});$('.tab-signup-content input').on('change',function(){$(this).removeClass('parsley-error');});if($(".posts_container").length){var ias=$.ias({container:".posts_container",negativeMargin:380,delay:0,item:".row.post",pagination:".pagination",next:"a[rel*=next]"});ias.extension(new IASSpinnerExtension());ias.on('rendered',function(event){findTickerTag();$('.tipsy-init').tipsy();})}
if($(".users_container").length){var ias=$.ias({container:".users_container",item:".row.user",pagination:".pagination",next:"a[rel*=next]"});ias.extension(new IASSpinnerExtension());ias.on('rendered',function(event){$('span.col').tipsy();})}
if($(".comments_container").length){var ias=$.ias({container:".comments_container",item:".comment-wrap",pagination:".pagination",next:"a[rel*=next]"});ias.extension(new IASSpinnerExtension());ias.on('rendered',function(event){$('span.col').tipsy();})}
$('#symbol-lookup').keypress(function(e){if(e.which==13){var symbol=$(this).val().replace("$","").toUpperCase();var url=investFeed.base+"find/?term="+ symbol;window.location.href=url;e.preventDefault();}});$.widget("custom.catcomplete",$.ui.autocomplete,{_create:function(){this._super();this.widget().menu("option","items","> :not(.ui-autocomplete-category)").addClass('search-bar');},_renderMenu:function(ul,items){var that=this,currentCategory="";$.each(items,function(index,item){var li;if(item.category!=currentCategory){ul.append("<li class='ui-autocomplete-category'>"+ item.category+"</li>");currentCategory=item.category;}
li=that._renderItem(ul,item);});},_renderItem:function(ul,item){switch(item.category){case"user":var li=$("<li></li>").attr({'class':'search-result','data-category':item.category,'data-result':item.label}).append($("<img></img>").attr({'class':'search-profilethumb','src':item.image,'width':20,'height':20})).append($("<span></span>").attr({'class':'search-username'}).append("@"+ item.label)).append($("<span></span>").attr({'class':'search-name'}).append(item.name)).attr("aria-label",item.category+" : "+ item.label);if(item.verified==1){$(li).append($("<img></img>").attr({'class':'search-verified','src':investFeed.base+'/media/images/verified-icon-small.png','width':12,'height':12}))}
$(li).appendTo(ul);break;case"symbol":return $("<li></li>").attr({'class':'search-result','data-category':item.category,'data-result':item.label}).append($("<span></span>").attr({'class':'search-ticker'}).append("$"+ item.label)).append($("<span></span>").attr({'class':'search-company'}).append(item.name)).attr("aria-label",item.category+" : "+ item.label).appendTo(ul);break;case"hashtag":return $("<li></li>").attr({'class':'search-result','data-category':item.category,'data-result':item.label}).append($("<span></span>").attr({'class':'search-hashtag'}).append(item.name)).attr("aria-label",item.category+" : "+ item.label).appendTo(ul);break;}}});$('.search-result').live('click',function(e){var category=$(this).data('category');switch(category){case"user":window.location.href=investFeed.base+ $(this).data('result');break;case"symbol":window.location.href=investFeed.base+"symbol/"+ $(this).data('result');break;case"hashtag":window.location.href=investFeed.base+"hashtag/"+ $(this).data('result');break;}
ga('send',{hitType:'event',eventCategory:'Search',eventAction:'Clicked'});return false;});$("#symbol-lookup").catcomplete({delay:0,source:investFeed.base+'autocomplete'});$("div#like").live('click',function(e){var post_id=$(this).data('id');var other_id=$(this).data('other_id');var button=$("div.like.id_"+ post_id);var loadUrl=investFeed.base+'post/ajax/like';$.post(loadUrl,{post_id:post_id,other_id:other_id},function(code){var obj=jQuery.parseJSON(code);if(obj.status===true){var toggle=obj.toggle;switch(toggle){case"vote":$(button).removeClass('undo');if(obj.count==0){$(button).find('span').addClass('hidden')}
ga('send',{hitType:'event',eventCategory:'Post',eventAction:'Unlike'});break;case"voted":$(button).addClass('undo');$(button).find('span').removeClass('hidden');ga('send',{hitType:'event',eventCategory:'Post',eventAction:'Like'});break;}
$(button).find('span').text(obj.count);}});});$("span#delete").live('click',function(e){var post_id=$(this).data('id');var loadUrl=investFeed.base+'post/ajax/delete';swal({title:"Are you sure you want to delete this post?",text:false,type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:true},function(){$.post(loadUrl,{post_id:post_id},function(code){var obj=jQuery.parseJSON(code);if(obj.status===true){investFeed.post.remove(post_id)
ga('send',{hitType:'event',eventCategory:'Post',eventAction:'Delete'});}});});});$("div#favorite").live('click',function(e){var post_id=$(this).data('id');var other_id=$(this).data('other_id');var button=$("div.favorite.id_"+ post_id);var loadUrl=investFeed.base+'post/ajax/favorite';$.post(loadUrl,{post_id:post_id,other_id:other_id},function(code){var obj=jQuery.parseJSON(code);if(obj.status===true){var toggle=obj.toggle;switch(toggle){case"favorite":$(button).removeClass('favorited');if(obj.count==0){$(button).find('span').addClass('hidden')}
ga('send',{hitType:'event',eventCategory:'Post',eventAction:'Unfavorite'});break;case"favorited":$(button).addClass('favorited');$(button).find('span').removeClass('hidden')
ga('send',{hitType:'event',eventCategory:'Post',eventAction:'Favorite'});break;}
$(button).find('span').text(obj.count);}});});$("div#flag").live('click',function(e){var post_id=$(this).data('id');var other_id=$(this).data('other_id');var button=$("div.flag.id_"+ post_id);var loadUrl=investFeed.base+'post/ajax/flag';$.post(loadUrl,{post_id:post_id,other_id:other_id},function(code){var obj=jQuery.parseJSON(code);if(obj.status===true){var toggle=obj.toggle;switch(toggle){case"flag":ga('send',{hitType:'event',eventCategory:'Post',eventAction:'Unflag'});$(button).removeClass('flagged');break;case"flagged":ga('send',{hitType:'event',eventCategory:'Post',eventAction:'Flag'});$(button).addClass('flagged');break;}}});});$("div#add-symbol").live('click',function(e){var sym_input=$('#watch-symbol');var symbols=sym_input.val();var loadUrl=investFeed.base+'watchlist/add';sym_input.removeClass("parsley-error");$.post(loadUrl,{symbols:symbols},function(code){var obj=jQuery.parseJSON(code);sym_input.val(obj.bad_symbols);if(obj.html!==""){$('#watchlist table').append(obj.html);$('.empty-notification').remove();watchlistNew();$('#watchlist table tr').removeClass("new");ga('send',{hitType:'event',eventCategory:'Watchlist',eventAction:'Add'});}
if(obj.status===false){sym_input.addClass("parsley-error");}}).fail(function(e){$("body").empty();$("body").html(e.responseText);});});$("table#watch tr").live({mouseenter:function(){$(this).children('td.price-column').hide();$(this).children('td.actions').show();},mouseleave:function(){$(this).children('td.actions').hide();$(this).children('td.price-column').show();}});$("table#watch tr th span.watchlist-refresh").live('click',function(e){var _this=this;$(_this).find('i').addClass('fa-spin');watchlist();setTimeout(function(){$(_this).find('i').removeClass('fa-spin');},1250);});$("table#watch tr td > div.watch-remove").live('click',function(e){var symbol=$(this).parent().data('ticker');var loadUrl=investFeed.base+'watchlist/delete';$.post(loadUrl,{symbol:symbol},function(code){var obj=jQuery.parseJSON(code);if(obj.status===true){$('table#watch tr[data-ticker="'+ symbol+'"]').remove();ga('send',{hitType:'event',eventCategory:'Watchlist',eventAction:'Remove'});}});});$("a.screenshot").live('click',function(e){var url=$(this).attr('href');$.colorbox({href:url,maxWidth:'960px'}).resize();e.preventDefault();});$(document).on('click','.close',function(event){event.preventDefault();var loadUrl=investFeed.base+'position/close';var position=$(this).data('id');swal({title:"Are you sure you want to close this rating?",text:"You will not be able to reverse this.",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, close it!",closeOnConfirm:false},function(){$.post(loadUrl,{id:position},function(code){var json=jQuery.parseJSON(code);if(json.status==true){ga('send',{hitType:'event',eventCategory:'Position',eventAction:'Close'});$("a.close.id_"+ position).hide();$("span.status.id_"+ position).text('Closed');$("span.gl.id_"+ position).text(json.gl).css('color',json.gl_color);$("span.exit_price.id_"+ position).text(json.exit_price);$("span.exit_date.id_"+ position).text(json.exit_date);$("span.unrealized_gl.id_"+ position).text('');swal("Closed!","Your rating has been closed.","success");}else{swal("Oops",json.message,"error");}}).error(function(){swal("Oops","We could not close this rating, contact support!","error");});});});$("#add-comment").submit(function(e){if(investFeed.get.registrationStatus()==true){if($(this).parsley().validate()){$("#submit-button, .check_question").hide();var postData=$(this).serializeArray();var formURL=$(this).attr("action");$.ajax({url:formURL,type:"POST",data:postData,success:function(data,textStatus,jqXHR){ga('send',{hitType:'event',eventCategory:'Post Comment',eventAction:'Comment Submit'});var obj=jQuery.parseJSON(data);$(".comment.message").html(obj.message);$("#add-comment").reset();$("#submit-button, .check_question").show();},error:function(jqXHR,textStatus,errorThrown){}});}}else{swal("Account Verification","You must confirm your account before you can comment on investFeed.","error");}
e.preventDefault();});$("div#toggle-reply").live('click',function(e){var id=$(this).data('id');var reply=$(this).parent().find("div.reply.id_"+ id);var text_field=$(reply).find('textarea');$(reply).slideToggle();if($(this).data('mention')){$(text_field).val('@'+ $(this).data('mention')+" ");}else{$(text_field).val('');}});$("form#add-reply").live('submit',function(e){if(investFeed.get.registrationStatus()==true){if($(this).parsley().validate()){var id=$(this).data('id');var replyForm=$(this).parent("form.add-reply.id_"+ id);$(".form_container.reply.id_"+ id+", .manage-comments.toggle-reply.id_"+ id).hide();var postData=$(this).serializeArray();var formURL=$(this).attr("action");var parent=$(this).parents('.comment-wrap.id_'+ id).find('.row.comment');if($(parent).hasClass('question')){$(parent).find('.toggle-reply').remove();}
$.ajax({url:formURL,type:"POST",data:postData,success:function(data,textStatus,jqXHR){ga('send',{hitType:'event',eventCategory:'Post Comment',eventAction:'Reply Submit'});var obj=jQuery.parseJSON(data);$("form.add-reply.id_"+ id+" #message").html(obj.message);var reply=obj.reply;var loadURL=investFeed.base+"get/r/"+ reply;$.get(loadURL,function(data){$(".comment-wrap.id_"+ id).append(data);});},error:function(jqXHR,textStatus,errorThrown){}});}}else{swal("Account Verification","You must confirm your account before you can comment on investFeed.","error");}
e.preventDefault();});$('.manage-icon').live('click',function(e){e.preventDefault();var elm=$(this).parent().find('.manage-drop');if(elm.hasClass('is-dropped')){elm.removeClass('is-dropped').fadeOut(300).css('display','none');}else{elm.addClass('is-dropped').fadeIn(300).css('display','block');}
return false;});$('#comment-delete').live('click',function(e){e.preventDefault();var comment=$(this).parents('.comment');var id=$(comment).data('post');var comment_type=0;if($(this).parents('.comment').hasClass('reply')){comment_type=1;}
$.post(investFeed.base+'comment/delete',{comment_id:id,type:comment_type,},function(code){var obj=jQuery.parseJSON(code);if(obj.status===true){ga('send',{hitType:'event',eventCategory:'Post Comment',eventAction:'Delete'});if(comment_type==1){$(comment).remove();}else{$(comment).parent().remove();}}else{}});});$(".user_log img, .head_dwn img").click(function(){$(".drop").fadeToggle(300);$(".drop1").hide();return false;});$(document).click(function(e){if($(e.target).closest('.notification_hover, .user_hover').length===0){$(".drop, .drop1, .manage-drop").hide();}
if($(e.target).closest('.manage-hover').length===0){$('.manage-drop').removeClass('is-dropped').fadeOut(300).css('display','none');}});$("header .chat, header .chat span.green").click(function(){ga('send',{hitType:'event',eventCategory:'Notifications',eventAction:'Open'});$(".drop1").fadeToggle(300);$(function(){$('.notification_hover').jScrollPane();var notification=$('.notification_hover'),height=notification.height(),scrollHeight=notification.get(0).scrollHeight;notification.bind('mousewheel',function(e,d){if((this.scrollTop===(scrollHeight- height)&&d<0)||(this.scrollTop===0&&d>0)){e.preventDefault();}});});$(".drop").hide();var epocht=$(".drop1").data("epochtime");var loadUrl=investFeed.base+'notifications/clear';$.post(loadUrl,{epocht:epocht},function(code){var obj=jQuery.parseJSON(code);if(obj.status===true){$(".header .green.notify").hide();$('.notify').text("0");}else{alert('failed');}});return false;});$(window).scroll(function(){if($(this).scrollTop()>100){$('.scrollup').fadeIn();}else{$('.scrollup').fadeOut();}});$('.scrollup').click(function(){$("html, body").animate({scrollTop:0},600);return false;});$("button.user-follow").live('click',function(e){if($(this).hasClass('follow')){$(this).hide();$(this).parent().find('.unfollow').show();ga('send',{hitType:'event',eventCategory:'User',eventAction:'Follow',eventLabel:$(this).data('user-id')});}else{$(this).hide();$(this).parent().find('.follow').show();ga('send',{hitType:'event',eventCategory:'User',eventAction:'Unfollow',eventLabel:$(this).data('user-id')});}
$.post(investFeed.base+'follower/add',{other_id:$(this).data('user-id')},function(resp){resp=jQuery.parseJSON(resp);});});$(".users_container button#subscribe, .featured_users_container button#subscribe").live('click',function(e){var other_id=$(this).data('id');var loadUrl=investFeed.base+'follower/add';if($(this).hasClass('subscribe')){$(this).hide();$(this).parent().find('.unsubscribe').show();ga('send',{hitType:'event',eventCategory:'User',eventAction:'Follow',eventLabel:$(this).data('user-id')});}else{$(this).hide();$(this).parent().find('.subscribe').show();ga('send',{hitType:'event',eventCategory:'User',eventAction:'Unfollow',eventLabel:$(this).data('user-id')});}
$.post(loadUrl,{other_id:other_id},function(code){var obj=jQuery.parseJSON(code);if(obj.status===true){$('#following-count').html(obj.count);}else{$('#following-count').html(obj.count);}});});$(".profile-container button#subscribe").click(function(e){var currentSubs=parseInt($('.subscribers .count a').text());if($(this).hasClass('subscribe')){$(this).hide();$(this).parents().find('.unsubscribe').show();$('.subscribers .count a').text(currentSubs+ 1);ga('send',{hitType:'event',eventCategory:'User',eventAction:'Follow',eventLabel:$(this).data('user-id')});}else{$(this).hide();$(this).parents().find('.subscribe').show();$('.subscribers .count a').text(currentSubs- 1);ga('send',{hitType:'event',eventCategory:'User',eventAction:'Unfollow',eventLabel:$(this).data('user-id')});}
var other_id=$(this).data('id');var loadUrl=investFeed.base+'follower/add';$.post(loadUrl,{other_id:other_id},function(code){var obj=jQuery.parseJSON(code);if(obj.status===true){var toggle=obj.toggle;$('#subscription-count').html(obj.count);}else{var toggle=obj.toggle;var data=obj.data;$('#subscription-count').html(obj.count);}});});$("button#top-checkout").live("click",function(){var other_id=$(this).data("id");$("#checkout-form input[name='other_id']").val(other_id);$('#checkout-form').submit();ga('send',{hitType:'event',eventCategory:'User',eventAction:'Subscribe'});});$(".users_container button#checkout, .featured_users_container button#checkout").live("click",function(){var other_id=$(this).data("id");$("#checkout-form input[name='other_id']").val(other_id);$('#checkout-form').submit();ga('send',{hitType:'event',eventCategory:'User',eventAction:'Subscribe'});});$("div#checkout").click(function(){var other_id=$(this).data("id");$("#checkout-form input[name='other_id']").val(other_id);$('#checkout-form').submit();ga('send',{hitType:'event',eventCategory:'Subscription',eventAction:'Renew'});});$("div#cancel").live('click',function(e){var subscription_id=$(this).data('id');swal({title:"Are you sure you want to cancel your premium subscription?",text:"You will not be able to reverse this.",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, cancel it!",closeOnConfirm:false,showLoaderOnConfirm:true,},function(){var status=$("td.status.id_"+ subscription_id);var action=$("div.action.id_"+ subscription_id);var loadUrl=investFeed.base+'subscribe/cancel';$.post(loadUrl,{subscription_id:subscription_id},function(code){var obj=jQuery.parseJSON(code);if(obj.status===true){var message=obj.message;$(status).html(message);$(action).empty();swal("Closed!","Your subscription has been cancelled.","success");ga('send',{hitType:'event',eventCategory:'Subscription',eventAction:'Cancel'});}else{}});});});$(".auto").bind("keydown",function(event){if(event.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active){event.preventDefault();}}).autocomplete({minLength:1,html:true,source:function(request,response)
{var t=extractLast(request.term);if(t.indexOf("$")>=0){$.getJSON(investFeed.base+'hint',{term:extractLast(request.term)},response);}else if(t.indexOf("@")>=0){$.getJSON(investFeed.base+'hint-user',{term:extractLast(request.term)},response);}},select:function(event,ui){var terms=split(this.value);terms.pop();terms.push(ui.item.label);terms.push("");this.value=terms.join(" ");return false;}});$('.view-wrapper a').click(function(){$('.view-wrapper a').removeClass('active');$(this).addClass('active');id=$(this).data('id');$('.view-tab').css('display','none');$('.'+ id).css('display','block');return false;});$('.edit-post').live('click',function(e){var $content=$(this).parents('.post').find('.post-info').find('.content');$content.attr('contenteditable','true');$content.text($.trim($content.text()));investFeed.post.edit.stored_content=$content.text();$content.focus().addClass('focused');e.stopPropagation();ga('send',{hitType:'event',eventCategory:'Post',eventAction:'Edit'});});$('.post-info .row .content').keyup(function(e){if(e.keyCode==13){$(this).trigger('blur');}});$('.post-info .row .content').live('blur',function(e){if($(this).text().length<=500){$(this).css({"border-radius":"0px","border":"none","box-shadow":"none","color":"#000"});$post_id=$(this).parents('.post').find('.edit-post').data('id');if($(this).text()!=investFeed.post.edit.stored_content){$.ajax({url:'/post/ajax/edit',type:'POST',data:{post_id:$post_id,content:$(this).text()},cache:false,dataType:'json'});}
$(this).attr('contenteditable','false');}
$(this).removeClass('focused');e.stopPropagation();});$('.actions-wrap .links').live('click',function(e){var $post=$(this).parents('.post');var $link_box=$post.find('.quick-link');var post_id=$post.data('postid');var $textbox=$('#quicklink_'+ post_id);if($link_box.hasClass('open')){$link_box.slideUp(360,function(){$link_box.css({'border-top':'none'});ga('send',{hitType:'event',eventCategory:'Post Permalink',eventAction:'Close'});}).removeClass('open');}else{ga('send',{hitType:'event',eventCategory:'Post Permalink',eventAction:'Open'});if($textbox.val().indexOf("http://ifeed.io/")>-1){$link_box.css({'border-top':'1px solid #DDDDDD'});$link_box.slideDown(360).addClass('open');}else{var loadURL=investFeed.base+"post/ajax/link/"+ post_id;$.get(loadURL,function(data){data=jQuery.parseJSON(data)
$textbox.val(data.url);$link_box.css({'border-top':'1px solid #DDDDDD'});$link_box.slideDown(360).addClass('open');});}}
e.preventDefault();return false;});$('.quick-link-container input').live('click',function(e){$(this).focus().select();return false;});var view_more=[];$('.actions-wrap .comments').live('click',function(e){e.preventDefault();var $post=$(this).parents('.post');var $stream=$post.find('.comment-stream');var $container=$stream.find('.comment-container');var $comments=$stream.find('.parent');var post_id=$post.data('postid');if((!$container.hasClass('viewed-more'))&&$comments.length>3){view_more[post_id]=$comments.slice(0,$comments.length- 3);$comments.slice(0,$comments.length- 3).hide();if(view_more[post_id].length>0){if($container.find('.more_comments').length==0){$container.prepend('<div class="more_comments"><p>View Previous Comments</p></div>');}}}
if($stream.hasClass('open')){$stream.slideUp(360,function(){$stream.css({'border-top':'none'});ga('send',{hitType:'event',eventCategory:'Post Comments',eventAction:'Close'});}).removeClass('open');}else{ga('send',{hitType:'event',eventCategory:'Post Comments',eventAction:'Open'});$stream.css({'border-top':'1px solid #DDDDDD'});$stream.slideDown(360).addClass('open');}
return false;});$('.comment-stream .more_comments').live('click',function(){var $post=$(this).parents('.post');var $stream=$post.find('.comment-stream');var $container=$stream.find('.comment-container');var post_id=$post.data('postid');$container.prepend(view_more[post_id].fadeIn(360));$container.addClass('viewed-more').find('.more_comments').remove();ga('send',{hitType:'event',eventCategory:'Post Comments',eventAction:'View More'});});$('.comment-stream .fa-reply').live('click',function(e){var post_id=$(this).data('id');var reply=$('.reply_'+ post_id);var text_field=$(reply).find('textarea');if($(this).data('mention')){$(text_field).val('@'+ $(this).data('mention')+" ");}else{$(text_field).val('');}
$(reply).slideToggle(360,function(){$(text_field).focus();});ga('send',{hitType:'event',eventCategory:'Post Comments',eventAction:'Compose Reply'});});$("form#add-stream-reply").live('submit',function(e){$elm=$(this);if(investFeed.get.registrationStatus()==true){if($elm.parsley().validate()&&(!$elm.hasClass('clicked'))){var id=$elm.data('id');var reply_id=$elm.data('replyid')
var post_id=$elm.closest('.post').data('postid');var replyForm=$elm.parent("form.add-stream-reply.id_"+ id);var postData=$elm.serializeArray();var formURL=$elm.attr("action");var target=$('.reply_'+ id).parents('.parent').find('.child');$elm.addClass('clicked');$.ajax({url:formURL,type:"POST",data:postData,success:function(data,textStatus,jqXHR){var obj=jQuery.parseJSON(data);var reply=obj.reply;$('.reply_'+ reply_id).slideToggle();$elm.removeClass('clicked');var loadURL=investFeed.base+"get/stream/r/"+ reply;$.get(loadURL,function(data){$(target).append(data);investFeed.comments.incrementCount(post_id);});ga('send',{hitType:'event',eventCategory:'Post Comments',eventAction:'Submit Reply'});},error:function(jqXHR,textStatus,errorThrown){$elm.removeClass('clicked');}});}}else{swal("Account Verification","You must confirm your account before you can comment on investFeed.","error");}
e.preventDefault();});$("form#add-stream-comment").live('submit',function(e){$elm=$(this);if(investFeed.get.registrationStatus()==true){if($elm.parsley().validate()&&(!$elm.hasClass('clicked'))){var id=$(this).data('id');var postData=$(this).serializeArray();var formURL=$(this).attr("action");var form=$(this);var container=$('.comment-container.id_'+ id);$elm.addClass('clicked');$.ajax({url:formURL,type:"POST",data:postData,success:function(data,textStatus,jqXHR){var obj=jQuery.parseJSON(data);$(form)[0].reset();$elm.removeClass('clicked');var loadURL=investFeed.base+"get/stream/c/"+ obj.comment_id;$.get(loadURL,function(data){$(data).insertBefore($(container).find(".compose"));$(container).find(".empty-notification").remove();investFeed.comments.incrementCount(id);});ga('send',{hitType:'event',eventCategory:'Post Comments',eventAction:'Submit Comment'});},error:function(jqXHR,textStatus,errorThrown){$elm.removeClass('clicked');}});}}else{swal("Account Verification","You must verify your account before you can comment on investFeed.","error");}
e.preventDefault();});$('.quick-link .actions .fa-twitter').live('click',function(){var url=$('#quicklink_'+ $(this).parents('.post').data('postid')).val().trim();window.open("https://twitter.com/intent/tweet?url="+ url+"&via=investFeed")
ga('send',{hitType:'event',eventCategory:'Post Permainlink',eventAction:'Share',eventLabel:'Twitter'});});$('.quick-link .actions .fa-facebook').live('click',function(){var url=$('#quicklink_'+ $(this).parents('.post').data('postid')).val().trim();window.open("https://www.facebook.com/sharer/sharer.php?u="+ url);ga('send',{hitType:'event',eventCategory:'Post Permainlink',eventAction:'Share',eventLabel:'Facebook'});});$('.quick-link .actions .fa-linkedin').live('click',function(){var url=$('#quicklink_'+ $(this).parents('.post').data('postid')).val().trim();window.open("https://www.linkedin.com/shareArticle?mini=true&title=investFeed.com&summary=Checkout+this+post+on+investFeed%21&url="+ url);ga('send',{hitType:'event',eventCategory:'Post Permainlink',eventAction:'Share',eventLabel:'LinkedIn'});});$("#resend-verification").click(function(e){e.preventDefault();var loadURL=investFeed.base+"user/resend-verification"
$.get(loadURL,function(data){swal("Email Sent","Your investFeed account verification email has been sent.","success");});ga('send',{hitType:'event',eventCategory:'User',eventAction:'Verification Resend'});return false;});var $edit_timer=setInterval(function(){$('.post_container .is-editable').each(function(){if(Math.floor((new Date).getTime()/ 1000) > ($(this).data('created') + 180)) {
$(this).find('.edit-post').remove();$(this).removeClass('is-editable');}});},1000);$('.posts_container').on({click:function(e){e.preventDefault();var pid=$(this).data('id');var that=$(this);if($('.post-stats#stats_'+ pid).length>0){ga('send',{hitType:'event',eventCategory:'Post Stats',eventAction:'Close'});$(this).removeClass('open');$('.post-stats#stats_'+ pid).stop().slideUp(350,function(){$(this).remove();});}else{ga('send',{hitType:'event',eventCategory:'Post Stats',eventAction:'Open'});if(!that.data('loading')){that.data('loading',true);$(this).addClass('open');$.ajax({url:'/post/ajax/stats',type:'POST',data:{post_id:pid},cache:false,success:function(data){$('#row_'+ pid).append(data);$('.post-stats#stats_'+ pid).stop().slideDown();},complete:function(){that.data('loading',false);},});}}}},".posts_container .stats .stat");$(document).on({click:function(e){var symbol=$(this).data('symbol');var button=$(this);if($(this).hasClass('watch')){$.post(investFeed.base+'watchlist/add',{symbols:symbol},function(code){var obj=jQuery.parseJSON(code);if(obj.html!==""){$('#watchlist table').append(obj.html);watchlistNew();$('#watchlist table tr').removeClass("new");$('.watchlist .empty-notification').hide();$(button).removeClass('watch').addClass('watching').text('Watching');ga('send',{hitType:'event',eventCategory:'Watchlist',eventAction:'Add',eventLabel:symbol});}
if(obj.status===false){swal('Watchlist Error','Your watchlist may only contain 50 symbols, or the symbol you have added is no longer supported.','error');}});}else{$.post(investFeed.base+'watchlist/delete',{symbol:symbol},function(code){var obj=jQuery.parseJSON(code);if(obj.status===true){ga('send',{hitType:'event',eventCategory:'Watchlist',eventAction:'Delete',eventLabel:symbol});$('table#watch tr[data-ticker="'+ symbol+'"]').remove();$(button).removeClass('watching').addClass('watch').text('Watch');}});}}},".watchlist-add");$('.head_cont2 .inbox > a').on('click',function(){investFeed.messages.open();return false;});$(document).on('click','.ticker-tag',function(){ga('send',{hitType:'event',eventCategory:'Ticker',eventAction:'Click',eventLabel:$(this).data('symbol')});});$(document).on('click','.action-direct-message',function(){investFeed.messages.open($(this).data('user-id'));ga('send',{hitType:'event',eventCategory:'Messages',eventAction:'Open Conversation'});});$('.modal.messaging').on('click','.action-direct-message',function(){investFeed.messages.open($(this).data('user-id'));ga('send',{hitType:'event',eventCategory:'Messages',eventAction:'Open Conversation'});});$('.modal.messaging .dm-header .dm-goto-exit').on('click',function(){investFeed.messages.closeMessages();ga('send',{hitType:'event',eventCategory:'Messages',eventAction:'Close'});});$('.modal.messaging .dm-header .dm-goto-history').on('click',function(){investFeed.messages.open();ga('send',{hitType:'event',eventCategory:'Messages',eventAction:'View Conversations'});});$('.modal.messaging').on('click','button.dm-send',function(){investFeed.messages.sendMessage($(this));ga('send',{hitType:'event',eventCategory:'Messages',eventAction:'Send Message'});});$('.modal.messaging').on('click','.direct-message-delete',function(){investFeed.messages.deleteMessage($(this));ga('send',{hitType:'event',eventCategory:'Messages',eventAction:'Delete'});});function split(val){return val.split(/ /);}
function extractLast(term){return split(term).pop();}});