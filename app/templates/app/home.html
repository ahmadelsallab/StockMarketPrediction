{% extends "app/layout.html" %}

{% block content %}
{% load static %}


<div id="debug"></div>
<div id="main_content">
    <h1 class="page-header" align="right">التغريدات</h1>
    <table style="width:100%">
    <tr class="controller">
    <td style="width:40%; height:30px;"></td>
    <td>
	<div class="controller" id="controller1" style="width: 700px; height: 30px;">
	<input type="range" id="slider" min="5" max="75" value="25" step="5" oninput="document.getElementById('slider').value=this.value" />
	</div>
    </td>
    </tr>
    <tr>
    <td style="width:40%"><div id="stats"></div></td>
    <!--
    <td style="width:60%"><div id="curve_chart" style="width: 700px; height: 350px"></div></td>
    -->
    <td style="width:60%"><div id="chart_div" style="width: 700px; height: 350px;"></div></td>
    </tr>
    </table>
    <div id="tweets" style=" height: 2000px; overflow-y: scroll;"></div>
    <div id="tweets_loading">
        <img src="{% static 'app/images/loading.gif' %}" />
    </div>
    
</div>
<div id="side_bar">
    <input id="side_bar_selection" type="text" placeholder="... بحث" class="form-control" />
    <ul id="side_bar_list">
		<li>تاسي</li>
		<li>الرياض</li>
		<li>الجزيرة</li>
		<li>استثمار</li>
		<li>السعودي الهولندي</li>
		<li>السعودي الفرنسي</li>
		<li>ساب</li>
		<li>العربي الوطني</li>
		<li>سامبا</li>
		<li>الراجحي</li>
		<li>البلاد</li>
		<li>الإنماء</li>
                <li>البنك الأهلي</li>
		<li>كيمانول</li>
		<li>بتروكيم</li>
		<li>سابك</li>
		<li>سافكو</li>
		<li>التصنيع</li>
		<li>اللجين</li>
		<li>نماء للكيماويات</li>
		<li>المجموعة السعودية</li>
		<li>الصحراء للبتروكيماويات</li>
		<li>ينساب</li>
		<li>سبكيم العالمية</li>
		<li>المتقدمة</li>
		<li>كيان</li>
		<li>بترو رابغ</li>
		<li>أسمنت حائل</li>
		<li>أسمنت نجران</li>
		<li>اسمنت المدينة</li>
		<li>اسمنت الشمالية</li>
		<li>اسمنت ام القرى</li>
		<li>الاسمنت العربية</li>
		<li>اسمنت اليمامة</li>
		<li>اسمنت السعوديه</li>
		<li>اسمنت القصيم</li>
		<li>اسمنت الجنوبيه</li>
		<li>اسمنت ينبع</li>
		<li>اسمنت الشرقية</li>
		<li>اسمنت تبوك</li>
		<li>اسمنت الجوف</li>
		<li>أسواق ع العثيم</li>
		<li>المواساة</li>
		<li>إكسترا</li>
		<li>دله الصحية</li>
		<li>رعاية</li>
		<li>أسواق المزرعة</li>
		<li>الحمادي</li>
		<li>ساسكو</li>
		<li>ثمار</li>
		<li>مجموعة فتيحي</li>
		<li>جرير</li>
		<li>الدريس</li>
		<li>الحكير</li>
		<li>الخليج للتدريب</li>
		<li>الغاز والتصنيع</li>
		<li>كهرباء السعودية</li>
		<li>مجموعة صافولا</li>
		<li>الغذائية</li>
		<li>سدافكو</li>
		<li>المراعي</li>
		<li>أنعام القابضة</li>
		<li>حلواني إخوان</li>
		<li>هرفي للأغذية</li>
		<li>التموين</li>
		<li>نادك</li>
		<li>القصيم الزراعيه</li>
		<li>تبوك الزراعيه</li>
		<li>الأسماك</li>
		<li>الشرقية للتنمية</li>
		<li>الجوف الزراعيه</li>
		<li>بيشة الزراعيه</li>
		<li>جازان للتنمية</li>
		<li>الاتصالات</li>
		<li>اتحاد اتصالات</li>
		<li>زين السعودية</li>
		<li>عذيب للاتصالات</li>
		<li>المتكاملة</li>
		<li>التعاونية</li>
		<li>العربي للتأمين</li>
		<li>جزيرة تكافل</li>
		<li>ملاذ للتأمين</li>
		<li>ميدغلف للتأمين</li>
		<li>أليانز إس إف</li>
		<li>سلامة</li>
		<li>ولاء للتأمين</li>
		<li>الدرع العربي</li>
		<li>ساب تكافل</li>
		<li>سند</li>
		<li>سايكو</li>
		<li>وفا للتأمين</li>
		<li>إتحاد الخليج</li>
		<li>الأهلي للتكافل</li>
		<li>الأهلية</li>
		<li>أسيج</li>
		<li>التأمين العربية</li>
		<li>الاتحاد التجاري</li>
		<li>الصقر للتأمين</li>
		<li>المتحدة للتأمين</li>
		<li>الإعادة السعودية</li>
		<li>بوبا العربية</li>
		<li>وقاية للتكافل</li>
		<li>تكافل الراجحي</li>
		<li>ايس</li>
		<li>اكسا- التعاونية</li>
		<li>الخليجية العامة</li>
		<li>بروج للتأمين</li>
		<li>العالمية</li>
		<li>سوليدرتي تكافل</li>
		<li>الوطنية</li>
		<li>أمانة للتأمين</li>
		<li>عناية</li>
		<li>الإنماء طوكيو م</li>
		<li>المصافي</li>
		<li>المتطورة</li>
		<li>الاحساء للتنميه</li>
		<li>سيسكو</li>
		<li>عسير</li>
		<li>الباحة</li>
		<li>المملكة</li>
		<li>تكوين</li>
		<li>بى سى آى</li>
		<li>معادن</li>
		<li>أسترا الصناعية</li>
		<li>مجموعة السريع</li>
		<li>شاكر</li>
		<li>الدوائية</li>
		<li>زجاج</li>
		<li>فيبكو</li>
		<li>معدنية</li>
		<li>الكيميائيه السعوديه</li>
		<li>صناعة الورق</li>
		<li>العبداللطيف</li>
		<li>الصادرات</li>
		<li>أسلاك</li>
		<li>بوان</li>
		<li>الصناعات الكهربائيه</li>
		<li>مجموعة المعجل</li>
		<li>الأنابيب السعودية</li>
		<li>الخضري</li>
		<li>الخزف</li>
		<li>الجبس</li>
		<li>الكابلات</li>
		<li>صدق</li>
		<li>اميانتيت</li>
		<li>أنابيب</li>
		<li>الزامل للصناعة</li>
		<li>البابطين</li>
		<li>الفخارية</li>
		<li>مسك</li>
		<li>البحر الأحمر</li>
		<li>العقارية</li>
		<li>طيبة للاستثمار</li>
		<li>مكة للانشاء</li>
		<li>التعمير</li>
		<li>إعمار</li>
		<li>جبل عمر</li>
		<li>دار الأركان</li>
		<li>مدينة المعرفة</li>
		<li>البحري</li>
		<li>النقل الجماعي</li>
		<li>مبرد</li>
		<li>بدجت السعودية</li>
		<li>تهامه للاعلان</li>
		<li>الأبحاث و التسويق</li>
		<li>طباعة وتغليف</li>
		<li>الطيار</li>
		<li>مجموعة الحكير</li>
		<li>دور</li>
		<li>شمس</li>
		<li>الشرق الاوسط لصناعه</li>
		<li>ساكو</li>

    </ul>
</div>
{% endblock %}

{% block scripts %}

{% load static %}
<script type="text/javascript" src="{% static 'django_ajax/js/jquery.ajax.min.js' %}"></script>
<script src="{% static 'app/twemoji-gh-pages/twemoji.min.js' %}"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript"
          src="https://www.google.com/jsapi?autoload={
            'modules':[{
              'name':'visualization',
              'version':'1',
              'packages':['corechart']
            }]
          }"></script>
<script type="text/javascript">

//      function drawChart_line(stock) {
//            ajaxPost('/get_prices_line', { 'query': stock }, function (prz_line) {
//                //console.debug(prz)
//        var data = google.visualization.arrayToDataTable(prz_line
//        );
//
//        var options = {
//          title: '',
//          curveType: 'none',
//          legend: { position: 'bottom' }
//        };
//
//        var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
//
//        chart.draw(data, options);
//                });
//      }

  function drawChart_candle(stock,slid) {
        ajaxPost('/get_prices_candle', { 'query': stock }, function (prz_candle) {
	console.debug(prz_candle.length);
	var l_data = [];
        for (i = 0; i < slid; i++) {
        l_data[i]=prz_candle[i+prz_candle.length-slid];
        }
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Day');
    data.addColumn('number', 'Low');
    data.addColumn('number', 'Open');
    data.addColumn('number', 'Close');
    data.addColumn('number', 'High');
    data.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
    data.addRows(l_data);

    var options = {
	tooltip: {isHtml: true},
	legend:'none',
	backgroundColor:'#F5F5F5',
	animation: {
	duration: 2000,
	startup: true,
	easing: 'inAndOut'
	},
	chartArea: {
	left: 50,
	width: '90%',
	height: '65%',
	},
	hAxis: {
	textStyle:{fontSize: 10}
	},
        vAxis: {
        textStyle:{fontSize: 10}
        },
	legend: {
	position: 'right'
	},
        candlestick: {
        fallingColor: { strokeWidth: 0, fill: '#a52714' }, // red
        risingColor: { strokeWidth: 0, fill: '#0f9d58' }   // green
        }
    };

    var chart = new google.visualization.CandlestickChart(document.getElementById('chart_div'));

    chart.draw(data, options);
                });
  }

             
    function findUrls( text )
    {
        var source = (text || '').toString();
        var urlArray = [];
        var url;
        var matchArray;
    
        // Regular expression to find FTP, HTTP(S) and email URLs.
        var regexToken = /(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)|((mailto:)?[_.\w-]+@([\w][\w\-]+\.)+[a-zA-Z]{2,3})/g;
    
        // Iterate through any URLs in the text.
        while( (matchArray = regexToken.exec( source )) !== null )
        {
            var token = matchArray[0];
	    if (token.indexOf("twemoji") < 0) 
             {urlArray.push(token);}
            //console.debug(token)
            //console.debug(token.indexOf("twemoji"))
        }
    
        return urlArray;
    }
    
    $(window).load(function () {
        var screenWidth = document.documentElement.clientWidth;
        var screenHeight = document.documentElement.clientHeight;

	$(".controller").hide()
        $("#side_bar").css({ "min-height": (screenHeight - 52) + "px" });
        $("#main_content").width(screenWidth - 270);
/*        ajaxPost('/get_stocks_weights', {}, function (content) {
            var word_list = []
            word_list = content
            //console.debug(word_list)
            $("#word_cloud_container").jQCloud(word_list,{width:screenWidth,height:500});    
            
        });
*/        
    });

    $('#side_bar_selection').keyup(function () {
        var value = $(this).val();
        $("#side_bar_list > li").each(function () {
            if ($(this).text().indexOf(value) > -1) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    });

    //$(".slider").on("change", function(){console.debug($(this).value)});
    $(document.getElementById('slider')).on("change", function(){
	//console.log(document.getElementById('slider').value);
	google.setOnLoadCallback(drawChart_candle("ay_haga",document.getElementById('slider').value))
	});
    $('#side_bar_list > li').click(function () {
	console.log($('#slider').value);
        $('.select_list_item').removeClass('select_list_item');
        $(this).addClass('select_list_item');
	//google.setOnLoadCallback(drawChart_line($(this).text()));
        google.load("visualization", "1", {packages:["corechart"]});
	google.setOnLoadCallback(drawChart_candle($(this).text(),30));
	$(".controller").show()

        $('#tweets').fadeOut('fast');
        $("#tweets").animate({ scrollTop: 0 }, "fast");
        $('#tweets_loading').fadeIn('fast');

        var stock_name = $(this).text()
        ajaxPost('/get_tweets', { 'query': $(this).text() }, function (content) {
            $('#tweets').html('');
            $('#stats').html('<div id="total_all" class="stat_total"><font color="black">' + 'Total number of entries in DB is: ' + content.total_entries_in_DB + '</font></div>');
            $('#stats').append('<div id="total_lab" class="stat_total"><font color="black">' + 'Total number of fully labeled entries in DB is: ' + content.total_labeled_entries_in_DB + '</font></div>');
            $('#stats').append('<div id="total_rel" class="stat_total"><font color="black">' + 'Total number of relevant entries in DB is: ' + content.total_relevant_labeled_entries_in_DB + '</font></div>');
            $('#stats').append('<div id="total_irel" class="stat_total"><font color="black">' + 'Total number of irrelevant entries in DB is: ' + content.total_irrelevant_labeled_entries_in_DB + '</font></div>');
            $('#stats').append('<div id="total_pos" class="stat_total"><font color="black">' + 'Total number of positive entries in DB is: ' + content.total_positive_labeled_entries_in_DB + '</font></div>');
            $('#stats').append('<div id="total_neg" class="stat_total"><font color="black">' + 'Total number of negative entries in DB is: ' + content.total_negative_labeled_entries_in_DB + '</font></div>');
            $('#stats').append('<div id="total_neu" class="stat_total"><font color="black">' + 'Total number of neutral entries in DB is: ' + content.total_neutral_labeled_entries_in_DB + '</font></div>');

		$('#stats').append('<br></br>')
                $('#tweets').append('<div id="stock_all" class="stat_stock"><font color="black">' + 'Total number of entries in DB for ' + stock_name + ' is: ' + content.stock_entries_in_DB + '</font></div>');
            $('#tweets').append('<div id="stock_lab" class="stat_stock"><font color="black">' + 'Total number of fully labeled entries in DB for ' + stock_name + ' is: ' + content.stock_labeled_entries_in_DB + '</font></div>');
            $('#tweets').append('<div id="stock_rel" class="stat_stock"><font color="black">' + 'Total number of relevant entries in DB for ' + stock_name + ' is: ' + content.stock_relevant_labeled_entries_in_DB + '</font></div>');
            $('#tweets').append('<div id="stock_irel" class="stat_stock"><font color="black">' + 'Total number of irrelevant entries in DB for ' + stock_name + ' is: ' + content.stock_irrelevant_labeled_entries_in_DB + '</font></div>');
            $('#tweets').append('<div id="stock_pos" class="stat_stock"><font color="black">' + 'Total number of positive entries in DB for ' + stock_name + ' is: ' + content.stock_positive_labeled_entries_in_DB + '</font></div>');
            $('#tweets').append('<div id="stock_neg" class="stat_stock"><font color="black">' + 'Total number of negative entries in DB for ' + stock_name + ' is: ' + content.stock_negative_labeled_entries_in_DB + '</font></div>');
            $('#tweets').append('<div id="stock_neu" class="stat_stock"><font color="black">' + 'Total number of neutral entries in DB for ' + stock_name + ' is: ' + content.stock_neutral_labeled_entries_in_DB + '</font></div>'); 
            $('#tweets').append('<br></br>')
            $('#stats').append('<div class="stat"><font color="black">' + 'Stock: '  + stock_name + ' Price: ' + content.price + '</font></div>'); 
            
            for (var i = 0; i < content.statuses.length; i++) {
		text = twemoji.parse(content.statuses[i]['text'], {size: 16});
                //text = content.statuses[i]['text'];
                date = content.statuses[i].created_at;
                diff=(new Date()).getTimezoneOffset()*60*1000;
                date=Date.parse(content.statuses[i]['created_at']);

                date=new Date(date);
                date1=date.toLocaleDateString();
                currDate=date1;
                date2=date.toLocaleTimeString();
                date=date1+' '+date2;
                followers_no = content.statuses[i].user_followers_count;
                tweeter_name =  "\n" + content.statuses[i].tweeter_name;
                tweeter_sname = '@' + content.statuses[i].tweeter_sname;
                image = content.statuses[i].user_profile_image_url;
                tweet_id = content.statuses[i].twitter_id;
                //ele=JSON.stringify(content.statuses[i].shw, null, 4);
				media_url1='';
				try{
				media_url=content.statuses[i].media_url;
				media_url=media_url.replace(/'/g, '"');
				media_url1=JSON.parse(media_url);
				media_url=(media_url1.media[0]).media_url;
				if(media_url !=null) media_url='<img src='+media_url+'>'; else media_url='';
				}catch(err){
				try{
				media_url=(media_url1.urls[0]).expanded_url;
				if(media_url.indexOf("youtu.be")>-1)
				{
				startindex=media_url.lastIndexOf('\/');
				media_url=media_url.substr(startindex);
                                if(media_url == undefined || media_url == 'undefined'  || media_url == ''  || media_url == null  || media_url == 'null'  )  media_url='' ; else
				media_url='<iframe width="560" height="315" src="https://www.youtube.com/embed/'+media_url+'" frameborder="0" allowfullscreen></iframe>'
				}
				else media_url='';
				}
				catch(err){media_url='';}

				}
                //media_url=JSON.stringify(media_url, null, 4);
                /*
                media_url='';
                try{
                media_url=content.statuses[i].media_url;
                if(media_url.indexOf('media_url') < 0 )      media_url=null;
                if(media_url!=null){
                media_url=media_url.substr(media_url.indexOf("'media_url': 'http://")+12);
                media_url=media_url.substr(0,media_url.indexOf(","));
                media_url=media_url.replace(/\(|\)|\{|\}|\[|\]|\'/g, "");
                }
                }
                catch(err){}
                if(media_url !=null) media_url='<img src='+media_url+'>'; else media_url='';*/
                                url1='';
                                try{
                                url1=findUrls(text); 
                                }
                                catch(err){}
                                if(url1!='')
                                for (var ii = 0; ii < url1.length; ii++)
                                {
                                text=text.replace(url1[ii],'<a target="_blank" href="'+url1[ii]+'">'+url1[ii]+'</a>');
                                }

                $('#tweets').append('<div class="tweet"><table align="right"><tr><td width="70%" align="right" valign="up"><b><br><font color="black">' + tweeter_name + '</br></b></td><td></td><th rowspan="2" valign="up"><img src="' + image + '"/></th></tr><tr><td align="right" valign="up"><p><font color="LightGray">' + tweeter_sname + '</p></td></tr></table><br></br><br></br><p><font color="black"><div id='+tweet_id+'" >' + text + '</div><br />' + date + '<br /><span>Followers no: ' + followers_no + '</span></p><br />' + media_url + '<br /><button id= "corRel'+tweet_id+'" class="cor" type="button" value="relevant">Relevant</button>    <button id ="corIrrel'+tweet_id+'" class="cor" type="button" value="irrelevant">Irrelevant</button><br/><br/><button id= "positive'+tweet_id+'" class="sentiment" type="button" value="positive">Positive</button>      <button id ="negative'+tweet_id+'" class="sentiment" type="button" value="negative">Negative</button>   <button id ="neutral'+tweet_id+'" class="sentiment" type="button" value="neutral">Neutral</button></div>');

                //$('#tweets').append('<div class="tweet"><img src="' + image + '" /><p><span id="text'+i+'" >' + text + '</span><br />' + date + '<br /><span>Followers no: ' + followers_no + '</span></p><br /><button id= "corRel'+i+'" class="cor" type="button" value="relevant">Relevant</button><button id ="corIrrel'+i+'" class="cor" type="button" value="irrelevant">Irrelevant</button></div>');
                //$('#tweets').append('<div class="tweet"><img src="' + image + '" /><p><span id="text'+i+'" >' + text + '</span><br />' + date + '<br /><span>Followers no: ' + followers_no + '</span></p><br /><button id= "postive'+i+'" class="sentiment" type="button" value="positive">Positive</button><button id ="negative'+i+'" class="sentiment" type="button" value="irrelevant">Negative</button><button id ="neutral'+i+'" class="sentiment" type="button" value="neutral">Neutral</button></div>');
                //$('#tweets').append('<div class="tweet"><img src="' + image + '" /><p><span id="text'+i+'" >' + text + '</span><br />' + date + '<br /><span>Followers no: ' + followers_no + '</span></p><br /><button id= "corRel'+i+'" class="cor" type="button" value="relevant">Relevant</button><button id ="corIrrel'+i+'" class="cor" type="button" value="irrelevant">Irrelevant</button></div>')
                //$('#tweets').append('<div><button id= "postive'+i+'" class="sentiment" type="button" value="positive">Positive</button><button id ="negative'+i+'" class="sentiment" type="button" value="irrelevant">Negative</button><button id ="neutral'+i+'" class="sentiment" type="button" value="neutral">Neutral</button></div>');
            }
			
            $('#tweets').fadeIn('fast');
            $("#tweets").animate({ scrollTop: 0 }, "fast");
            $('#tweets_loading').fadeOut('fast');
        });
    });
    var sentEditFlag = []
    var relEditFlag = []
    var EditCounter = 50;
    $('body').on('click', '.editSentiment', function () {
	var item = $(this).attr("id").match(/[0-9]+/g)[0];
	var user_action=$(this).attr("value")
	var stock = $('.select_list_item').text();
        $('#negative'+item).show();
        $('#neutral'+item).show();
        editstring="<button id= positive"+item+ " class=sentiment type=button value=positive>Positive</button>"
	//console.debug(user_action)
	$('#editSentLab'+item).replaceWith(editstring);

	if(user_action == "positive")
                        {
                        N=(Number(document.getElementById('total_pos').innerHTML.match(/\d+/))-1).toString();
			newstring="<div id='total_pos' class='stat_total'><font color='black'> Total number of positive entries in DB is: " + N + "</font></div>" 
			$('#total_pos').hide();
			$('#total_pos').replaceWith(newstring);
			
			N=(Number(document.getElementById('stock_pos').innerHTML.match(/\d+/))-1).toString();
			newstring="<div id='stock_pos' class='stat_total'><font color='black'> Total number of positive entries in DB for " + stock + " is: " + N + "</font></div>" 
			$('#stock_pos').hide();
			$('#stock_pos').replaceWith(newstring);
                        }		
	else if(user_action == "negative")	
	            {
                        N=(Number(document.getElementById('total_neg').innerHTML.match(/\d+/))-1).toString();
			newstring="<div id='total_neg' class='stat_total'><font color='black'> Total number of negative entries in DB is: " + N + "</font></div>" 
			$('#total_neg').hide();
			$('#total_neg').replaceWith(newstring);
			
			N=(Number(document.getElementById('stock_neg').innerHTML.match(/\d+/))-1).toString();
			newstring="<div id='stock_neg' class='stat_total'><font color='black'> Total number of negative entries in DB for " + stock + " is: " + N + "</font></div>" 
			$('#stock_neg').hide();
			$('#stock_neg').replaceWith(newstring);
                        }	
	else if(user_action == "neutral")	
	            {
                        N=(Number(document.getElementById('total_neu').innerHTML.match(/\d+/))-1).toString();
			newstring="<div id='total_neu' class='stat_total'><font color='black'> Total number of neutral entries in DB is: " + N + "</font></div>" 
			$('#total_neu').hide();
			$('#total_neu').replaceWith(newstring);
			
			N=(Number(document.getElementById('stock_neu').innerHTML.match(/\d+/))-1).toString();
			newstring="<div id='stock_neu' class='stat_total'><font color='black'> Total number of neutral entries in DB for " + stock + " is: " + N + "</font></div>" 
			$('#stock_neu').hide();
			$('#stock_neu').replaceWith(newstring);
                    }	
	sentEditFlag[item]=0;
	});	

    $('body').on('click', '.sentiment', function () {
	var item = $(this).attr("id").match(/[0-9]+/g)[0];
	if ( sentEditFlag[item] == 1 )
	{
		return;
	}
	sentEditFlag[item]=1
	var stock = $('.select_list_item').text();
        var user_action = $(this).attr("value")
	ajaxPost('/get_correction', { 'relevancy': 'none', 'sentiment': $(this).attr("value") ,'tweet_id': item,'stock':stock },function (content) {
        //console.debug($('#positive'+item))
        $('#negative'+item).hide();
        $('#neutral'+item).hide();
        editstring="<button id= editSentLab"+item +" class=editSentiment type=button value="+user_action+">Edit My Label</button>"
	//console.debug(editstring)
       	$('#positive'+item).replaceWith(editstring);


	if(user_action == "positive")
                        {
                        N=(Number(document.getElementById('total_pos').innerHTML.match(/\d+/))+1).toString();
			newstring="<div id='total_pos' class='stat_total'><font color='black'> Total number of positive entries in DB is: " + N + "</font></div>" 
			$('#total_pos').hide();
			$('#total_pos').replaceWith(newstring);
			
			N=(Number(document.getElementById('stock_pos').innerHTML.match(/\d+/))+1).toString();
			newstring="<div id='stock_pos' class='stat_total'><font color='black'> Total number of positive entries in DB for " + stock + " is: " + N + "</font></div>" 
			$('#stock_pos').hide();
			$('#stock_pos').replaceWith(newstring);
                        }		
	else if(user_action == "negative")	
	            {
                        N=(Number(document.getElementById('total_neg').innerHTML.match(/\d+/))+1).toString();
			newstring="<div id='total_neg' class='stat_total'><font color='black'> Total number of negative entries in DB is: " + N + "</font></div>" 
			$('#total_neg').hide();
			$('#total_neg').replaceWith(newstring);
			
			N=(Number(document.getElementById('stock_neg').innerHTML.match(/\d+/))+1).toString();
			newstring="<div id='stock_neg' class='stat_total'><font color='black'> Total number of negative entries in DB for " + stock + " is: " + N + "</font></div>" 
			$('#stock_neg').hide();
			$('#stock_neg').replaceWith(newstring);
                        }	
	else if(user_action == "neutral")	
	            {
                        N=(Number(document.getElementById('total_neu').innerHTML.match(/\d+/))+1).toString();
			newstring="<div id='total_neu' class='stat_total'><font color='black'> Total number of neutral entries in DB is: " + N + "</font></div>" 
			$('#total_neu').hide();
			$('#total_neu').replaceWith(newstring);
			
			N=(Number(document.getElementById('stock_neu').innerHTML.match(/\d+/))+1).toString();
			newstring="<div id='stock_neu' class='stat_total'><font color='black'> Total number of neutral entries in DB for " + stock + " is: " + N + "</font></div>" 
			$('#stock_neu').hide();
			$('#stock_neu').replaceWith(newstring);
                    }	
		});
	});

    $('body').on('click', '.editRel', function () {
	var item = $(this).attr("id").match(/[0-9]+/g)[0];
	var user_action=$(this).attr("value")
	var stock = $('.select_list_item').text();
        $('#corIrrel'+item).show();
        editstring="<button id= corRel"+item+" class=cor type=button value=relevant>Relevant</button>"
        $('#corRel'+item).replaceWith(editstring);
	//console.debug(editstring)
	//console.debug(user_action)
	$('#editRelLab'+item).replaceWith(editstring);

        if(user_action == "relevant")      
                    {
                        N=(Number(document.getElementById('total_rel').innerHTML.match(/\d+/))-1).toString();
                        newstring="<div id='total_rel' class='stat_total'><font color='black'> Total number of relevant entries in DB is: " + N + "</font></div>" 
                        $('#total_rel').hide();
                        $('#total_rel').replaceWith(newstring);
                        
                        N=(Number(document.getElementById('stock_rel').innerHTML.match(/\d+/))-1).toString();
                        newstring="<div id='stock_rel' class='stat_total'><font color='black'> Total number of relevant entries in DB for " + stock + " is: " + N + "</font></div>" 
                        $('#stock_rel').hide();
                        $('#stock_rel').replaceWith(newstring);
                    }      
        else if(user_action == "irrelevant")
                    {
                        N=(Number(document.getElementById('total_irel').innerHTML.match(/\d+/))-1).toString();
                        newstring="<div id='total_irel' class='stat_total'><font color='black'> Total number of irrelevant entries in DB is: " + N + "</font></div>" 
                        $('#total_irel').hide();
                        $('#total_irel').replaceWith(newstring);
                        
                        N=(Number(document.getElementById('stock_irel').innerHTML.match(/\d+/))-1).toString();
                        newstring="<div id='stock_irel' class='stat_total'><font color='black'> Total number of irrelevant entries in DB for " + stock + " is: " + N + "</font></div>" 
                        $('#stock_irel').hide();
                        $('#stock_irel').replaceWith(newstring);
                    } 
	relEditFlag[item]=0

	});	
    $('body').on('click', '.cor', function () {
	var item = $(this).attr("id").match(/[0-9]+/g)[0];
        if ( relEditFlag[item] == 1)
        {
                return;
        }
	relEditFlag[item] = 1
        //$('#debug').html('');
        //$('#debug').append('<div><font color="black">' + $(this).attr("id").slice(-1)+ '</font></div>')
	//var item = $(this).attr("id").slice(-1);
        //$('#debug').append('<div><font color="black">' + item + '</font></div>');
	var stock = $('.select_list_item').text();
        var user_action = $(this).attr("value")
	    ajaxPost('/get_correction', { 'relevancy': $(this).attr("value") ,'sentiment': 'none', 'tweet_id': item,'stock':stock },function (content) {
  	    //$('#debug').html('');
            //$('#debug').append('<div>' + item + '</div>')
            $('#corIrrel'+item).hide();
            editstring="<button id= editRelLab"+item +" class=editRel type=button value="+user_action+">Edit My Label</button>"
       	    $('#corRel'+item).replaceWith(editstring);

        if(user_action == "relevant")      
                    {
                        N=(Number(document.getElementById('total_rel').innerHTML.match(/\d+/))+1).toString();
                        newstring="<div id='total_rel' class='stat_total'><font color='black'> Total number of relevant entries in DB is: " + N + "</font></div>" 
                        $('#total_rel').hide();
                        $('#total_rel').replaceWith(newstring);
                        
                        N=(Number(document.getElementById('stock_rel').innerHTML.match(/\d+/))+1).toString();
                        newstring="<div id='stock_rel' class='stat_total'><font color='black'> Total number of relevant entries in DB for " + stock + " is: " + N + "</font></div>" 
                        $('#stock_rel').hide();
                        $('#stock_rel').replaceWith(newstring);
                        }       
        else if(user_action == "irrelevant")
                    {
                        N=(Number(document.getElementById('total_irel').innerHTML.match(/\d+/))+1).toString();
                        newstring="<div id='total_irel' class='stat_total'><font color='black'> Total number of irrelevant entries in DB is: " + N + "</font></div>" 
                        $('#total_irel').hide();
                        $('#total_irel').replaceWith(newstring);
                        
                        N=(Number(document.getElementById('stock_irel').innerHTML.match(/\d+/))+1).toString();
                        newstring="<div id='stock_irel' class='stat_total'><font color='black'> Total number of irrelevant entries in DB for " + stock + " is: " + N + "</font></div>" 
                        $('#stock_irel').hide();
                        $('#stock_irel').replaceWith(newstring);
                    }  

		});
	});
	
</script>

{% endblock %}
